{"version":3,"sources":["urls-preloader.js"],"names":["global","factory","exports","module","define","amd","isInArray","needle","heystack","indexOf","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","Object","values","reduce","a","b","concat","Media","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","LoaderPromise","fn","resolve","reject","value","_progress","forEach","listener","error","handler","push","Promise","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","filter","el","parentElement","target","source","length","attribute","i","j","getAttribute","switchAttributes","attrs","keys","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","Loader","_options","playthrough","sequential","_collection","_queue","Map","_load","_percentage","_state","data","dispatchEvent","CustomEvent","progress","loaded","pipeline","loadStep","cb","load","fetch","then","e","catch","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","style","visibility","position","top","left","width","height","appendChild","createdSource","append","finishPromise","removeChild","delete","prepareLoad","event","detail","queuer","observer","addEventListener","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","set","isMedia","Array","isArray","pushCheck","console","warn","logEl","querySelector","log","string","hasChildNodes","ol","list","li","innerHTML","scrollTop","offsetHeight","testLoader","imgs","letters","colors","ii","color","c","Math","floor","random","testLoad","percentage","abort"],"mappings":"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","file":"urls-preloader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n    typeof define === 'function' && define.amd ? define('lazyloader', factory) :\n    (factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => heystack.indexOf(needle) > -1;\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Media {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isMedia(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Media({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Media({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     *\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Media)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof item === 'string') {\n                    collection = [new Media({ url: item })];\n                }\n\n                if (Media.isMedia(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    collection.forEach(item => {\n                        const pushCheck = media => {\n                            if (media.type === 'image' || media.type === 'video' || media.type === 'audio' || (media.type === 'iframe' && media.consistent)) {\n                                this._collection.push(media);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add media to collection\", media);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(media => pushCheck(new Media(media)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Media({ url: item }));\n                        }\n\n                        if (Media.isMedia(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('Aborted')));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('A Loader instance is already in progress.');\n                }\n                if (!this._collection.length) {\n                    reject('Collection is empty.');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            return;\n                        }\n\n                        const loadStep = (media, cb) => {\n                            loaded++;\n\n                            this._percentage = (loaded / this._collection.length) * 100;\n\n                            progress(media);\n\n                            if (loaded < this._collection.length) {\n                                pipeline();\n\n                                return;\n                            }\n\n                            this._state = 0;\n\n                            cb();\n                        };\n\n                        const load = this.fetch(this._collection[loaded]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject('Error')));\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n                    const loadStep = (e, cb) => {\n                        loaded++;\n\n                        this._percentage = (loaded / this._collection.length) * 100;\n\n                        progress(e);\n\n                        if (loaded >= this._collection.length) {\n                            this._state = 0;\n\n                            cb();\n                        }\n                    };\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            break;\n                        }\n\n                        const load = this.fetch(this._collection[i]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject(e)));\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Media} resource\n         * @returns {Promise}\n         */\n        fetch(media) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = media.consistent && document.body.contains(media.element);\n                const hasSources = isConsistent && media.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(media.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (media.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, media.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, media.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...media.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (media.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = cb => {\n                    if (isConsistent) {\n                        switchAttributes(media.element, this._options.srcAttributes);\n                        switchAttributes(media.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...media.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (media.type === 'video' || media.type === 'audio') {\n                            media.element.load();\n                        }\n\n                        if (media.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    cb(media);\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', media.url);\n                    }\n\n                    if (media.type === 'video' || media.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = type => {\n                    const event = new CustomEvent(type, { detail: media });\n\n                    if (media.element) {\n                        media.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n                };\n\n                let queuer = { media: media, observer: null, element: createdElement };\n\n                // TODO: \"abort\" custom event must be \"private\" . instance?\n                createdElement.addEventListener('abort', () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    finishPromise(reject);\n                });\n\n                mainEventsTarget.addEventListener('error', () => {\n                    finishPromise(reject);\n\n                    dispatchEvent('mediaError');\n                });\n\n                if (media.type === 'image' || media.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire load at landing\n                        }\n\n                        finishPromise(resolve);\n\n                        dispatchEvent('mediaLoad');\n                    });\n                }\n\n                if (media.type === 'audio' || media.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', () => {\n                        finishPromise(resolve);\n\n                        dispatchEvent('mediaLoad');\n                    });\n                }\n\n                if (media.element instanceof HTMLElement && this._options.lazy && 'IntersectionObserver' in window) {\n                    queuer.observer = new IntersectionObserver(\n                        (entries, observer) => {\n                            entries.forEach(entry => {\n                                if (entry.intersectionRatio > 0) {\n                                    observer.unobserve(entry.target);\n\n                                    prepareLoad();\n                                }\n                            });\n                        },\n                        {\n                            root: null,\n                            rootMargin: '0px',\n                            threshold: 0.1\n                        }\n                    );\n\n                    queuer.observer.observe(media.element);\n                    this._queue.set(media.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    const logEl = document.querySelector('#console');\n    const log = string => {\n        if (!logEl.hasChildNodes()) {\n            const ol = document.createElement('ol');\n            logEl.append(ol);\n        }\n\n        const list = logEl.querySelector('ol');\n        const li = document.createElement('li');\n        li.innerHTML = string;\n        list.append(li);\n\n        logEl.scrollTop = list.offsetHeight;\n    };\n\n    const testLoader = new Loader({\n        sequential: true\n    });\n\n    document.querySelector('button.load').addEventListener('click', e => {\n        testLoader.collection = (() => {\n            let imgs = [];\n\n            for (let i = 0; i < 10; i++) {\n                let letters = '0123456789ABCDEF',\n                    colors = [];\n\n                for (let ii = 0; ii < 2; ii++) {\n                    let color = '';\n                    for (let c = 0; c < 6; c++) {\n                        color += letters[Math.floor(Math.random() * 16)];\n                    }\n                    colors[ii] = color;\n                }\n\n                imgs.push('//placehold.it/720x720/' + colors[0] + '/' + colors[1] + '.jpg');\n            }\n\n            return imgs;\n        })();\n\n        const testLoad = testLoader.load();\n\n        testLoad.then(e => log('All done, test array has completely loaded!', e));\n        testLoad.progress(e => log('Total programmatic load percentage: ' + testLoader.percentage + '% ' + e.url));\n        testLoad.catch(e => console.log('error', e));\n    });\n\n    document.querySelector('button.abort').addEventListener('click', e => testLoader.abort());\n\n})));\n"]}