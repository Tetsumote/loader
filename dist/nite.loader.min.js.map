{"version":3,"sources":["nite.loader.js"],"names":["window","document","$","undefined","console","prop","method","con","dummy","properties","methods","split","pop","CustomEvent","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","prototype","Event","Array","findIndex","Object","defineProperty","value","predicate","this","TypeError","o","len","length","thisArg","arguments","k","kValue","call","configurable","writable","isArray","arg","toString","filter","func","res","t","c","i","String","startsWith","search","pos","substr","includes","start","indexOf","generateInstanceID","Math","floor","random","pluginName","pluginMethod","pluginInstance","privateEventsStorage","detachEventListener","element","events","keys","forEach","key","replace","type","join","removeEventListener","handler","attachEventListener","once","count","_handler","addEventListener","hyphensToCamelCase","hyphens","g","toUpperCase","isInArray","needle","stack","capitalize","string","charAt","slice","isVisible","getComputedStyle","bodyEl","getElementsByTagName","winWidth","innerWidth","documnt","documentElement","clientWidth","winHeight","innerHeight","clientHeight","rect","getBoundingClientRect","right","bottom","left","top","isHTMLObject","object","HTMLElement","e","nodeType","style","ownerDocument","isLoaded","currentSrc","complete","readyState","isBroken","naturalWidth","videoWidth","isFormat","item","expectedFormat","formatExtensions","image","audio","video","formatNames","output","format","extension","formatQueue","x","hasOwnProperty","RegExp","test","matches64","match","matches","tagName","toLowerCase","ResourceLoader","[object Object]","options","_settings","srcAttr","srcsetAttr","playthrough","visible","_id","_id_event","_element","_resource","_busy","_format","_done","_success","_error","_callback","src","push","this_arguments","apply","resource","data","element_resource","string_resource","id","_exists","is_img","createElement","dataset","setAttribute","picture","closest","querySelectorAll","el","is_playthrough_mode__normal","is_playthrough_mode__full","sources","isFullyBuffered","media","buffered","round","end","seekable","call_media_load","source","sources_error_id","thisSource","load","on_progress_replacement_interval","setInterval","is_error","duration","currentTime","paused","play","clearInterval","pause","callback","status","getAttribute","srcset","removeAttribute","ResourcesLoader","collection","_collection","_collection_loaded","_collection_instances","_collection_pending","_resources_loaded","percentage","_progress","_abort","_loaded","_complete","_loop","setTimeout","loop","sequential_mode","sequential","this_load_id","this_load_index","this_load_instance","instance","done","a_progress","parseFloat","toFixed","this_resource","process","_func","resources","abort","define","amd","pluginPrefix","exports","module","$window","throttle","wait","context","timeout","callbackArgs","later","method_collection","fn","original_user_options","settings","backgrounds","extraAttrs","early","earlyTimeout","onProgress","onLoad","onError","onComplete","isFunction","attributes","each","$element","_$element","is_plain_data_collection","targets","targets_extended","$targets","find","is","add","$t","children","collection_item","attr","addBack","not","css","url","collect","unique_method_pluginName","progress","trigger","event_name","off","this_method_collection","on","clearTimeout","parseInt","isNaN","isFinite","jQuery"],"mappings":"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","sourcesContent":["/*! JQuery Nite Loader | Daniele Fioroni | dfioroni91@gmail.com */\r\n(function (window, document, $, undefined) {\r\n    'use strict';\r\n\r\n    // thanks to https://github.com/paulmillr/console-polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    (function () {\r\n        if (!window.console) {\r\n            window.console = {};\r\n        }\r\n        let con = window.console,\r\n            prop, method,\r\n            dummy = () => { },\r\n            properties = ['memory'],\r\n            methods = ('assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn').split(',');\r\n        while (prop = properties.pop()) {\r\n            if (!con[prop]) {\r\n                con[prop] = {};\r\n            }\r\n        }\r\n        while (method = methods.pop()) {\r\n            if (!con[method]) {\r\n                con[method] = dummy;\r\n            }\r\n        }\r\n    })();\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    (function () {\r\n        if (typeof window.CustomEvent === \"function\") {\r\n            return false;\r\n        }\r\n        function CustomEvent(event, params) {\r\n            params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n            const evt = document.createEvent('CustomEvent');\r\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\r\n            return evt;\r\n        }\r\n        CustomEvent.prototype = window.Event.prototype;\r\n        window.CustomEvent = CustomEvent;\r\n    })();\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    if (!Array.prototype.findIndex) {\r\n        Object.defineProperty(Array.prototype, 'findIndex', {\r\n            value: function (predicate) {\r\n                if (this == null) {\r\n                    throw new TypeError('\"this\" is null or not defined');\r\n                }\r\n                let o = Object(this);\r\n                let len = o.length >>> 0;\r\n                if (typeof predicate !== 'function') {\r\n                    throw new TypeError('predicate must be a function');\r\n                }\r\n                let thisArg = arguments[1];\r\n                let k = 0;\r\n                while (k < len) {\r\n                    let kValue = o[k];\r\n                    if (predicate.call(thisArg, kValue, k, o)) {\r\n                        return k;\r\n                    }\r\n                    k++;\r\n                }\r\n                return -1;\r\n            },\r\n            configurable: true,\r\n            writable: true\r\n        });\r\n    }\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    Array.isArray = Array.isArray || function (arg) {\r\n        return Object.prototype.toString.call(arg) === '[object Array]';\r\n    };\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    Array.prototype.filter = Array.prototype.filter || function (func, thisArg) {\r\n        'use strict';\r\n        if (!((typeof func === 'Function' || typeof func === 'function') && this)) {\r\n            throw new TypeError();\r\n        }\r\n        let len = this.length >>> 0,\r\n            res = new Array(len),\r\n            t = this, c = 0, i = -1;\r\n        if (thisArg === undefined) {\r\n            while (++i !== len) {\r\n                if (i in this) {\r\n                    if (func(t[i], i, t)) {\r\n                        res[c++] = t[i];\r\n                    } else {\r\n                        while (++i !== len) {\r\n                            if (i in this) {\r\n                                if (func.call(thisArg, t[i], i, t)) {\r\n                                    res[c++] = t[i];\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        res.length = c;\r\n        return res;\r\n    }\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    String.prototype.startsWith = String.prototype.startsWith || function (search, pos) {\r\n        return this.substr(!pos || pos < 0 ? 0 : +pos, search.length) === search;\r\n    };\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes#Polyfill\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    String.prototype.includes = String.prototype.includes || function (search, start) {\r\n        'use strict';\r\n        if (typeof start !== 'number') {\r\n            start = 0;\r\n        }\r\n        if (start + search.length > this.length) {\r\n            return false;\r\n        } else {\r\n            return this.indexOf(search, start) !== -1;\r\n        }\r\n    };\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    const\r\n        generateInstanceID = function () {\r\n            return Math.floor(Math.random() * (9999 - 1000)) + 1000;\r\n        },\r\n        pluginPrefix = 'nite',\r\n        pluginMethod = pluginPrefix + 'Load',\r\n        pluginName = pluginMethod + 'er',\r\n        pluginInstance = generateInstanceID();\r\n\r\n    window[pluginName + 'Cache'] = [];\r\n\r\n    let privateEventsStorage = {};\r\n\r\n    const\r\n        eventNamespaceParserSeparator = '__namespace__',\r\n        detachEventListener = (element, events) => {\r\n\r\n            if (!element || typeof events !== 'string') {\r\n                return;\r\n            }\r\n\r\n            if (events.startsWith('.')) {\r\n                Object.keys(privateEventsStorage).forEach((key) => {\r\n                    if (key.replace(eventNamespaceParserSeparator, '.').includes(events) && privateEventsStorage[key].element === element) {\r\n                        detachEventListener(element, key.replace(eventNamespaceParserSeparator, '.'));\r\n                    }\r\n                });\r\n            } else {\r\n\r\n                events = events.split('.');\r\n\r\n                const\r\n                    type = events[0],\r\n                    namespace = events[1];\r\n\r\n                if (namespace) {\r\n                    events = events.join(eventNamespaceParserSeparator);\r\n                }\r\n\r\n                if (events in privateEventsStorage) {\r\n                    element.removeEventListener(type, privateEventsStorage[events].handler);\r\n                    delete privateEventsStorage[events];\r\n                }\r\n            }\r\n\r\n        },\r\n        attachEventListener = (element, events, handler, once) => {\r\n\r\n            if (!element || typeof events !== 'string' || typeof handler !== 'function') {\r\n                return;\r\n            }\r\n\r\n            events = events.split('.');\r\n\r\n            const\r\n                type = events[0],\r\n                namespace = events[1];\r\n\r\n            if (namespace) {\r\n                events = events.join(eventNamespaceParserSeparator);\r\n            }\r\n\r\n            privateEventsStorage[events] = {\r\n                element: element,\r\n                count: 0,\r\n                once: false\r\n            };\r\n\r\n            if (true === once) {\r\n                let _handler = handler;\r\n                handler = function (event) {\r\n                    privateEventsStorage[events].count++;\r\n                    if (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\r\n                        return;\r\n                    }\r\n                    _handler.call(this, event);\r\n                    detachEventListener(element, events);\r\n                }\r\n            } else {\r\n                once = false;\r\n            }\r\n\r\n            privateEventsStorage[events] = {\r\n                ...privateEventsStorage[events], ...{\r\n                    handler: handler,\r\n                    once: once\r\n                }\r\n            };\r\n            element.addEventListener(type, privateEventsStorage[events].handler, { once: once });\r\n\r\n        },\r\n        hyphensToCamelCase = (hyphens) => {\r\n            return hyphens.replace(/-([a-z])/g, g => g[1].toUpperCase());\r\n        },\r\n        isInArray = (needle, stack) => {\r\n            return stack.indexOf(needle) > -1;\r\n        },\r\n        capitalize = (string) => {\r\n            return string.charAt(0).toUpperCase() + string.slice(1);\r\n        },\r\n        isVisible = (element) => {\r\n\r\n            if (window.getComputedStyle(element, 'display') === 'none') {\r\n                return false;\r\n            }\r\n\r\n            const\r\n                bodyEl = document.getElementsByTagName('body')[0],\r\n                winWidth = window.innerWidth || documnt.documentElement.clientWidth || bodyEl.clientWidth,\r\n                winHeight = window.innerHeight || documnt.documentElement.clientHeight || bodyEl.clientHeight,\r\n                rect = element.getBoundingClientRect();\r\n\r\n            return !(rect.right < 0 || rect.bottom < 0 || rect.left > winWidth || rect.top > winHeight);\r\n\r\n        },\r\n        isHTMLObject = function (object) {\r\n            if (typeof object !== 'object') {\r\n                return false;\r\n            }\r\n            try {\r\n                return object instanceof HTMLElement;\r\n            }\r\n            catch (e) {\r\n                return object.nodeType === 1 && typeof object.style === 'object' && typeof object.ownerDocument === 'object';\r\n            }\r\n        },\r\n        isLoaded = function (element) {\r\n            return (\r\n                (\r\n                    typeof element === 'string'\r\n                    &&\r\n                    isInArray(element, window[pluginName + 'Cache'])\r\n                )\r\n                ||\r\n                (\r\n                    isHTMLObject(element)\r\n                    && ('currentSrc' in element && element.currentSrc.length)\r\n                    && (('complete' in element && element.complete) || ('readyState' in element && element.readyState >= 2))\r\n                )\r\n            );\r\n        },\r\n        isBroken = function (element) {\r\n            return (\r\n                isLoaded(element)\r\n                &&\r\n                (\r\n                    (\r\n                        typeof element === 'object'\r\n                        &&\r\n                        (\r\n                            ('naturalWidth' in element && Math.floor(element.naturalWidth) === 0)\r\n                            ||\r\n                            ('videoWidth' in element && element.videoWidth === 0)\r\n                        )\r\n                    )\r\n                    ||\r\n                    typeof element === 'string'// TODO: check if is url maybe?\r\n                )\r\n            );\r\n        },\r\n        isFormat = function (item, expectedFormat) {\r\n\r\n            const\r\n                formatExtensions = {\r\n                    image: 'jp[e]?g||jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg',\r\n                    audio: 'mp3|ogg|oga|spx|ogg|wav',\r\n                    video: 'mp4|ogv|webm'\r\n                },\r\n                formatNames = Object.keys(formatExtensions),\r\n                base64Heading = '\\;base64\\,';\r\n\r\n            let output = { format: null, extension: null };\r\n\r\n            if (typeof item === 'string') {\r\n\r\n                item = item.split('?')[0]; // this gets rid of query strings\r\n                item = item.split('#')[0]; // this gets rid of hashes\r\n\r\n                if (item === '') {\r\n                    return false;\r\n                }\r\n\r\n                let formatQueue = undefined !== expectedFormat ? [expectedFormat] : formatNames;\r\n\r\n                for (const x in formatQueue) {\r\n\r\n                    if (formatQueue.hasOwnProperty(x)) {\r\n\r\n                        if (new RegExp('(\\.(' + formatExtensions[formatQueue[x]] + ')$)|' + base64Heading, 'g').test(item)) {\r\n\r\n                            if (new RegExp(base64Heading, 'g').test(item)) {\r\n\r\n                                let matches64 = item.match(new RegExp('^data:' + formatQueue[x] + '\\/(' + formatExtensions[formatQueue[x]] + ')', 'g'));\r\n\r\n                                if (!matches64 || null === matches64) {\r\n                                    continue;\r\n                                }\r\n\r\n                                matches64 = matches64[0];\r\n\r\n                                output.format = formatQueue[x];\r\n                                output.extension = matches64.replace('data:' + formatQueue[x] + '/', '');\r\n\r\n                                break;\r\n\r\n                            } else {\r\n\r\n                                let matches = item.match(new RegExp(formatExtensions[formatQueue[x]], 'g'));\r\n\r\n                                if (matches) {\r\n\r\n                                    output.format = formatQueue[x];\r\n                                    output.extension = matches[0];\r\n\r\n                                    break;\r\n\r\n                                }\r\n\r\n                            }\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n            if (isHTMLObject(item)) {\r\n\r\n                let tagName = item.tagName.toLowerCase();\r\n\r\n                if (isInArray(tagName, formatNames)) {\r\n                    output.format = item.tagName.toLowerCase();\r\n                }\r\n\r\n                if (tagName === 'img') {\r\n                    output.format = 'image';\r\n                }\r\n\r\n            }\r\n\r\n            return output;\r\n\r\n        };\r\n\r\n    // TODO: Promise?\r\n    class ResourceLoader {\r\n\r\n        constructor(options) {\r\n\r\n            // TODO: private\r\n            // TODO: think about useful vars (this class is not public but its vars are returned in .progress() callback)\r\n            this._settings = {\r\n                ...{\r\n                    srcAttr: 'data-src',\r\n                    srcsetAttr: 'data-srcset',\r\n                    playthrough: false,\r\n                    visible: false,\r\n                }, ...options\r\n            };\r\n\r\n            this.srcAttr = '';\r\n            this.srcsetAttr = '';\r\n\r\n            if( !this._settings.srcAttr.startsWith('data-') ){\r\n                this.srcAttr = this._settings.srcAttr;\r\n                this._settings.srcAttr = 'data-'+this._settings.srcAttr;\r\n            }else{\r\n                this.srcAttr = this._settings.srcAttr.replace('data-', '');\r\n            }\r\n            \r\n            if( !this._settings.srcsetAttr.startsWith('data-') ){\r\n                this.srcsetAttr = this._settings.srcsetAttr;\r\n                this._settings.srcsetAttr = 'data-'+this._settings.srcsetAttr;\r\n            }else{\r\n                this.srcsetAttr = this._settings.srcsetAttr.replace('data-', '');\r\n            }\r\n\r\n            this.srcAttr = hyphensToCamelCase(this.srcAttr);\r\n            this.srcsetAttr = hyphensToCamelCase(this.srcsetAttr);\r\n\r\n            this._id = null;\r\n            this._id_event = null;\r\n\r\n            this._element = null;\r\n\r\n            this._resource = null;\r\n            this._busy = false;\r\n\r\n            this._format = null;\r\n\r\n            this._done = () => { };\r\n            this._success = () => { };\r\n            this._error = () => { };\r\n\r\n            this._callback = (e) => {\r\n\r\n                this._busy = false;\r\n\r\n                const src = this._element.currentSrc || this._element.src;\r\n\r\n                if (!isInArray(src, window[pluginName + 'Cache']))\r\n                    window[pluginName + 'Cache'].push(src);\r\n\r\n                let this_arguments = [this._element, e.type, src, this._id];\r\n\r\n                this[e.type !== 'error' ? '_success' : '_error'].apply(this, this_arguments);\r\n                this._done.apply(this, this_arguments);\r\n\r\n            };\r\n\r\n        }\r\n\r\n        set resource(data) {\r\n\r\n            const\r\n                element_resource = isHTMLObject(data.resource),\r\n                string_resource = typeof data.resource === 'string';\r\n\r\n            if (!element_resource && !string_resource) {\r\n                return;\r\n            }\r\n\r\n            this._id = data.id;\r\n            this._format = isFormat(data.resource).format;\r\n\r\n            this._exists = element_resource; // TODO: maybe search for an element with this src\r\n\r\n            if (string_resource) {\r\n\r\n                let is_img = this._format === 'image';\r\n\r\n                this._element = document.createElement(is_img ? 'img' : this._format);\r\n\r\n                if (is_img) {\r\n                    this.srcsetAttr = 'srcset';\r\n                    this._settings.srcsetAttr = 'data-'+this.srcsetAttr;\r\n                    this.srcsetAttr = hyphensToCamelCase(this.srcsetAttr);\r\n                }\r\n\r\n                this.srcAttr = 'src';\r\n                this._settings.srcAttr = 'data-'+this.srcAttr;\r\n                this.srcAttr = hyphensToCamelCase(this.srcAttr);\r\n\r\n                this._resource = data.resource;\r\n\r\n            }\r\n\r\n            if (element_resource) {\r\n                this._element = data.resource;\r\n            }\r\n\r\n            if (string_resource) {\r\n                this._element.dataset[this.srcAttr] = this._resource;\r\n                this._element.dataset[this.srcsetAttr] = this._resource;\r\n                this._element.setAttribute(this._settings.srcAttr, this._resource);\r\n                this._element.setAttribute(this._settings.srcsetAttr, this._resource);\r\n            }\r\n\r\n            this._id_event = this._element[pluginInstance + '_IDEvent'];\r\n            this._busy = this._id_event !== undefined;\r\n            this._id_event = this._busy ? this._id_event : pluginName + '_unique_' + this._element.tagName + '_' + generateInstanceID();\r\n\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @returns {boolean} se ha preso in carico il caricamento oppure no per vari motivi (è già caricato, non è nella viewport etc)\r\n         */\r\n        process() {\r\n\r\n            if (isLoaded(this._exists ? this._element : this._resource)) {\r\n\r\n                if (!this._busy) {\r\n                    detachEventListener(this._element, '.' + this._id_event); // TODO: mayabe this should be called in this._callback\r\n                }\r\n\r\n                this._callback(new CustomEvent(!isBroken(this._exists ? this._element : this._resource) ? 'load' : 'error'));\r\n\r\n                return false;\r\n\r\n            } else if (this._exists && this._settings.visible && !isVisible(this._element)) {\r\n\r\n                return false;\r\n\r\n            } else {\r\n\r\n                if (this._format === 'image') {\r\n\r\n                    attachEventListener(this._element, 'load.' + this._id_event, this._callback, !this._busy);\r\n                    attachEventListener(this._element, 'error.' + this._id_event, this._callback, !this._busy);\r\n\r\n                    const picture = this._element.closest('picture');\r\n\r\n                    if (picture && 'HTMLPictureElement' in window) {\r\n\r\n                        delete this._element.dataset[this.srcsetAttr];\r\n                        delete this._element.dataset[this.srcAttr];\r\n\r\n                        picture.querySelectorAll('source[' + this._settings.srcsetAttr + ']').forEach((el) => {\r\n                            el.setAttribute('srcset', el.dataset[this.srcAttr]);\r\n                            delete el.dataset[this.srcAttr];\r\n                        });\r\n\r\n                    } else {\r\n\r\n                        if (this._element.matches('[' + this._settings.srcsetAttr + ']')) {\r\n                            this._element.setAttribute('srcset', this._element.dataset[this.srcsetAttr]);\r\n                            delete this._element.dataset[this.srcsetAttr];\r\n                        }\r\n\r\n                        if (this._element.matches('[' + this._settings.srcAttr + ']')) {\r\n                            this._element.setAttribute('src', this._element.dataset[this.srcAttr]);\r\n                            delete this._element.dataset[this.srcAttr];\r\n                        }\r\n\r\n                    }\r\n\r\n                } else if (this._format === 'video' || this._format === 'audio') {\r\n\r\n                    const\r\n\r\n                        is_playthrough_mode__normal = true === this._settings.playthrough,\r\n                        is_playthrough_mode__full = 'full' === this._settings.playthrough,\r\n\r\n                        sources = this._element.querySelectorAll('source'),\r\n                        isFullyBuffered = function (media) {\r\n\r\n                            return media.buffered.length && Math.round(media.buffered.end(0)) / Math.round(media.seekable.end(0)) === 1;\r\n\r\n                        };\r\n\r\n                    let call_media_load = false;\r\n\r\n                    if (sources) {\r\n\r\n                        sources.forEach((source) => {\r\n\r\n                            if (source.matches('[' + this._settings.srcAttr + ']')) {\r\n\r\n                                source.setAttribute('src', source.dataset[this.srcAttr]);\r\n                                delete source.dataset[this.srcsetAttr];\r\n\r\n                                call_media_load = true;\r\n\r\n                            }\r\n\r\n                            attachEventListener(source, 'error.' + this._id_event, (e) => {\r\n\r\n                                const sources_error_id = pluginName + '_error';\r\n\r\n                                source[pluginInstance + '_' + sources_error_id] = true;\r\n\r\n                                if (sources.length === [...sources].filter(thisSource => true === thisSource[pluginInstance + '_' + sources_error_id]).length) {\r\n                                    this._callback(e);\r\n                                }\r\n\r\n                            }, !this._busy);\r\n\r\n                        });\r\n\r\n                    } else {\r\n\r\n                        if (this._element.matches('[' + src + ']')) {\r\n\r\n                            this._element.setAttribute('src', this._element.dataset[this.srcAttr]);\r\n                            delete this._element.dataset[this.srcAttr];\r\n\r\n                            attachEventListener(this._element, 'error.' + this._id_event, this._callback, !this._busy);\r\n\r\n                            call_media_load = true;\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                    if (call_media_load) {\r\n                        this._element.load();\r\n                    }\r\n\r\n\r\n                    attachEventListener(this._element, 'loadedmetadata.' + this._id_event, () => {\r\n\r\n                        if (!is_playthrough_mode__normal && !is_playthrough_mode__full) {\r\n                            this._callback(new CustomEvent('load'));\r\n                        }\r\n\r\n                        if (is_playthrough_mode__full) {\r\n\r\n                            let on_progress_replacement_interval = setInterval(() => {\r\n\r\n                                let is_error = this._element.readyState > 0 && !this._element.duration;\r\n\r\n                                if (is_error || isFullyBuffered(this._element)) {\r\n\r\n                                    this._element.currentTime = 0;\r\n\r\n                                    if (!is_error && !this._busy && this._element.paused && this._element.matches('[autoplay]')) {\r\n                                        this._element.play();\r\n                                    }\r\n\r\n                                    clearInterval(on_progress_replacement_interval);\r\n\r\n                                    this._callback(new CustomEvent(!is_error ? 'load' : 'error'));\r\n\r\n                                } else {\r\n\r\n                                    if (!this._element.paused) {\r\n                                        this._element.pause();\r\n                                    }\r\n\r\n                                    if (!this._busy) {\r\n                                        this._element.currentTime += 2;\r\n                                    }\r\n\r\n                                }\r\n\r\n                            }, 500);\r\n\r\n                            this._element[pluginName + '_' + this._id_event] = on_progress_replacement_interval;\r\n\r\n                        }\r\n\r\n                    }, !this._busy);\r\n\r\n                    attachEventListener(this._element, 'canplay.' + this._id_event, () => {\r\n                        if (is_playthrough_mode__full && this._element.currentTime === 0 && !isFullyBuffered(this._element)) {\r\n                            this._element.currentTime++;\r\n                        }\r\n                    }, !this._busy);\r\n\r\n                    attachEventListener(this._element, 'canplaythrough.' + this._id_event, () => {\r\n                        if (is_playthrough_mode__normal) {\r\n                            this._callback(new CustomEvent('load'));\r\n                        }\r\n                    }, !this._busy);\r\n\r\n                } else {\r\n\r\n                    return false;\r\n\r\n                }\r\n\r\n                if (!this._busy) {\r\n                    this._element[pluginInstance + '_IDEvent'] = this._id_event;\r\n                }\r\n\r\n            }\r\n\r\n            this._resource = this._element.currentSrc || this._element.src;\r\n\r\n            return !this._busy;\r\n\r\n        }\r\n\r\n        done(callback) {\r\n\r\n            if (typeof callback !== 'function') {\r\n                return;\r\n            }\r\n\r\n            this._done = function (element, status, resource, id) {\r\n                callback.apply(this, [element, status, resource, id]);\r\n            };\r\n\r\n        };\r\n\r\n        abort() {\r\n\r\n            detachEventListener(this._element, '.' + this._id_event);\r\n\r\n            if (isLoaded(this._exists ? this._element : this._resource)) {\r\n                return;\r\n            }\r\n\r\n            const\r\n                src = this._element.getAttribute('srcset'),\r\n                srcset = this._element.getAttribute('src');\r\n\r\n            if (undefined !== src) {\r\n                this._element.dataset[this.srcAttr] = src;\r\n                this._element.setAttribute(this._settings.srcAttr, src);\r\n                this._element.removeAttribute('src');\r\n                this._element.removeAttribute('srcset');\r\n            }\r\n\r\n            if (undefined !== srcset) {\r\n                this._element.dataset[this.srcsetAttr] = srcset;\r\n                this._element.setAttribute(this._settings.srcsetAttr, srcset);\r\n                this._element.removeAttribute('src');\r\n                this._element.removeAttribute('srcset');\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // TODO: Promise?\r\n    class ResourcesLoader {\r\n\r\n        constructor(collection, options) {\r\n\r\n            // TODO: private\r\n            this._collection = [];\r\n            this._collection_loaded = [];\r\n            this._collection_instances = [];\r\n            this._collection_pending = [];\r\n            this._resources_loaded = [];\r\n\r\n            if (Array.isArray(collection) && (typeof collection[0] === 'string' || isHTMLObject(collection[0]))) {\r\n                for (const resource in collection) {\r\n                    if (collection.hasOwnProperty(resource)) {\r\n                        this._collection.push({ id: generateInstanceID(), resource: collection[resource] });\r\n                    }\r\n                }\r\n            }\r\n            if (typeof collection === 'string' || isHTMLObject(collection)) {\r\n                this._collection.push({ id: generateInstanceID(), resource: collection });\r\n            }\r\n\r\n            this._settings = {\r\n                ...{\r\n                    srcAttr: 'data-src',\r\n                    srcsetAttr: 'data-srcset',\r\n                    playthrough: false,\r\n                    visible: false,\r\n                }, ...options\r\n            };\r\n\r\n            this.srcAttr = '';\r\n            this.srcsetAttr = '';\r\n\r\n            if( !this._settings.srcAttr.startsWith('data-') ){\r\n                this.srcAttr = this._settings.srcAttr;\r\n                this._settings.srcAttr = 'data-'+this._settings.srcAttr;\r\n            }else{\r\n                this.srcAttr = this._settings.srcAttr.replace('data-', '');\r\n            }\r\n            \r\n            if( !this._settings.srcsetAttr.startsWith('data-') ){\r\n                this.srcsetAttr = this._settings.srcsetAttr;\r\n                this._settings.srcsetAttr = 'data-'+this._settings.srcsetAttr;\r\n            }else{\r\n                this.srcsetAttr = this._settings.srcsetAttr.replace('data-', '');\r\n            }\r\n            \r\n            this.srcAttr = hyphensToCamelCase(this.srcAttr);\r\n            this.srcsetAttr = hyphensToCamelCase(this.srcsetAttr);\r\n\r\n            this.percentage = 0;\r\n\r\n            this._done = () => { };\r\n            this._progress = () => { };\r\n            this._success = () => { };\r\n            this._error = () => { };\r\n\r\n            this._abort = false;\r\n            this._loaded = 0;\r\n            this._complete = false;\r\n            this._busy = false;\r\n\r\n            // self invoking this._loop + force asynchrony (gives time to chain methods synchronously)\r\n            (this._loop = () => setTimeout(() => this.loop(), 25))();\r\n\r\n        }\r\n\r\n        loop() {\r\n\r\n            this._collection_pending = []; // resets pending elements (sequential opt helper array) every time we loop\r\n\r\n            const sequential_mode = true === this._settings.sequential;\r\n\r\n            for (let i = 0; i < this._collection.length; i++) {\r\n\r\n                if (this._abort) {\r\n                    break;\r\n                }\r\n\r\n                let this_load_id = this._collection[i].id,\r\n                    this_load_index = this._collection_instances.findIndex(x => x.id === this_load_id),\r\n                    this_load_instance = new ResourceLoader(this._settings);\r\n\r\n                if (this_load_index === -1) {\r\n                    this._collection_instances.push({ id: this_load_id, instance: this_load_instance });\r\n                    this_load_index = this._collection_instances.findIndex(x => x.id === this_load_id);\r\n                } else {\r\n                    this._collection_instances[this_load_index].instance = this_load_instance;\r\n                }\r\n\r\n                this_load_instance.resource = this._collection[i];\r\n\r\n                this_load_instance.done((element, status, resource, id) => {\r\n\r\n                    if (this._complete || this._abort) {\r\n                        return;\r\n                    }\r\n\r\n                    const a_progress = !isInArray(id, this._collection_loaded);\r\n\r\n                    if (a_progress) {\r\n\r\n                        this._collection_loaded.push(id);\r\n                        this._busy = false;\r\n\r\n                        this._loaded++;\r\n                        this.percentage = this._loaded / this._collection.length * 100;\r\n                        this.percentage = parseFloat(this.percentage.toFixed(4));\r\n\r\n                        const this_resource = { resource: resource, status: status, element: element }; // TODO: cleanup/refactory\r\n                        this._resources_loaded.push(this_resource);\r\n\r\n                        this._progress.call(this, this_resource);\r\n                        this[status !== 'error' ? '_success' : '_error'].call(this, this_resource);\r\n\r\n                        // TODO: dispatch event on element maybe?\r\n                        // element.dispatchEvent(new CustomEvent(pluginPrefix + capitalize(status) + '.' + pluginPrefix));\r\n\r\n                    }\r\n\r\n                    if (this._loaded === this._collection.length) {\r\n\r\n                        this._done.call(this, this._resources_loaded);\r\n\r\n                        this._complete = true;\r\n\r\n                    } else if (a_progress && sequential_mode) {\r\n\r\n                        if (this._collection_pending.length) {\r\n\r\n                            this._collection_pending = this._collection_pending.filter(x => x.id !== id);\r\n                            this._collection_pending = this._collection_pending.filter(x => x.id !== id);\r\n\r\n                            if (this._collection_pending.length) {\r\n                                this._busy = this._collection_pending[0].instance.process();\r\n                            }\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                });\r\n\r\n                if (!sequential_mode || (sequential_mode && !this._busy)) {\r\n                    this._busy = this_load_instance.process();\r\n                }\r\n\r\n                else if (sequential_mode && this._busy) {\r\n\r\n                    if (!this._settings.visible || (this._settings.visible && isVisible(this_load_instance._element))) {\r\n                        this._collection_pending.push({ id: this_load_id, instance: this_load_instance });\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        }\r\n\r\n        done(callback) { // TODO: refactory\r\n\r\n            if (typeof callback !== 'function') {\r\n                return;\r\n            }\r\n\r\n            const _func = function (resources) {\r\n                callback.call(this, resources);\r\n            };\r\n\r\n            if (this._collection.length) {\r\n\r\n                this._done = _func;\r\n\r\n                this._loop();\r\n\r\n            } else {\r\n                _func();\r\n            }\r\n\r\n        };\r\n\r\n        progress(callback) { // TODO: refactory\r\n\r\n            if (typeof callback !== 'function')\r\n                return;\r\n\r\n            const _func = function (resource) {\r\n                callback.call(this, resource);\r\n            };\r\n\r\n            if (this._collection.length) {\r\n\r\n                this._progress = _func;\r\n\r\n                this._loop();\r\n\r\n            }\r\n\r\n        };\r\n\r\n        success(callback) { // TODO: refactory\r\n\r\n            if (typeof callback !== 'function') {\r\n                return;\r\n            }\r\n\r\n            const _func = function (resource) {\r\n                callback.call(this, resource);\r\n            };\r\n\r\n            if (this._collection.length) {\r\n\r\n                this._success = _func;\r\n\r\n                this._loop();\r\n\r\n            }\r\n\r\n        };\r\n\r\n        error(callback) { // TODO: refactory\r\n\r\n            if (typeof callback !== 'function') {\r\n                return;\r\n            }\r\n\r\n            const _func = function (resource) {\r\n                callback.call(this, resource);\r\n            };\r\n\r\n            if (this._collection.length) {\r\n\r\n                this._error = _func;\r\n\r\n                this._loop();\r\n\r\n            }\r\n\r\n        };\r\n\r\n        abort() {\r\n\r\n            for (const key in this._collection_instances) {\r\n                this._collection_instances[key].instance.abort();\r\n            }\r\n\r\n            if (this._collection.length) {\r\n                this._abort = true;\r\n            }\r\n\r\n        };\r\n\r\n    }\r\n\r\n    // vanilla public interface\r\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n    // requirejs syntax\r\n    if (typeof define === 'function' && define.amd) {\r\n        define(capitalize(pluginMethod), ResourceLoader);\r\n        // nodejs syntax\r\n    } else if ('object' === typeof exports) {\r\n        module.exports[capitalize(pluginMethod)] = ResourceLoader;\r\n        // standard \"global variable\" syntax\r\n    } else {\r\n        window[capitalize(pluginMethod)] = ResourceLoader;\r\n    }\r\n    // - - - - - - - - - - - - - - - - - - - - - - - - - - -\r\n\r\n    // from here jQuery is needed\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n    if (!$) {\r\n        return undefined;\r\n    }\r\n    // - - - - - - - - - - - - - - - - - - - -\r\n\r\n    $[pluginMethod] = ResourcesLoader;\r\n\r\n    // TODO: this class is only called once:\r\n    // POSSIBLE SOLUTIONS:\r\n    // 1. convert to vanillajs and expose it as a public interface\r\n    // 2. convert to singleton when used\r\n    class CollectionPopulator {\r\n\r\n        constructor($element, options) {\r\n\r\n            this._$element = $element;\r\n            this._element = $element[0];\r\n\r\n            this._settings = {\r\n                ...{\r\n                    srcAttr: 'data-src',\r\n                    srcsetAttr: 'data-srcset',\r\n                    backgrounds: false,\r\n                    attributes: []\r\n                }, ...options\r\n            };\r\n\r\n            if( !this._settings.srcAttr.startsWith('data-') ){\r\n                this._settings.srcAttr = 'data-'+this._settings.srcAttr;\r\n            }\r\n\r\n            if( !this._settings.srcsetAttr.startsWith('data-') ){\r\n                this._settings.srcsetAttr = 'data-'+this._settings.srcsetAttr;\r\n            }\r\n\r\n        }\r\n\r\n        collect(output) {\r\n\r\n            let collection = [];\r\n\r\n            const\r\n                is_plain_data_collection = output === 'plain',\r\n\r\n                src = this._settings.srcAttr,\r\n                srcset = this._settings.srcsetAttr,\r\n\r\n                targets = 'img, video, audio',\r\n                targets_extended = targets + ', picture, source';\r\n\r\n            let $targets = this._$element.find(targets);\r\n            if (this._$element.is(targets)) {\r\n                $targets = $targets.add(this._$element);\r\n            }\r\n            $targets = $targets.filter(function () {\r\n                let $t = $(this),\r\n                    filter = '[' + src + '], [' + srcset + ']';\r\n                return $t.is(filter) || $t.children(targets_extended).filter(filter).length;\r\n            });\r\n            $targets.each(function () {\r\n\r\n                let collection_item = {\r\n                    element: this,\r\n                    resource: $(this).attr(src) || $(this).attr(srcset)\r\n                };\r\n\r\n                if (is_plain_data_collection) {\r\n                    collection_item = collection_item.element;\r\n                }\r\n\r\n                collection.push(collection_item);\r\n\r\n            });\r\n\r\n            if (true === this._settings.backgrounds)\r\n                this._$element.find('*').addBack().not(targets_extended).filter(function () {\r\n                    return $(this).css('background-image') !== 'none';\r\n                }).each(function () {\r\n\r\n                    const url = $(this).css('background-image').match(/\\((.*?)\\)/);\r\n\r\n                    if (null === url || url.length < 2) {\r\n                        return true;\r\n                    }\r\n\r\n                    let collection_item = {\r\n                        element: this,\r\n                        resource: url[1].replace(/('|\")/g, '')\r\n                    };\r\n\r\n                    if (is_plain_data_collection) {\r\n                        collection_item = collection_item.resource;\r\n                    }\r\n\r\n                    collection.push(collection_item);\r\n\r\n                });\r\n\r\n            if (this._settings.attributes.length)\r\n                for (const attr in this._settings.attributes) {\r\n                    if (this._settings.attributes.hasOwnProperty(attr)) {\r\n\r\n                        this._$element.find('[' + attr + ']:not(' + targets_extended + ')').each(function () {\r\n\r\n                            let collection_item = {\r\n                                element: this,\r\n                                resource: $(this).attr(attr)\r\n                            };\r\n\r\n                            if (is_plain_data_collection) {\r\n                                collection_item = collection_item.resource;\r\n                            }\r\n\r\n                            collection.push(collection_item);\r\n\r\n                        });\r\n\r\n                        if (this._$element.is('[' + attr + ']') && !this._$element.is(targets_extended)) {\r\n\r\n                            let collection_item = {\r\n                                element: this._element,\r\n                                resource: this._$element.attr(attr)\r\n                            };\r\n\r\n                            if (is_plain_data_collection) {\r\n                                collection_item = collection_item.resource;\r\n                            }\r\n\r\n                            collection.push(collection_item);\r\n\r\n                        }\r\n\r\n                    }\r\n                }\r\n\r\n            return collection;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    const\r\n        $document = $(document),\r\n        $window = $(window),\r\n        // thanks https://gist.github.com/beaucharman/e46b8e4d03ef30480d7f4db5a78498ca\r\n        throttle = (callback, wait, context = this) => {\r\n            let timeout = null,\r\n                callbackArgs = null\r\n            const later = () => {\r\n                callback.apply(context, callbackArgs)\r\n                timeout = null\r\n            }\r\n            return function () {\r\n                if (!timeout) {\r\n                    callbackArgs = arguments\r\n                    timeout = setTimeout(later, wait)\r\n                }\r\n            }\r\n        };\r\n\r\n    let method_collection = [];\r\n\r\n    $.fn[pluginMethod] = function (options) {\r\n\r\n        let original_user_options = options;\r\n\r\n        if (typeof options !== 'object') {\r\n            options = {};\r\n        }\r\n\r\n        let settings = {\r\n            ...{\r\n\r\n                srcAttr: 'data-src',\r\n                srcsetAttr: 'data-srcset',\r\n\r\n                visible: false,\r\n\r\n                sequential: false,\r\n\r\n                backgrounds: false,\r\n                extraAttrs: [],\r\n\r\n                playthrough: false,\r\n\r\n                early: false,\r\n                earlyTimeout: 0,\r\n\r\n                onProgress: () => { },\r\n                onLoad: () => { },\r\n                onError: () => { },\r\n\r\n                onComplete: () => { },\r\n\r\n            }, ...options\r\n        };\r\n\r\n        if( !settings.srcAttr.startsWith('data-') ){\r\n            settings.srcAttr = 'data-'+settings.srcAttr;\r\n        }\r\n\r\n        if( !settings.srcsetAttr.startsWith('data-') ){\r\n            settings.srcsetAttr = 'data-'+settings.srcsetAttr;\r\n        }\r\n\r\n        let callback = settings.onComplete;\r\n        if ($.isFunction(original_user_options)) {\r\n            callback = original_user_options;\r\n        }\r\n\r\n        if (!$.isArray(settings.attributes)) {\r\n            settings.attributes = [];\r\n        }\r\n        if (typeof settings.attributes === 'string') {\r\n            settings.attributes = settings.attributes.split(' ');\r\n        }\r\n\r\n        return this.each(function (i) {\r\n\r\n            const\r\n                element = this,\r\n                $element = $(element),\r\n                collection = new CollectionPopulator($element, settings).collect('plain'),\r\n                unique_method_pluginName = generateInstanceID() + i,\r\n\r\n                this_load_instance = new ResourcesLoader(collection, settings);\r\n\r\n            method_collection.push({\r\n                id: unique_method_pluginName,\r\n                instance: this_load_instance,\r\n                element: element,\r\n                timeout: null\r\n            });\r\n\r\n            this_load_instance.progress((resource) => {\r\n\r\n                $(resource.element).trigger(pluginPrefix + capitalize(resource.status) + '.' + pluginPrefix, [resource.element, resource.resource]);\r\n                $element.trigger(pluginPrefix + 'Progress.' + pluginPrefix, [element, resource]);\r\n\r\n                const this_arguments = [this_load_instance, resource];\r\n\r\n                if (typeof settings.onProgress === 'function') {\r\n                    settings.onProgress.apply(element, this_arguments);\r\n                }\r\n\r\n                let event_name = capitalize(resource.status);\r\n                if (typeof settings['on' + event_name] === 'function') {\r\n                    settings['on' + event_name].apply(element, this_arguments);\r\n                }\r\n\r\n            });\r\n\r\n            this_load_instance.done((resources) => {\r\n\r\n                $element.trigger(pluginPrefix + 'Complete.' + pluginPrefix, [element, resources]);\r\n                callback.apply(element, [this_load_instance, resources]);\r\n\r\n                if (settings.visible) {\r\n                    $window.off('scroll.' + unique_method_pluginName);\r\n                }\r\n\r\n                // refresh other method calls for same el (omitting this one)\r\n                method_collection = method_collection.filter(x => x.id !== unique_method_pluginName);\r\n                method_collection.forEach((this_method_collection) => {\r\n                    if ($element.is(this_method_collection.element)) {\r\n                        this_method_collection.instance.loop();\r\n                    }\r\n                });\r\n\r\n            });\r\n\r\n            if (settings.visible) {\r\n                $window.on('scroll.' + unique_method_pluginName, throttle(() => this_load_instance.loop(), 250));\r\n            }\r\n\r\n            if (true === settings.early) for (let key in method_collection) {\r\n\r\n                let this_method_collection = method_collection[key];\r\n\r\n                if (method_collection[key].id === unique_method_pluginName) {\r\n\r\n                    clearTimeout(this_method_collection.timeout);\r\n\r\n                    let timeout = parseInt(settings.earlyTimeout);\r\n\r\n                    this_method_collection.timeout = setTimeout(function () {\r\n\r\n                        // TODO: appropriate method for setting settings?\r\n                        this_method_collection.instance._settings.visible = false;\r\n                        this_method_collection.instance._settings.sequential = true;\r\n\r\n                        this_method_collection.instance.loop();\r\n\r\n                    }, !isNaN(timeout) && isFinite(timeout) ? timeout : 0);\r\n\r\n                    break;\r\n\r\n                }\r\n\r\n            }\r\n\r\n        });\r\n\r\n    };\r\n\r\n})(window, document, jQuery);"],"file":"nite.loader.min.js"}