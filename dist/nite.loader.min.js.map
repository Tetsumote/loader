{"version":3,"sources":["nite.loader.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_extends","assign","arguments","source","hasOwnProperty","call","_typeof","Symbol","iterator","obj","constructor","_classCallCheck","instance","TypeError","_toConsumableArray","arr","Array","isArray","arr2","from","global","factory","exports","module","define","amd","niteLoader","this","_polyfill","generateInstanceID","Math","floor","random","stringContains","heystack","needle","String","includes","indexOf","stringStartsWith","startsWith","substr","arrayFindIndex","filter","findIndex","index","hyphensToCamelCase","string","replace","g","toUpperCase","capitalize","charAt","slice","nodelistToArray","nodelist","concat","isInArray","privateCache","intersectionObserverSupported","window","pictureElementSupported","jQueryIncluded","isVisible","element","intersectionRatio","getComputedStyle","bodyEl","document","getElementsByTagName","winWidth","innerWidth","documnt","documentElement","clientWidth","winHeight","innerHeight","clientHeight","rect","getBoundingClientRect","right","bottom","left","top","isHTMLElement","HTMLElement","e","nodeType","style","ownerDocument","isLoaded","currentSrc","complete","readyState","isFullyBuffered","media","buffered","round","end","seekable","pluginInstance","supportedExtensions","image","audio","video","supportedTags","privateEventsStorage","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","Event","detachEventListener","events","_key","eventNameWithNamespace","type","split","join","removeEventListener","handler","attachEventListener","once","count","_handler","addEventListener","SingleLoader","options","_this","_settings","srcAttr","srcsetAttr","playthrough","visible","Error","_id","_idEvent","_busy","_element","_resource","_format","_observer","_done","_success","_error","_callback","unobserve","src","push","thisArguments","apply","value","_this2","_exists","_consistent","naturalWidth","videoWidth","_originalElement","picture","closest","dataset","querySelectorAll","forEach","el","setAttribute","matches","isStandardPlaythrough","isFullPlaythrough","sources","callMediaLoad","thisSource","load","onProgressReplacementInterval","setInterval","isError","duration","currentTime","paused","play","clearInterval","pause","pluginName","callback","status","resource","id","getAttribute","srcset","removeAttribute","set","data","info","output","format","extension","tag","consistent","formatCandidate","RegExp","test","matches64","match","tagName","toLowerCase","allTags","values","tags","decodeResource","_tag","createElement","IntersectionObserver","entries","observer","entry","root","rootMargin","threshold","observe","get","Loader","_collection","_collectionLoaded","_collectionInstances","_collectionPending","_resourcesLoaded","backgrounds","percentage","_progress","_loop","_abort","_loaded","_complete","_this3","sequentialMode","sequential","thisLoadId","thisLoadIndex","x","thisLoadInstance","done","aProgress","parseFloat","toFixed","thisResource","resources","thisInstance","abort","collection","_this4","collectedResources","findResources","err","item","settings","_key2","body","targetsExtended","targets","targetsFilter","targetsTags","children","targetSource","targetsBg","backgroundImage","url","$","jQuery","$window","pluginMethod","methodCollection","fn","originalUserOptions","early","earlyTimeout","onProgress","onLoad","onError","onComplete","isFunction","each","_this5","$element","uniqueMethodPluginName","timeout","progress","trigger","pluginPrefix","eventName","off","thisMethodCollection","is","on","wait","context","callbackArgs","later","setTimeout","throttle","breakLoop","clearTimeout","parseInt","isNaN","isFinite"],"mappings":"AAAA,aAEA,IAAIA,aAAe,WAAc,SAASC,EAAiBC,EAAQC,GAAS,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,IAAIE,EAAaH,EAAMC,GAAIE,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAAiB,OAAO,SAAUO,EAAaC,EAAYC,GAAiJ,OAA9HD,GAAYb,EAAiBY,EAAYG,UAAWF,GAAiBC,GAAad,EAAiBY,EAAaE,GAAqBF,GAA7gB,GAEfI,SAAWP,OAAOQ,QAAU,SAAUhB,GAAU,IAAK,IAAIE,EAAI,EAAGA,EAAIe,UAAUd,OAAQD,IAAK,CAAE,IAAIgB,EAASD,UAAUf,GAAI,IAAK,IAAIQ,KAAOQ,EAAcV,OAAOM,UAAUK,eAAeC,KAAKF,EAAQR,KAAQV,EAAOU,GAAOQ,EAAOR,IAAY,OAAOV,GAEnPqB,QAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAUC,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAXF,QAAyBE,EAAIC,cAAgBH,QAAUE,IAAQF,OAAOR,UAAY,gBAAkBU,GAEtQ,SAASE,gBAAgBC,EAAUhB,GAAe,KAAMgB,aAAoBhB,GAAgB,MAAM,IAAIiB,UAAU,qCAEhH,SAASC,mBAAmBC,GAAO,GAAIC,MAAMC,QAAQF,GAAM,CAAE,IAAK,IAAI5B,EAAI,EAAG+B,EAAOF,MAAMD,EAAI3B,QAASD,EAAI4B,EAAI3B,OAAQD,IAAO+B,EAAK/B,GAAK4B,EAAI5B,GAAM,OAAO+B,EAAe,OAAOF,MAAMG,KAAKJ,IAE1L,SAAWK,EAAQC,GACoD,YAAlD,oBAAZC,QAA0B,YAAchB,QAAQgB,WAA4C,oBAAXC,OAAyBA,OAAOD,QAAUD,IAA8B,mBAAXG,QAAyBA,OAAOC,IAAMD,OAAO,aAAcH,GAAWD,EAAOM,WAAaL,IADjP,CAEGM,KAAM,WAOR,IAmLKC,EAnLDC,EAAqB,WACxB,OAAOC,KAAKC,MAAsB,KAAhBD,KAAKE,UAA4B,KAQhDC,EAAiB,SAAwBC,EAAUC,GACtD,OAAOC,OAAOrC,UAAUsC,SAAWH,EAASG,SAASF,IAA2C,IAAjCD,EAASI,QAAQH,EAAQ,IAQrFI,EAAmB,SAA0BL,EAAUC,GAC1D,OAAOC,OAAOrC,UAAUyC,WAAaN,EAASM,WAAWL,GAAUD,EAASO,OAAO,EAAGN,EAAO/C,UAAY+C,GAQtGO,EAAiB,SAAwBR,EAAUS,GACtD,OAAO3B,MAAMjB,UAAU6C,UAAYV,EAASU,UAAUD,GAAU,WAG/D,IAFA,IAAIvD,EAAS8C,EAAS9C,OAClByD,GAAS,IACJA,EAAQzD,GAChB,GAAIuD,EAAOT,EAASW,GAAQA,EAAOX,GAClC,OAAOW,EAGT,OAAQ,EARuD,IAgB7DC,EAAqB,SAA4BC,GACpD,OAAOA,EAAOC,QAAQ,YAAa,SAAUC,GAC5C,OAAOA,EAAE,GAAGC,iBAQVC,EAAa,SAAoBJ,GACpC,OAAOA,EAAOK,OAAO,GAAGF,cAAgBH,EAAOM,MAAM,IAOlDC,EAAkB,SAAyBC,GAC9C,SAAUC,OAAO1C,mBAAmByC,KAQjCE,EAAY,SAAmBtB,EAAQD,GAC1C,OAAOA,EAASI,QAAQH,IAAW,GAqBhCuB,KAEAC,EAAgC,yBAA0BC,OAC1DC,EAA0B,uBAAwBD,OAClDE,EAAiB,WAAYF,OAM7BG,EAAY,SAAmBC,GAClC,GAAIL,GAAiC,sBAAuBK,EAC3D,OAAOA,EAAQC,kBAAoB,EAGpC,GAAoD,SAAhDL,OAAOM,iBAAiBF,EAAS,WACpC,OAAO,EAGR,IAAIG,EAASC,SAASC,qBAAqB,QAAQ,GAC/CC,EAAWV,OAAOW,YAAcC,QAAQC,gBAAgBC,aAAeP,EAAOO,YAC9EC,EAAYf,OAAOgB,aAAeJ,QAAQC,gBAAgBI,cAAgBV,EAAOU,aACjFC,EAAOd,EAAQe,wBAEnB,QAASD,EAAKE,MAAQ,GAAKF,EAAKG,OAAS,GAAKH,EAAKI,KAAOZ,GAAYQ,EAAKK,IAAMR,IAO9ES,EAAgB,SAAuBpB,GAC1C,GAA0E,iBAAlD,IAAZA,EAA0B,YAAc1D,QAAQ0D,IAC3D,OAAO,EAER,IACC,OAAOA,aAAmBqB,YACzB,MAAOC,GACR,OAA4B,IAArBtB,EAAQuB,UAA6C,WAA3BjF,QAAQ0D,EAAQwB,QAA0D,WAAnClF,QAAQ0D,EAAQyB,iBAQtFC,EAAW,SAAkBvF,GAChC,MAAyB,iBAAXA,GAAuBsD,EAAUtD,EAAQuD,IAAiB0B,EAAcjF,IAAW,eAAgBA,GAAUA,EAAOwF,WAAWvG,OAAS,IAAM,aAAce,GAAUA,EAAOyF,UAAY,eAAgBzF,GAAUA,EAAO0F,YAAc,IAOnPC,EAAkB,SAAyBC,GAC9C,OAAOA,EAAMC,SAAS5G,QAAU0C,KAAKmE,MAAMF,EAAMC,SAASE,IAAI,IAAMpE,KAAKmE,MAAMF,EAAMI,SAASD,IAAI,KAAQ,GAcvGE,EAAiBvE,IAGjBwE,GACHC,MAAO,oEACPC,MAAO,0BACPC,MAAO,gBAEJC,GACHH,MAAO,qBACPC,MAAO,eACPC,MAAO,gBAGJE,KAEAC,EAAc/C,OAAO+C,eACpB/E,EAAY,SAAmBgF,EAAOC,GACzCA,EAASA,IAAYC,SAAS,EAAOC,YAAY,EAAOC,YAAQC,GAChE,IAAIC,EAAM9C,SAAS+C,YAAY,eAE/B,OADAD,EAAIE,gBAAgBR,EAAOC,EAAOC,QAASD,EAAOE,WAAYF,EAAOG,QAC9DE,IAEEnH,UAAY6D,OAAOyD,MAAMtH,UAC5B6B,GAQJ0F,EAAsB,SAASA,EAAoBtD,EAASuD,GAC/D,GAAKvD,GAA6B,iBAAXuD,EAIvB,GAAIhF,EAAiBgF,EAAQ,KAC5B,IAAK,IAAIC,KAAQd,EAAsB,CACtC,IAAIe,EAAyBD,EAAKxE,QAtCD,gBAsCwC,KACrEf,EAAewF,EAAwBF,IAAWb,EAAqBc,GAAMxD,UAAYA,GAC5FsD,EAAoBtD,EAASyD,OAGzB,CAGN,IAAIC,GAFJH,EAASA,EAAOI,MAAM,MAEJ,GACFJ,EAAO,KAGtBA,EAASA,EAAOK,KAlDiB,kBAqD9BL,KAAUb,IACb1C,EAAQ6D,oBAAoBH,EAAMhB,EAAqBa,GAAQO,gBACxDpB,EAAqBa,MAa3BQ,EAAsB,SAA6B/D,EAASuD,EAAQO,EAASE,GAChF,GAAKhE,GAA6B,iBAAXuD,GAA0C,mBAAZO,EAArD,CAMA,IAAIJ,GAFJH,EAASA,EAAOI,MAAM,MAEJ,GASlB,GARgBJ,EAAO,KAGtBA,EAASA,EAAOK,KA/EkB,kBAkFnClB,EAAqBa,IAAYvD,QAASA,EAASiE,MAAO,EAAGD,MAAM,IAE/D,IAASA,EAAM,CAClB,IAAIE,EAAWJ,EACfA,EAAU,SAAiBlB,GAC1B,GAAIW,KAAUb,EAAsB,CAEnC,GADAA,EAAqBa,GAAQU,QACzBvB,EAAqBa,GAAQS,MAAQtB,EAAqBa,GAAQU,MAAQ,EAC7E,OAEDC,EAAS7H,KAAKsB,KAAMiF,GAErBU,EAAoBtD,EAASuD,SAG9BS,GAAO,EAGRtB,EAAqBa,GAAUvH,YAAa0G,EAAqBa,IAAWO,QAASA,EAASE,KAAMA,IAEpGhE,EAAQmE,iBAAiBT,EAAMhB,EAAqBa,GAAQO,SAAWE,KAAMA,MAkF1EI,EAAe,WAIlB,SAASA,EAAaC,GACrB,IAAIC,EAAQ3G,KAWZ,GATAhB,gBAAgBgB,KAAMyG,GAEtBzG,KAAK4G,UAAYvI,UAChBwI,QAAS,WACTC,WAAY,cACZC,aAAa,EACbC,SAAS,GACPN,IAEE9F,EAAiBZ,KAAK4G,UAAUC,QAAS,WAAajG,EAAiBZ,KAAK4G,UAAUE,WAAY,SACtG,MAAM,IAAIG,MAAM,qFAGjBjH,KAAK6G,QAAU1F,EAAmBnB,KAAK4G,UAAUC,QAAQxF,QAAQ,QAAS,KAC1ErB,KAAK8G,WAAa3F,EAAmBnB,KAAK4G,UAAUE,WAAWzF,QAAQ,QAAS,KAEhFrB,KAAKkH,IAAM,KACXlH,KAAKmH,SAAW,KAChBnH,KAAKoH,OAAQ,EAEbpH,KAAKqH,SAAW,KAChBrH,KAAKsH,UAAY,KACjBtH,KAAKuH,QAAU,KACfvH,KAAKwH,UAAY,KAEjBxH,KAAKyH,MAAQ,aACbzH,KAAK0H,SAAW,aAChB1H,KAAK2H,OAAS,aAEd3H,KAAK4H,UAAY,SAAUjE,GAC1BgD,EAAMS,OAAQ,EACV,OAAST,EAAMa,WAClBb,EAAMa,UAAUK,UAAUlB,EAAMU,UAGjC,IAAIS,EAAMnB,EAAMU,SAASrD,YAAc2C,EAAMU,SAASS,IAEjDhG,EAAUgG,EAAK/F,IACnBA,EAAagG,KAAKD,GAGnB,IAAIE,GAAiBrB,EAAMU,SAAU1D,EAAEoC,KAAM+B,EAAKnB,EAAMO,KAExDP,EAAiB,UAAXhD,EAAEoC,KAAmB,WAAa,UAAUkC,MAAMtB,EAAOqB,GAC/DrB,EAAMc,MAAMQ,MAAMtB,EAAOqB,IAgR3B,OAvQA5K,aAAaqJ,IACZzI,IAAK,OAMLkK,MAAO,WACN,IApQ8B1J,EAoQ1B2J,EAASnI,KAWb,GAAI+D,EAAS/D,KAAKoI,SAAWpI,KAAKqI,YAAcrI,KAAKqH,SAAWrH,KAAKsH,WAQpE,OAPKtH,KAAKoH,OAETzB,EAAoB3F,KAAKqH,SAAU,IAAMrH,KAAKmH,UAG/CnH,KAAK4H,UAAU,IAAI5C,GArRUxG,EAqRYwB,KAAKoI,SAAWpI,KAAKqI,YAAcrI,KAAKqH,SAAWrH,KAAKsH,UApR7FvD,EAASvF,KAAYiF,EAAcjF,KAAY,iBAAkBA,GAA8C,IAApC2B,KAAKC,MAAM5B,EAAO8J,eAAuB,eAAgB9J,GAAgC,IAAtBA,EAAO+J,aAAuC,iBAAX/J,GAoR9D,QAAT,WAEvG,EACD,GAAIwB,KAAKoI,SAAWpI,KAAK4G,UAAUI,UAAY5E,EAAUpC,KAAKwI,kBACpE,OAAO,EAEP,GAAqB,UAAjBxI,KAAKuH,QAAqB,CAC7BnB,EAAoBpG,KAAKqH,SAAU,QAAUrH,KAAKmH,SAAUnH,KAAK4H,WAAY5H,KAAKoH,OAClFhB,EAAoBpG,KAAKqH,SAAU,SAAWrH,KAAKmH,SAAUnH,KAAK4H,WAAY5H,KAAKoH,OAEnF,IAAIqB,EAAUzI,KAAKqH,SAASqB,QAAQ,WAEhCD,GAAWvG,UACPlC,KAAKqH,SAASsB,QAAQ3I,KAAK8G,mBAC3B9G,KAAKqH,SAASsB,QAAQ3I,KAAK6G,SAElC4B,EAAQG,iBAAiB,UAAY5I,KAAK4G,UAAUE,WAAa,KAAK+B,QAAQ,SAAUC,GACvFA,EAAGC,aAAa,SAAUD,EAAGH,QAAQR,EAAOtB,iBACrCiC,EAAGH,QAAQR,EAAOtB,aAGtB7G,KAAKqH,SAAS2B,QAAQ,IAAMhJ,KAAK4G,UAAUE,WAAa,OAC3D9G,KAAKqH,SAAS0B,aAAa,SAAU/I,KAAKqH,SAASsB,QAAQ3I,KAAK8G,oBACzD9G,KAAKqH,SAASsB,QAAQ3I,KAAK8G,aAG/B9G,KAAKqH,SAAS2B,QAAQ,IAAMhJ,KAAK4G,UAAUC,QAAU,OACxD7G,KAAKqH,SAAS0B,aAAa,MAAO/I,KAAKqH,SAASsB,QAAQ3I,KAAK6G,iBACtD7G,KAAKqH,SAASsB,QAAQ3I,KAAK6G,eAG9B,CAAA,GAAqB,UAAjB7G,KAAKuH,SAAwC,UAAjBvH,KAAKuH,QA4F3C,OAAO,EA3FP,IAAI0B,GAAwB,IAASjJ,KAAK4G,UAAUG,YAChDmC,EAAoB,SAAWlJ,KAAK4G,UAAUG,YAC9CoC,EAAUnJ,KAAKqH,SAASuB,iBAAiB,UAEzCQ,GAAgB,EAEhBD,EACHA,EAAQN,QAAQ,SAAUrK,GACrBA,EAAOwK,QAAQ,IAAMb,EAAOvB,UAAUC,QAAU,OACnDrI,EAAOuK,aAAa,MAAOvK,EAAOmK,QAAQR,EAAOtB,iBAC1CrI,EAAOmK,QAAQR,EAAOrB,YAE7BsC,GAAgB,GAGjBhD,EAAoB5H,EAAQ,SAAW2J,EAAOhB,SAAU,SAAUxD,GAGjEnF,EAAOiG,EAAiB,sBAAwB,EAE5C0E,EAAQ1L,SAAWkE,EAAgBwH,GAASnI,OAAO,SAAUqI,GAChE,OAAO,IAASA,EAAW5E,EAAiB,uBAC1ChH,QACF0K,EAAOP,UAAUjE,KAEfwE,EAAOf,SAGFpH,KAAKqH,SAAS2B,QAAQ,IAAMhJ,KAAK4G,UAAUC,QAAU,OAC/D7G,KAAKqH,SAAS0B,aAAa,MAAO/I,KAAKqH,SAASsB,QAAQ3I,KAAK6G,iBACtD7G,KAAKqH,SAASsB,QAAQ3I,KAAK6G,SAElCT,EAAoBpG,KAAKqH,SAAU,SAAWrH,KAAKmH,SAAUnH,KAAK4H,WAAY5H,KAAKoH,OAGnFgC,GAAgB,GAGbA,GACHpJ,KAAKqH,SAASiC,OAGflD,EAAoBpG,KAAKqH,SAAU,kBAAoBrH,KAAKmH,SAAU,WAKrE,GAJK8B,GAA0BC,GAC9Bf,EAAOP,UAAU,IAAI5C,EAAY,SAG9BkE,EAAmB,CACtB,IAAIK,EAAgCC,YAAY,WAC/C,IAAIC,EAAUtB,EAAOd,SAASnD,WAAa,IAAMiE,EAAOd,SAASqC,SAE7DD,GAAWtF,EAAgBgE,EAAOd,WACrCc,EAAOd,SAASsC,YAAc,GAEzBF,IAAYtB,EAAOf,OAASe,EAAOd,SAASuC,QAAUzB,EAAOd,SAAS2B,QAAQ,eAClFb,EAAOd,SAASwC,OAGjBC,cAAcP,GAEdpB,EAAOP,UAAU,IAAI5C,EAAayE,EAAmB,QAAT,WAEvCtB,EAAOd,SAASuC,QACpBzB,EAAOd,SAAS0C,QAGZ5B,EAAOf,QACXe,EAAOd,SAASsC,aAAe,KAG/B,KAEHxB,EAAOd,SAAS2C,cAAmB7B,EAAOhB,UAAYoC,KAEpDvJ,KAAKoH,OAGThB,EAAoBpG,KAAKqH,SAAU,WAAarH,KAAKmH,SAAU,WAC1D+B,GAAqD,IAAhCf,EAAOd,SAASsC,cAAsBxF,EAAgBgE,EAAOd,WACrFc,EAAOd,SAASsC,gBAEd3J,KAAKoH,OAGThB,EAAoBpG,KAAKqH,SAAU,kBAAoBrH,KAAKmH,SAAU,WACjE8B,GACHd,EAAOP,UAAU,IAAI5C,EAAY,WAE/BhF,KAAKoH,OAaX,OAPMpH,KAAKoH,QACTpH,KAAKqH,SAAS5C,EAAiB,YAAczE,KAAKmH,UAIpDnH,KAAKsH,UAAYtH,KAAKqH,SAASrD,YAAchE,KAAKqH,SAASS,KAEnD9H,KAAKoH,SASdpJ,IAAK,OACLkK,MAAO,SAAc+B,GACI,mBAAbA,IAIXjK,KAAKyH,MAAQ,SAAUpF,EAAS6H,EAAQC,EAAUC,GACjDH,EAAShC,MAAMjI,MAAOqC,EAAS6H,EAAQC,EAAUC,SASnDpM,IAAK,QACLkK,MAAO,WAGN,GAFAvC,EAAoB3F,KAAKqH,SAAU,IAAMrH,KAAKmH,WAE1CpD,EAAS/D,KAAKoI,QAAUpI,KAAKqH,SAAWrH,KAAKsH,WAAjD,CAIA,IAAIQ,EAAM9H,KAAKqH,SAASgD,aAAa,UACjCC,EAAStK,KAAKqH,SAASgD,aAAa,YAEpC/E,IAAcwC,IACjB9H,KAAKqH,SAASsB,QAAQ3I,KAAK6G,SAAWiB,EACtC9H,KAAKqH,SAAS0B,aAAa/I,KAAK4G,UAAUC,QAASiB,GACnD9H,KAAKqH,SAASkD,gBAAgB,OAC9BvK,KAAKqH,SAASkD,gBAAgB,gBAG3BjF,IAAcgF,IACjBtK,KAAKqH,SAASsB,QAAQ3I,KAAK8G,YAAcwD,EACzCtK,KAAKqH,SAAS0B,aAAa/I,KAAK4G,UAAUE,WAAYwD,GACtDtK,KAAKqH,SAASkD,gBAAgB,OAC9BvK,KAAKqH,SAASkD,gBAAgB,eAIhCvM,IAAK,WACLwM,IAAK,SAAaC,GACjB,GAAoE,iBAA/C,IAATA,EAAuB,YAAc9L,QAAQ8L,KAAuB,OAAQA,GAAQ,YAAaA,GAAQ,aAAcA,EAAM,CACxIzK,KAAKkH,IAAMuD,EAAKL,GAChBpK,KAAKqH,SAAWoD,EAAKpI,QACrBrC,KAAKsH,UAAYmD,EAAKN,SAEtBnK,KAAKoH,WAA0B9B,IAAlBtF,KAAKmH,SAIlB,IAAIuD,EAnWa,SAAwBP,GAC5C,IAAIQ,GAAWC,OAAQ,KAAMC,UAAW,KAAMC,IAAK,KAAMC,YAAY,GAIrE,IAAK,IAAIC,KAFTb,EAASA,SAAWA,EAASA,SAASnE,MAAM,KAAK,GACjDmE,EAASA,SAAWA,EAASA,SAASnE,MAAM,KAAK,GACrBtB,EAG3B,GAAI,IAAIuG,OAAO,MAAQvG,EAAoBsG,GAAmB,eAAwB,KAAKE,KAAKf,EAASA,UAAW,CACnH,GAAI,IAAIc,OAHW,WAGW,KAAKC,KAAKf,EAASA,UAAW,CAC3D,IAAIgB,EAAYhB,EAASA,SAASiB,MAAM,IAAIH,OAAO,SAAWD,EAAkB,KAAOtG,EAAoBsG,GAAmB,IAAK,MAEnI,GAAI,OAASG,EACZ,OAGDA,EAAYA,EAAU,GAEtBR,EAAOC,OAASI,EAChBL,EAAOE,UAAYM,EAAU9J,QAAQ,QAAU2J,EAAkB,IAAK,IACtEL,EAAOG,IAAMhG,EAAckG,GAE3B,MAEA,IAAIhC,EAAUmB,EAASA,SAASiB,MAAM,IAAIH,OAAOvG,EAAoBsG,GAAkB,MAEvF,GAAIhC,EAAS,CACZ2B,EAAOC,OAASI,EAChBL,EAAOE,UAAY7B,EAAQ,GAC3B2B,EAAOG,IAAMhG,EAAckG,GAE3B,OAMJ,GAAIvH,EAAc0G,EAAS9H,SAAU,CACpC,IAAIgJ,EAAUlB,EAAS9H,QAAQgJ,QAAQC,cACnCC,EAAU,GAQd,GANAzN,OAAO0N,OAAO1G,GAAe+D,QAAQ,SAAU4C,GAC9CF,GAAW,IAAME,IAGlBF,EAAUA,EAAQvF,MAAM,KAEpBlE,EAAUuJ,EAASE,KACtBZ,EAAOG,IAAMO,EACbV,EAAOI,YAAa,EACE,OAAlBJ,EAAOC,QACV,IAAK,IAAIA,KAAU9F,EAClB,GAAIxE,EAAewE,EAAc8F,GAASD,EAAOG,KAAM,CACtDH,EAAOC,OAASA,EAChB,OAWL,OAJItK,EAAeqK,EAAOG,IAAK,OAC9BH,EAAOG,IAAMH,EAAOG,IAAI9E,MAAM,KAAK,IAG7B2E,EAkSOe,EACVvB,SAAUnK,KAAKsH,UACfjF,QAASrC,KAAKqH,WAEfrH,KAAK2L,KAAOjB,EAAKI,IACjB9K,KAAKqI,YAAcqC,EAAKK,WACxB/K,KAAKuH,QAAUmD,EAAKE,OACpB5K,KAAKoI,QAA4B,OAAlBpI,KAAKqH,SACpBrH,KAAKwI,iBAAmBxI,KAAKqH,SAExBrH,KAAKoI,SAAYpI,KAAKqI,cAC1BrI,KAAKqH,SAAW5E,SAASmJ,cAAc5L,KAAK2L,MAC5C3L,KAAKqH,SAASsB,QAAQ3I,KAAK6G,SAAW7G,KAAKsH,WAG5CtH,KAAKmH,SAAWnH,KAAKoH,MAAQpH,KAAKqH,SAAS5C,EAAiB,YAAcuF,qBAA0BhK,KAAKqH,SAASgE,QAAU,IAAMnL,IAI9HF,KAAKoI,SAAWpI,KAAK4G,UAAUI,SAAWhF,IAC7ChC,KAAKwH,UAAY,IAAIqE,qBAAqB,SAAUC,EAASC,GAC5DD,EAAQjD,QAAQ,SAAUmD,GACzB,OAAOA,EAAM1O,OAAOgF,kBAAoB0J,EAAM1J,sBAG/C2J,KAAM,KACNC,WAAY,MACZC,UAAW,KAEZnM,KAAKwH,UAAU4E,QAAQpM,KAAKwI,qBAS/B6D,IAAK,WACJ,OAAOrM,KAAKsH,cAIPb,EAnUW,GA+Uf6F,EAAS,WAIZ,SAASA,EAAO5F,GAiBf,GAhBA1H,gBAAgBgB,KAAMsM,GAEtBtM,KAAKuM,eACLvM,KAAKwM,qBACLxM,KAAKyM,wBACLzM,KAAK0M,sBACL1M,KAAK2M,oBAEL3M,KAAK4G,UAAYvI,UAChBwI,QAAS,WACTC,WAAY,cACZC,aAAa,EACbC,SAAS,EACT4F,aAAa,GACXlG,IAEE9F,EAAiBZ,KAAK4G,UAAUC,QAAS,WAAajG,EAAiBZ,KAAK4G,UAAUE,WAAY,SACtG,MAAM,IAAIG,MAAM,qFAGjBjH,KAAK6G,QAAU1F,EAAmBnB,KAAK4G,UAAUC,QAAQxF,QAAQ,QAAS,KAC1ErB,KAAK8G,WAAa3F,EAAmBnB,KAAK4G,UAAUE,WAAWzF,QAAQ,QAAS,KAEhFrB,KAAK6M,WAAa,EAElB7M,KAAKyH,MAAQ,aACbzH,KAAK8M,UAAY,aACjB9M,KAAK0H,SAAW,aAChB1H,KAAK2H,OAAS,aACd3H,KAAK+M,MAAQ/M,KAAKsJ,KAElBtJ,KAAKgN,QAAS,EACdhN,KAAKiN,QAAU,EACfjN,KAAKkN,WAAY,EACjBlN,KAAKoH,OAAQ,EAsUd,OA5TAhK,aAAakP,IACZtO,IAAK,OAMLkK,MAAO,WACN,IAAIiF,EAASnN,KAERA,KAAKuM,YAAY9O,QACrBuC,KAAKyH,MAAM/I,KAAKsB,KAAMA,KAAK2M,kBAI5B3M,KAAK0M,sBAiFL,IA/EA,IAAIU,GAAiB,IAASpN,KAAK4G,UAAUyG,WAEzCN,EAAQ,SAAevP,GAC1B,GAAI2P,EAAOH,OACV,MAAO,QAGR,IAAIM,EAAaH,EAAOZ,YAAY/O,GAAG4M,GACnCmD,EAAgBxM,EAAeoM,EAAOV,qBAAsB,SAAUe,GACzE,OAAOA,EAAEpD,KAAOkD,IAEbG,EAAmB,IAAIhH,EAAa0G,EAAOvG,YAExB,IAAnB2G,GACHJ,EAAOV,qBAAqB1E,MAC3BqC,GAAIkD,EACJrO,SAAUwO,IAEXF,EAAgBxM,EAAeoM,EAAOV,qBAAsB,SAAUe,GACrE,OAAOA,EAAEpD,KAAOkD,KAGjBH,EAAOV,qBAAqBc,GAAetO,SAAWwO,EAGvDA,EAAiBtD,SAAWgD,EAAOZ,YAAY/O,GAE/CiQ,EAAiBC,KAAK,SAAUrL,EAAS6H,EAAQC,EAAUC,GAC1D,IAAI+C,EAAOD,YAAaC,EAAOH,OAA/B,CAIA,IAAIW,GAAa7L,EAAUsI,EAAI+C,EAAOX,mBAEtC,GAAImB,EAAW,CACdR,EAAOX,kBAAkBzE,KAAKqC,GAC9B+C,EAAO/F,OAAQ,EAEf+F,EAAOF,UACPE,EAAON,WAAaM,EAAOF,QAAUE,EAAOZ,YAAY9O,OAAS,IACjE0P,EAAON,WAAae,WAAWT,EAAON,WAAWgB,QAAQ,IAEzD,IAAIC,GACH3D,SAAUA,EACVD,OAAQA,EACR7H,QAASA,GAEV8K,EAAOR,iBAAiB5E,KAAK+F,GAC7BX,EAAOL,UAAUpO,KAAKyO,EAAQW,GAC9BX,EAAkB,UAAXjD,EAAqB,WAAa,UAAUxL,KAAKyO,EAAQW,GAK7DX,EAAOF,UAAYE,EAAOZ,YAAY9O,QACzC0P,EAAO1F,MAAM/I,KAAKyO,EAAQA,EAAOR,kBAEjCQ,EAAOD,WAAY,GACTS,GAAaP,GAAkBD,EAAOT,mBAAmBjP,SACnE0P,EAAOT,mBAAqBS,EAAOT,mBAAmB1L,OAAO,SAAUwM,GACtE,OAAOA,EAAEpD,KAAOA,IAGb+C,EAAOT,mBAAmBjP,SAC7B0P,EAAO/F,MAAQ+F,EAAOT,mBAAmB,GAAGzN,SAASqK,aAKnD8D,GAAkBA,IAAmBD,EAAO/F,MAChD+F,EAAO/F,MAAQqG,EAAiBnE,OACtB8D,GAAkBD,EAAO/F,SAAW+F,EAAOvG,UAAUI,UAAYyG,EAAiBrF,SAAW+E,EAAOvG,UAAUI,SAAWyG,EAAiBrF,SAAWhG,EAAUqL,EAAiBjF,oBAC1L2E,EAAOT,mBAAmB3E,MACzBqC,GAAIkD,EACJrO,SAAUwO,KAKJjQ,EAAI,EAAGA,EAAIwC,KAAKuM,YAAY9O,OAAQD,IAAK,CAGjD,GAAa,UAFFuP,EAAMvP,GAEK,UAUxBQ,IAAK,OACLkK,MAAO,SAAc+B,GACI,mBAAbA,IAIXjK,KAAKyH,MAAQ,SAAUsG,GACtB9D,EAASvL,KAAKsB,KAAM+N,QAUtB/P,IAAK,WACLkK,MAAO,SAAkB+B,GACA,mBAAbA,IAIXjK,KAAK8M,UAAY,SAAU3C,GAC1BF,EAASvL,KAAKsB,KAAMmK,QAUtBnM,IAAK,UACLkK,MAAO,SAAiB+B,GACC,mBAAbA,IAIXjK,KAAK0H,SAAW,SAAUyC,GACzBF,EAASvL,KAAKsB,KAAMmK,QAUtBnM,IAAK,QACLkK,MAAO,SAAe+B,GACG,mBAAbA,IAIXjK,KAAK2H,OAAS,SAAUwC,GACvBF,EAASvL,KAAKsB,KAAMmK,QAStBnM,IAAK,QACLkK,MAAO,WACNlI,KAAKyM,qBAAqB5D,QAAQ,SAAUmF,GAC3CA,EAAa/O,SAASgP,UAGvBjO,KAAKgN,QAAS,KAGfhP,IAAK,aAMLwM,IAAK,SAAa0D,GACjB,IAAIC,EAASnO,KAEToO,EAAqBF,EAEzB,IACCE,EAAqB9B,EAAO+B,cAAcH,EAAYlO,KAAK4G,WAC1D,MAAO0H,IAETF,EAAmBvF,QAAQ,SAAU0F,GACpC,IAAIlM,GACH8H,SAAU,GACV9H,QAAS,KACT+H,GAAIlK,KAGL,GAAoB,iBAATqO,EACVlM,EAAQ8H,SAAWoE,MACb,CAAA,KAAoE,iBAA/C,IAATA,EAAuB,YAAc5P,QAAQ4P,KAAuB,aAAcA,GAGpG,OAFAlM,EAAUhE,YAAagE,EAASkM,GAKjCJ,EAAO5B,YAAYxE,KAAK1F,MAQ1BgK,IAAK,WACJ,OAAOrM,KAAKuM,iBAGbvO,IAAK,gBACLkK,MAAO,SAAuB7F,EAASqE,GACtC,IAAI8H,GACH3H,QAAS,MACTC,WAAY,SACZ8F,aAAa,GAGd,GAA0E,iBAAlD,IAAZvK,EAA0B,YAAc1D,QAAQ0D,UAA0BiD,IAAcoB,EACnG,IAAK,IAAI+H,KAASD,EACjB,GAAIC,KAASpM,EAAS,CACrBqE,EAAUrE,EACVA,OAAUiD,EACV,MASH,QAJIA,IAAcjD,GAAWA,IAAYI,WACxCJ,EAAUI,SAASiM,OAGfjL,EAAcpB,GAClB,MAAM,IAAI4E,MAAM,cAAgB5E,EAAU,gCAG3C,IAAI+L,KAEJI,EAAWnQ,YAAamQ,EAAU9H,GAElC,IACIiI,EAAkBC,qCAClBC,EAAgB,IAAML,EAAS3H,QAAU,OAAS2H,EAAS1H,WAAa,IAExEgI,EAAcnN,EAAgBU,EAAQuG,iBAJ5B,sBAkCd,GA5BIvG,EAAQ2G,QAAQ2F,IACnBG,EAAY/G,KAAK1F,IAGlByM,EAAcA,EAAY9N,OAAO,SAAU1D,GAC1C,IAAIyR,EAAWpN,EAAgBrE,EAAOyR,UAOtC,OAHAA,GAHAA,EAAWA,EAAS/N,OAAO,SAAUwM,GACpC,OAAOA,EAAExE,QAAQ2F,MAEE3N,OAAO,SAAUwM,GACpC,OAAOA,EAAExE,QAAQ6F,KAEXvR,EAAO0L,QAAQ6F,IAAkBE,EAAStR,UAEtCoL,QAAQ,SAAUvL,GAC7B,IAAI0R,EAAe1R,EAEd0R,EAAahG,QAAQ6F,KACzBG,EAAeA,EAAapG,iBAAiBiG,GAC7CG,KAAkBnN,OAAO1C,mBAAmB6P,IAAe,IAG5DZ,EAAmBrG,MAClB1F,QAAS/E,EACT6M,SAAU6E,EAAa3E,aAAamE,EAAS3H,UAAYmI,EAAa3E,aAAamE,EAAS1H,iBAI1F,IAAS0H,EAAS5B,YAAa,CAClC,IAAIqC,EAAYtN,EAAgBU,EAAQuG,iBAAiB,MACzDqG,EAAUlH,KAAK1F,IAIf4M,GAHAA,EAAYA,EAAUjO,OAAO,SAAU1D,GACtC,OAAQA,EAAO0L,QAAQ2F,MAEF3N,OAAO,SAAU1D,GACtC,MAAoD,SAA7CiF,iBAAiBjF,GAAQ4R,mBAEvBrG,QAAQ,SAAUvL,GAC3B,IAAI6R,EAAM5M,iBAAiBjF,GAAQ4R,gBAAgB9D,MAAM,aAErD,OAAS+D,GAAOA,EAAI1R,QAAU,GACjC2Q,EAAmBrG,MAClB1F,QAAS/E,EACT6M,SAAUgF,EAAI,GAAG9N,QAAQ,SAAU,QAMvC,OAAO+M,MAIF9B,EA7WK,GAmXb,GAAInK,EAAgB,CACnB,IAAIiN,EAAIC,OAEJC,EAAUF,EAAEnN,QAEhBmN,EAAE5N,EAj4Bc+N,eAi4BYjD,EAE5B,IAAIkD,KAEJJ,EAAEK,GAAe,SAAI,SAAU/I,GAC9B,IAAIgJ,EAAsBhJ,EAEgD,iBAAlD,IAAZA,EAA0B,YAAc/H,QAAQ+H,MAC3DA,MAGD,IAAI8H,EAAWnQ,UACdwI,QAAS,WACTC,WAAY,cAEZE,SAAS,EACTqG,YAAY,EAEZT,aAAa,EACb7F,aAAa,EAEb4I,OAAO,EACPC,aAAc,EAEdC,WAAY,aACZC,OAAQ,aACRC,QAAS,aAETC,WAAY,cACVtJ,GAECuD,EAAWuE,EAASwB,WAKxB,OAJIZ,EAAEa,WAAWP,KAChBzF,EAAWyF,GAGL1P,KAAKkQ,KAAK,SAAU1S,GAC1B,IAAI2S,EAASnQ,KAIToQ,EAAWhB,EAAEpP,MACbqQ,EAAyBnQ,IAAuB1C,EAChDiQ,EAAmB,IAAInB,EAAOkC,GAsDlC,GApDAf,EAAiBS,WAAalO,KAE9BwP,EAAiBzH,MAChBqC,GAAIiG,EACJpR,SAAUwO,EACVpL,QAASrC,KACTsQ,QAAS,OAGV7C,EAAiB8C,SAAS,SAAUpG,GACnCiF,EAAEjF,EAAS9H,SAASmO,QA17BL,OA07B4BhP,EAAW2I,EAASD,QAAU,SAAqBC,EAAS9H,QAAS8H,EAASA,WACzHiG,EAASI,QAAQC,qBAA4CN,EAAQhG,IAErE,IAAInC,GAAiByF,EAAkBtD,GAEJ,mBAAxBqE,EAASqB,YACnBrB,EAASqB,WAAW5H,MAAMkI,EAAQnI,GAGnC,IAAI0I,EAAYlP,EAAW2I,EAASD,QACM,mBAA/BsE,EAAS,KAAOkC,IAC1BlC,EAAS,KAAOkC,GAAWzI,MAAMkI,EAAQnI,KAI3CyF,EAAiBC,KAAK,SAAUK,GAC/BqC,EAASI,QAAQC,qBAA4CN,EAAQpC,IACrE9D,EAAShC,MAAMkI,GAAS1C,EAAkBM,IAEtCS,EAASxH,SACZsI,EAAQqB,IAAI,UAAYN,IAIzBb,EAAmBA,EAAiBxO,OAAO,SAAUwM,GACpD,OAAOA,EAAEpD,KAAOiG,KAEAxH,QAAQ,SAAU+H,GAC9BR,EAASS,GAAGD,EAAqBvO,UACpCuO,EAAqB3R,SAASqK,WAKjCmE,EAAiBnE,OAEbkF,EAASxH,SACZsI,EAAQwB,GAAG,UAAYT,EAljCZ,SAAkBpG,EAAU8G,GAC1C,IAAIC,EAAUzS,UAAUd,OAAS,QAAsB6H,IAAjB/G,UAAU,GAAmBA,UAAU,QAAK+G,EAE9EgL,EAAU,KACVW,EAAe,KACfC,EAAQ,WACXjH,EAAShC,MAAM+I,EAASC,GACxBX,EAAU,MAEX,OAAO,WACDA,IACJW,EAAe1S,UACf+R,EAAUa,WAAWD,EAAOH,KAsiCoBK,CAAS,WACvD,OAAO3D,EAAiBnE,QACtB,OAGA,IAASkF,EAASmB,MAAO,CAC5B,IAAI0B,GAAY,EAEhB7B,EAAiB3G,QAAQ,SAAU+H,GAClC,IAAIS,GAIA7B,EAAiBxR,KAAKoM,KAAOiG,EAAwB,CACxDiB,aAAaV,EAAqBN,SAElC,IAAIA,EAAUiB,SAAS/C,EAASoB,cAEhCgB,EAAqBN,QAAUa,WAAW,WAEzCP,EAAqB3R,SAAS2H,UAAUI,SAAU,EAClD4J,EAAqB3R,SAAS2H,UAAUyG,YAAa,EAErDuD,EAAqB3R,SAASqK,SAC3BkI,MAAMlB,IAAYmB,SAASnB,GAAWA,EAAU,GAEpDe,GAAY,SAQlB,OAAO/E","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define('niteLoader', factory) :\n\t(global.niteLoader = factory());\n}(this, (function () { 'use strict';\n\n\t/**\n\t * @returns {string}\n\t */\n\tconst generateInstanceID = () => {\n\t\treturn Math.floor(Math.random() * (9999 - 1000)) + 1000;\n\t};\n\n\t/**\n\t * @param {string} heystack\n\t * @param {string} needle\n\t * @returns {boolean}\n\t */\n\tconst stringContains = (heystack, needle) => {\n\t\treturn String.prototype.includes ? heystack.includes(needle) : heystack.indexOf(needle, 0) !== -1;\n\t};\n\n\t/**\n\t * @param {string} heystack\n\t * @param {string} needle\n\t * @returns {boolean}\n\t */\n\tconst stringStartsWith = (heystack, needle) => {\n\t\treturn String.prototype.startsWith ? heystack.startsWith(needle) : heystack.substr(0, needle.length) === needle;\n\t};\n\n\t/**\n\t * @param {Array} heystack\n\t * @param {Function} filter\n\t * @returns {number}\n\t */\n\tconst arrayFindIndex = (heystack, filter) => {\n\t\treturn Array.prototype.findIndex\n\t\t\t? heystack.findIndex(filter)\n\t\t\t: (() => {\n\t\t\t\t\tlet length = heystack.length,\n\t\t\t\t\t\tindex = -1;\n\t\t\t\t\twhile (++index < length) {\n\t\t\t\t\t\tif (filter(heystack[index], index, heystack)) {\n\t\t\t\t\t\t\treturn index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t  })();\n\t};\n\n\t/**\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tconst hyphensToCamelCase = string => {\n\t\treturn string.replace(/-([a-z])/g, g => g[1].toUpperCase());\n\t};\n\n\t/**\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tconst capitalize = string => {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t};\n\n\t/**\n\t * @param {NodeList} nodelist\n\t * @returns {Array}\n\t */\n\tconst nodelistToArray = nodelist => {\n\t\treturn [...nodelist];\n\t};\n\n\t/**\n\t * @param {String|number} needle\n\t * @param {Array} heystack\n\t * @returns {boolean}\n\t */\n\tconst isInArray = (needle, heystack) => {\n\t\treturn heystack.indexOf(needle) > -1;\n\t};\n\n\t// thanks https://gist.github.com/beaucharman/e46b8e4d03ef30480d7f4db5a78498ca\n\tconst throttle = (callback, wait, context = undefined) => {\n\t\tlet timeout = null;\n\t\tlet callbackArgs = null;\n\t\tconst later = () => {\n\t\t\tcallback.apply(context, callbackArgs);\n\t\t\ttimeout = null;\n\t\t};\n\t\treturn function() {\n\t\t\tif (!timeout) {\n\t\t\t\tcallbackArgs = arguments;\n\t\t\t\ttimeout = setTimeout(later, wait);\n\t\t\t}\n\t\t};\n\t};\n\n\tlet privateCache = [];\n\n\tconst intersectionObserverSupported = 'IntersectionObserver' in window;\n\tconst pictureElementSupported = 'HTMLPictureElement' in window;\n\tconst jQueryIncluded = 'jQuery' in window;\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @returns {boolean}\n\t */\n\tconst isVisible = element => {\n\t\tif (intersectionObserverSupported && 'intersectionRatio' in element) {\n\t\t\treturn element.intersectionRatio > 0;\n\t\t}\n\n\t\tif (window.getComputedStyle(element, 'display') === 'none') {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst bodyEl = document.getElementsByTagName('body')[0];\n\t\tconst winWidth = window.innerWidth || documnt.documentElement.clientWidth || bodyEl.clientWidth;\n\t\tconst winHeight = window.innerHeight || documnt.documentElement.clientHeight || bodyEl.clientHeight;\n\t\tconst rect = element.getBoundingClientRect();\n\n\t\treturn !(rect.right < 0 || rect.bottom < 0 || rect.left > winWidth || rect.top > winHeight);\n\t};\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @returns {boolean}\n\t */\n\tconst isHTMLElement = element => {\n\t\tif (typeof element !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\ttry {\n\t\t\treturn element instanceof HTMLElement;\n\t\t} catch (e) {\n\t\t\treturn element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object';\n\t\t}\n\t};\n\n\t/**\n\t * @param {(string|HTMLVideoElement|HTMLAudioElement|HTMLImageElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isLoaded = source => {\n\t\treturn (\n\t\t\t(typeof source === 'string' && isInArray(source, privateCache)) ||\n\t\t\t(isHTMLElement(source) &&\n\t\t\t\t('currentSrc' in source && source.currentSrc.length > 0) &&\n\t\t\t\t(('complete' in source && source.complete) || ('readyState' in source && source.readyState >= 2)))\n\t\t);\n\t};\n\n\t/**\n\t * @param {(HTMLVideoElement|HTMLAudioElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isFullyBuffered = media => {\n\t\treturn media.buffered.length && Math.round(media.buffered.end(0)) / Math.round(media.seekable.end(0)) === 1;\n\t};\n\n\t/**\n\t * @param {(string|HTMLElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isBroken = source => {\n\t\treturn (\n\t\t\tisLoaded(source) &&\n\t\t\t((isHTMLElement(source) && (('naturalWidth' in source && Math.floor(source.naturalWidth) === 0) || ('videoWidth' in source && source.videoWidth === 0))) ||\n\t\t\t\ttypeof source === 'string')\n\t\t);\n\t};\n\n\tconst pluginPrefix = 'nite';\n\tconst pluginMethod = pluginPrefix + 'Load';\n\tconst pluginName = pluginMethod + 'er';\n\tconst pluginInstance = generateInstanceID();\n\tconst eventNamespaceParserSeparator = '__namespace__';\n\n\tconst supportedExtensions = {\n\t\timage: 'jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg',\n\t\taudio: 'mp3|ogg|oga|spx|ogg|wav',\n\t\tvideo: 'mp4|ogv|webm'\n\t};\n\tconst supportedTags = {\n\t\timage: 'img|picture|source',\n\t\taudio: 'audio|source',\n\t\tvideo: 'video|source'\n\t};\n\n\tlet privateEventsStorage = {};\n\n\tconst CustomEvent =\n\t\twindow.CustomEvent ||\n\t\t(() => {\n\t\t\tconst _polyfill = (event, params) => {\n\t\t\t\tparams = params || { bubbles: false, cancelable: false, detail: undefined };\n\t\t\t\tconst evt = document.createEvent('CustomEvent');\n\t\t\t\tevt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n\t\t\t\treturn evt;\n\t\t\t};\n\t\t\t_polyfill.prototype = window.Event.prototype;\n\t\t\treturn _polyfill;\n\t\t})();\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @param {string} events\n\t * @returns {undefined}\n\t */\n\tconst detachEventListener = (element, events) => {\n\t\tif (!element || typeof events !== 'string') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (stringStartsWith(events, '.')) {\n\t\t\tfor (let key in privateEventsStorage) {\n\t\t\t\tconst eventNameWithNamespace = key.replace(eventNamespaceParserSeparator, '.');\n\t\t\t\tif (stringContains(eventNameWithNamespace, events) && privateEventsStorage[key].element === element) {\n\t\t\t\t\tdetachEventListener(element, eventNameWithNamespace);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tevents = events.split('.');\n\n\t\t\tconst type = events[0],\n\t\t\t\tnamespace = events[1];\n\n\t\t\tif (namespace) {\n\t\t\t\tevents = events.join(eventNamespaceParserSeparator);\n\t\t\t}\n\n\t\t\tif (events in privateEventsStorage) {\n\t\t\t\telement.removeEventListener(type, privateEventsStorage[events].handler);\n\t\t\t\tdelete privateEventsStorage[events];\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @param {string} events\n\t * @param {Function} handler\n\t * @param {boolean} once\n\t * @returns {undefined}\n\t */\n\t// TODO: Class EventListener .on .one .off .trigger jQuery-like...\n\tconst attachEventListener = (element, events, handler, once) => {\n\t\tif (!element || typeof events !== 'string' || typeof handler !== 'function') {\n\t\t\treturn;\n\t\t}\n\n\t\tevents = events.split('.');\n\n\t\tconst type = events[0];\n\t\tconst namespace = events[1];\n\n\t\tif (namespace) {\n\t\t\tevents = events.join(eventNamespaceParserSeparator);\n\t\t}\n\n\t\tprivateEventsStorage[events] = { element: element, count: 0, once: false };\n\n\t\tif (true === once) {\n\t\t\tlet _handler = handler;\n\t\t\thandler = function(event) {\n\t\t\t\tif (events in privateEventsStorage) {\n\t\t\t\t\tprivateEventsStorage[events].count++;\n\t\t\t\t\tif (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t_handler.call(this, event);\n\t\t\t\t}\n\t\t\t\tdetachEventListener(element, events);\n\t\t\t};\n\t\t} else {\n\t\t\tonce = false;\n\t\t}\n\n\t\tprivateEventsStorage[events] = {\n\t\t\t...privateEventsStorage[events],\n\t\t\t...{ handler: handler, once: once }\n\t\t};\n\n\t\telement.addEventListener(type, privateEventsStorage[events].handler, { once: once });\n\t};\n\n\t/**\n\t * @param {Object} resource\n\t * @returns {Object}\n\t */\n\tconst decodeResource = resource => {\n\t\tlet output = { format: null, extension: null, tag: null, consistent: false };\n\n\t\tresource.resource = resource.resource.split('?')[0];\n\t\tresource.resource = resource.resource.split('#')[0];\n\t\tfor (let formatCandidate in supportedExtensions) {\n\t\t\tconst base64Heading = ';base64,';\n\n\t\t\tif (new RegExp('(.(' + supportedExtensions[formatCandidate] + ')$)|' + base64Heading, 'g').test(resource.resource)) {\n\t\t\t\tif (new RegExp(base64Heading, 'g').test(resource.resource)) {\n\t\t\t\t\tlet matches64 = resource.resource.match(new RegExp('^data:' + formatCandidate + '/(' + supportedExtensions[formatCandidate] + ')', 'g'));\n\n\t\t\t\t\tif (null === matches64) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmatches64 = matches64[0];\n\n\t\t\t\t\toutput.format = formatCandidate;\n\t\t\t\t\toutput.extension = matches64.replace('data:' + formatCandidate + '/', '');\n\t\t\t\t\toutput.tag = supportedTags[formatCandidate];\n\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tlet matches = resource.resource.match(new RegExp(supportedExtensions[formatCandidate], 'g'));\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\toutput.format = formatCandidate;\n\t\t\t\t\t\toutput.extension = matches[0];\n\t\t\t\t\t\toutput.tag = supportedTags[formatCandidate];\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isHTMLElement(resource.element)) {\n\t\t\tlet tagName = resource.element.tagName.toLowerCase();\n\t\t\tlet allTags = '';\n\n\t\t\tObject.values(supportedTags).forEach(tags => {\n\t\t\t\tallTags += '|' + tags;\n\t\t\t});\n\n\t\t\tallTags = allTags.split('|');\n\n\t\t\tif (isInArray(tagName, allTags)) {\n\t\t\t\toutput.tag = tagName;\n\t\t\t\toutput.consistent = true;\n\t\t\t\tif (output.format === null) {\n\t\t\t\t\tfor (let format in supportedTags) {\n\t\t\t\t\t\tif (stringContains(supportedTags[format], output.tag)) {\n\t\t\t\t\t\t\toutput.format = format;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (stringContains(output.tag, '|')) {\n\t\t\toutput.tag = output.tag.split('|')[0];\n\t\t}\n\n\t\treturn output;\n\t};\n\n\t// TODO: Promise support\n\t// TODO: think about useful vars in callback args (this class is not public but its vars are returned in .progress() callback)\n\t/** TODO: description of the MyClass constructor function.\n\t * @class\n\t * @classdesc TODO: description of the SingleLoader class.\n\t */\n\tclass SingleLoader {\n\t\t/**\n\t\t * @param {Object} [options={ srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false }]\n\t\t */\n\t\tconstructor(options) {\n\t\t\tthis._settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\t\t\t\t\tplaythrough: false,\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tif (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n\t\t\t\tthrow new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n\t\t\t}\n\n\t\t\tthis.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n\t\t\tthis.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n\t\t\tthis._id = null;\n\t\t\tthis._idEvent = null;\n\t\t\tthis._busy = false;\n\n\t\t\tthis._element = null;\n\t\t\tthis._resource = null;\n\t\t\tthis._format = null;\n\t\t\tthis._observer = null;\n\n\t\t\tthis._done = () => {};\n\t\t\tthis._success = () => {};\n\t\t\tthis._error = () => {};\n\n\t\t\tthis._callback = e => {\n\t\t\t\tthis._busy = false;\n\t\t\t\tif (null !== this._observer) {\n\t\t\t\t\tthis._observer.unobserve(this._element);\n\t\t\t\t}\n\n\t\t\t\tconst src = this._element.currentSrc || this._element.src;\n\n\t\t\t\tif (!isInArray(src, privateCache)) {\n\t\t\t\t\tprivateCache.push(src);\n\t\t\t\t}\n\n\t\t\t\tlet thisArguments = [this._element, e.type, src, this._id];\n\n\t\t\t\tthis[e.type !== 'error' ? '_success' : '_error'].apply(this, thisArguments);\n\t\t\t\tthis._done.apply(this, thisArguments);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Object} data\n\t\t */\n\t\tset resource(data) {\n\t\t\tif (typeof data === 'object' && 'id' in data && 'element' in data && 'resource' in data) {\n\t\t\t\tthis._id = data.id;\n\t\t\t\tthis._element = data.element;\n\t\t\t\tthis._resource = data.resource;\n\n\t\t\t\tthis._busy = this._idEvent !== undefined;\n\n\t\t\t\t// TODO: FIXME: if this.busy, ottieni tutte le variabili seguenti da una cache.\n\n\t\t\t\tlet info = decodeResource({\n\t\t\t\t\tresource: this._resource,\n\t\t\t\t\telement: this._element\n\t\t\t\t});\n\t\t\t\tthis._tag = info.tag;\n\t\t\t\tthis._consistent = info.consistent; // wrong tag for resource type...\n\t\t\t\tthis._format = info.format;\n\t\t\t\tthis._exists = this._element !== null;\n\t\t\t\tthis._originalElement = this._element;\n\n\t\t\t\tif (!this._exists || !this._consistent) {\n\t\t\t\t\tthis._element = document.createElement(this._tag);\n\t\t\t\t\tthis._element.dataset[this.srcAttr] = this._resource;\n\t\t\t\t}\n\n\t\t\t\tthis._idEvent = this._busy ? this._element[pluginInstance + '_IDEvent'] : pluginName + '_unique_' + this._element.tagName + '_' + generateInstanceID();\n\n\t\t\t\t//TODO: FIXME: this._lazy = this._busy ? this._lazy : !!(this._element.dataset[this.srcAttr] || this._element.dataset[this.srcsetAttr]);\n\n\t\t\t\tif (this._exists && this._settings.visible && intersectionObserverSupported) {\n\t\t\t\t\tthis._observer = new IntersectionObserver(\n\t\t\t\t\t\t(entries, observer) => {\n\t\t\t\t\t\t\tentries.forEach(entry => (entry.target.intersectionRatio = entry.intersectionRatio));\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troot: null,\n\t\t\t\t\t\t\trootMargin: '0px',\n\t\t\t\t\t\t\tthreshold: 0.1\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tthis._observer.observe(this._originalElement);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @returns {string}\n\t\t */\n\t\tget resource() {\n\t\t\treturn this._resource;\n\t\t}\n\n\t\t/**\n\t\t * @returns {boolean} se ha preso in carico il caricamento oppure no per vari motivi (è già caricato, non è nella viewport etc)\n\t\t */\n\t\tload() {\n\t\t\t// TODO: FIXME: (3) check for placeholders / non-lazy resources\n\t\t\t// if isLoaded(this._exists && this._consistent ? this._element : this._resource) &&\n\t\t\t// (\n\t\t\t//    ( this._lazy && ( data-xyz-src === src || data-xyz-srcset === srcset ) ) // TODO: capire come\n\t\t\t//    ||\n\t\t\t//    !this._lazy\n\t\t\t// )\n\n\t\t\t//TODO: remove elseif else when returning?\n\t\t\tif (isLoaded(this._exists && this._consistent ? this._element : this._resource)) {\n\t\t\t\tif (!this._busy) {\n\t\t\t\t\t// TODO: mayabe this should be called in this._callback\n\t\t\t\t\tdetachEventListener(this._element, '.' + this._idEvent);\n\t\t\t\t}\n\n\t\t\t\tthis._callback(new CustomEvent(!isBroken(this._exists && this._consistent ? this._element : this._resource) ? 'load' : 'error'));\n\n\t\t\t\treturn false;\n\t\t\t} else if (this._exists && this._settings.visible && !isVisible(this._originalElement)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (this._format === 'image') {\n\t\t\t\t\tattachEventListener(this._element, 'load.' + this._idEvent, this._callback, !this._busy);\n\t\t\t\t\tattachEventListener(this._element, 'error.' + this._idEvent, this._callback, !this._busy);\n\n\t\t\t\t\tconst picture = this._element.closest('picture');\n\n\t\t\t\t\tif (picture && pictureElementSupported) {\n\t\t\t\t\t\tdelete this._element.dataset[this.srcsetAttr];\n\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\n\t\t\t\t\t\tpicture.querySelectorAll('source[' + this._settings.srcsetAttr + ']').forEach(el => {\n\t\t\t\t\t\t\tel.setAttribute('srcset', el.dataset[this.srcAttr]);\n\t\t\t\t\t\t\tdelete el.dataset[this.srcAttr];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this._element.matches('[' + this._settings.srcsetAttr + ']')) {\n\t\t\t\t\t\t\tthis._element.setAttribute('srcset', this._element.dataset[this.srcsetAttr]);\n\t\t\t\t\t\t\tdelete this._element.dataset[this.srcsetAttr];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this._element.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\t\tthis._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n\t\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (this._format === 'video' || this._format === 'audio') {\n\t\t\t\t\tconst isStandardPlaythrough = true === this._settings.playthrough;\n\t\t\t\t\tconst isFullPlaythrough = 'full' === this._settings.playthrough;\n\t\t\t\t\tconst sources = this._element.querySelectorAll('source');\n\n\t\t\t\t\tlet callMediaLoad = false;\n\n\t\t\t\t\tif (sources) {\n\t\t\t\t\t\tsources.forEach(source => {\n\t\t\t\t\t\t\tif (source.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\t\t\tsource.setAttribute('src', source.dataset[this.srcAttr]);\n\t\t\t\t\t\t\t\tdelete source.dataset[this.srcsetAttr];\n\n\t\t\t\t\t\t\t\tcallMediaLoad = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\t\t'error.' + this._idEvent,\n\t\t\t\t\t\t\t\te => {\n\t\t\t\t\t\t\t\t\tconst sourcesErrorId = pluginName + '_error';\n\n\t\t\t\t\t\t\t\t\tsource[pluginInstance + '_' + sourcesErrorId] = true;\n\n\t\t\t\t\t\t\t\t\tif (sources.length === nodelistToArray(sources).filter(thisSource => true === thisSource[pluginInstance + '_' + sourcesErrorId]).length) {\n\t\t\t\t\t\t\t\t\t\tthis._callback(e);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (this._element.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\tthis._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\n\t\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t\t'error.' + this._idEvent,\n\t\t\t\t\t\t\tthis._callback,\n\t\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tcallMediaLoad = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (callMediaLoad) {\n\t\t\t\t\t\tthis._element.load();\n\t\t\t\t\t}\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'loadedmetadata.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (!isStandardPlaythrough && !isFullPlaythrough) {\n\t\t\t\t\t\t\t\tthis._callback(new CustomEvent('load'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (isFullPlaythrough) {\n\t\t\t\t\t\t\t\tlet onProgressReplacementInterval = setInterval(() => {\n\t\t\t\t\t\t\t\t\tlet isError = this._element.readyState > 0 && !this._element.duration;\n\n\t\t\t\t\t\t\t\t\tif (isError || isFullyBuffered(this._element)) {\n\t\t\t\t\t\t\t\t\t\tthis._element.currentTime = 0;\n\n\t\t\t\t\t\t\t\t\t\tif (!isError && !this._busy && this._element.paused && this._element.matches('[autoplay]')) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.play();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tclearInterval(onProgressReplacementInterval);\n\n\t\t\t\t\t\t\t\t\t\tthis._callback(new CustomEvent(!isError ? 'load' : 'error'));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (!this._element.paused) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.pause();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!this._busy) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.currentTime += 2;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\t\t\tthis._element[pluginName + '_' + this._idEvent] = onProgressReplacementInterval;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'canplay.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (isFullPlaythrough && this._element.currentTime === 0 && !isFullyBuffered(this._element)) {\n\t\t\t\t\t\t\t\tthis._element.currentTime++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'canplaythrough.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (isStandardPlaythrough) {\n\t\t\t\t\t\t\t\tthis._callback(new CustomEvent('load'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!this._busy) {\n\t\t\t\t\tthis._element[pluginInstance + '_IDEvent'] = this._idEvent;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._resource = this._element.currentSrc || this._element.src;\n\n\t\t\treturn !this._busy;\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tdone(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._done = function(element, status, resource, id) {\n\t\t\t\tcallback.apply(this, [element, status, resource, id]);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tabort() {\n\t\t\tdetachEventListener(this._element, '.' + this._idEvent);\n\n\t\t\tif (isLoaded(this._exists ? this._element : this._resource)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst src = this._element.getAttribute('srcset'),\n\t\t\t\tsrcset = this._element.getAttribute('src');\n\n\t\t\tif (undefined !== src) {\n\t\t\t\tthis._element.dataset[this.srcAttr] = src;\n\t\t\t\tthis._element.setAttribute(this._settings.srcAttr, src);\n\t\t\t\tthis._element.removeAttribute('src');\n\t\t\t\tthis._element.removeAttribute('srcset');\n\t\t\t}\n\n\t\t\tif (undefined !== srcset) {\n\t\t\t\tthis._element.dataset[this.srcsetAttr] = srcset;\n\t\t\t\tthis._element.setAttribute(this._settings.srcsetAttr, srcset);\n\t\t\t\tthis._element.removeAttribute('src');\n\t\t\t\tthis._element.removeAttribute('srcset');\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: Promise support\n\t// TODO: private vars\n\t// TODO: refactory succes/done/progress code...\n\t/** TODO: description of the MyClass constructor function.\n\t * @class\n\t * @classdesc TODO: description of the Loader class.\n\t */\n\tclass Loader {\n\t\t/**\n\t\t * @param {Object} [options={srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false, backgrounds: false }]\n\t\t */\n\t\tconstructor(options) {\n\t\t\tthis._collection = [];\n\t\t\tthis._collectionLoaded = [];\n\t\t\tthis._collectionInstances = [];\n\t\t\tthis._collectionPending = [];\n\t\t\tthis._resourcesLoaded = [];\n\n\t\t\tthis._settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\t\t\t\t\tplaythrough: false,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tbackgrounds: false\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tif (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n\t\t\t\tthrow new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n\t\t\t}\n\n\t\t\tthis.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n\t\t\tthis.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n\t\t\tthis.percentage = 0;\n\n\t\t\tthis._done = () => {};\n\t\t\tthis._progress = () => {};\n\t\t\tthis._success = () => {};\n\t\t\tthis._error = () => {};\n\t\t\tthis._loop = this.load;\n\n\t\t\tthis._abort = false;\n\t\t\tthis._loaded = 0;\n\t\t\tthis._complete = false;\n\t\t\tthis._busy = false;\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param {HTMLElement} [element=document.body]\n\t\t * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n\t\t */\n\t\tstatic findResources(element, options) {\n\t\t\tlet settings = {\n\t\t\t\tsrcAttr: 'src',\n\t\t\t\tsrcsetAttr: 'srcset',\n\t\t\t\tbackgrounds: false\n\t\t\t};\n\n\t\t\tif (typeof element === 'object' && undefined === options) {\n\t\t\t\tfor (let key in settings) {\n\t\t\t\t\tif (key in element) {\n\t\t\t\t\t\toptions = element;\n\t\t\t\t\t\telement = undefined;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (undefined === element || element === document) {\n\t\t\t\telement = document.body;\n\t\t\t}\n\n\t\t\tif (!isHTMLElement(element)) {\n\t\t\t\tthrow new Error('TypeError: ' + element + ' is not of type HTMLElement.');\n\t\t\t}\n\n\t\t\tlet collectedResources = [];\n\n\t\t\tsettings = {\n\t\t\t\t...settings,\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tconst targets = 'img, video, audio';\n\t\t\tconst targetsExtended = targets + ', picture, source';\n\t\t\tconst targetsFilter = '[' + settings.srcAttr + '], [' + settings.srcsetAttr + ']';\n\n\t\t\tlet targetsTags = nodelistToArray(element.querySelectorAll(targets));\n\n\t\t\tif (element.matches(targetsExtended)) {\n\t\t\t\ttargetsTags.push(element);\n\t\t\t}\n\n\t\t\ttargetsTags = targetsTags.filter(target => {\n\t\t\t\tlet children = nodelistToArray(target.children);\n\t\t\t\tchildren = children.filter(x => x.matches(targetsExtended));\n\t\t\t\tchildren = children.filter(x => x.matches(targetsFilter));\n\t\t\t\treturn target.matches(targetsFilter) || children.length;\n\t\t\t});\n\t\t\ttargetsTags.forEach(target => {\n\t\t\t\tlet targetSource = target;\n\n\t\t\t\tif (!targetSource.matches(targetsFilter)) {\n\t\t\t\t\ttargetSource = targetSource.querySelectorAll(targetsFilter);\n\t\t\t\t\ttargetSource = [...targetSource][0];\n\t\t\t\t}\n\n\t\t\t\tcollectedResources.push({\n\t\t\t\t\telement: target,\n\t\t\t\t\tresource: targetSource.getAttribute(settings.srcAttr) || targetSource.getAttribute(settings.srcsetAttr)\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (true === settings.backgrounds) {\n\t\t\t\tlet targetsBg = nodelistToArray(element.querySelectorAll('*'));\n\t\t\t\ttargetsBg.push(element);\n\t\t\t\ttargetsBg = targetsBg.filter(target => !target.matches(targetsExtended));\n\t\t\t\ttargetsBg = targetsBg.filter(target => getComputedStyle(target).backgroundImage !== 'none');\n\t\t\t\ttargetsBg.forEach(target => {\n\t\t\t\t\tconst url = getComputedStyle(target).backgroundImage.match(/\\((.*?)\\)/);\n\n\t\t\t\t\tif (null !== url && url.length >= 2) {\n\t\t\t\t\t\tcollectedResources.push({\n\t\t\t\t\t\t\telement: target,\n\t\t\t\t\t\t\tresource: url[1].replace(/('|\")/g, '')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn collectedResources;\n\t\t}\n\n\t\t/**\n\t\t * @param {(Array.<String>|HTMLElement)} collection\n\t\t */\n\t\tset collection(collection) {\n\t\t\tlet collectedResources = collection;\n\n\t\t\ttry {\n\t\t\t\tcollectedResources = Loader.findResources(collection, this._settings);\n\t\t\t} catch (err) {}\n\n\t\t\tcollectedResources.forEach(item => {\n\t\t\t\tlet element = {\n\t\t\t\t\tresource: '',\n\t\t\t\t\telement: null,\n\t\t\t\t\tid: generateInstanceID()\n\t\t\t\t};\n\n\t\t\t\tif (typeof item === 'string') {\n\t\t\t\t\telement.resource = item;\n\t\t\t\t} else if (typeof item === 'object' && 'resource' in item) {\n\t\t\t\t\telement = { ...element, ...item };\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._collection.push(element);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @returns {Array} collection\n\t\t */\n\t\tget collection() {\n\t\t\treturn this._collection;\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tload() {\n\t\t\tif (!this._collection.length) {\n\t\t\t\tthis._done.call(this, this._resourcesLoaded);\n\t\t\t}\n\n\t\t\t// resets pending elements (sequential opt helper array) every time we loop\n\t\t\tthis._collectionPending = [];\n\n\t\t\tconst sequentialMode = true === this._settings.sequential;\n\n\t\t\tfor (let i = 0; i < this._collection.length; i++) {\n\t\t\t\tif (this._abort) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tlet thisLoadId = this._collection[i].id;\n\t\t\t\tlet thisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n\t\t\t\tlet thisLoadInstance = new SingleLoader(this._settings);\n\n\t\t\t\tif (thisLoadIndex === -1) {\n\t\t\t\t\tthis._collectionInstances.push({\n\t\t\t\t\t\tid: thisLoadId,\n\t\t\t\t\t\tinstance: thisLoadInstance\n\t\t\t\t\t});\n\t\t\t\t\tthisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n\t\t\t\t} else {\n\t\t\t\t\tthis._collectionInstances[thisLoadIndex].instance = thisLoadInstance;\n\t\t\t\t}\n\n\t\t\t\tthisLoadInstance.resource = this._collection[i];\n\n\t\t\t\tthisLoadInstance.done((element, status, resource, id) => {\n\t\t\t\t\tif (this._complete || this._abort) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst aProgress = !isInArray(id, this._collectionLoaded);\n\n\t\t\t\t\tif (aProgress) {\n\t\t\t\t\t\tthis._collectionLoaded.push(id);\n\t\t\t\t\t\tthis._busy = false;\n\n\t\t\t\t\t\tthis._loaded++;\n\t\t\t\t\t\tthis.percentage = (this._loaded / this._collection.length) * 100;\n\t\t\t\t\t\tthis.percentage = parseFloat(this.percentage.toFixed(4));\n\n\t\t\t\t\t\tconst thisResource = {\n\t\t\t\t\t\t\tresource: resource,\n\t\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\t\telement: element\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis._resourcesLoaded.push(thisResource);\n\t\t\t\t\t\tthis._progress.call(this, thisResource);\n\t\t\t\t\t\tthis[status !== 'error' ? '_success' : '_error'].call(this, thisResource);\n\t\t\t\t\t\t// TODO: dispatch event on element maybe?\n\t\t\t\t\t\t// element.dispatchEvent(new CustomEvent(pluginPrefix + capitalize(status) + '.' + pluginPrefix));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._loaded === this._collection.length) {\n\t\t\t\t\t\tthis._done.call(this, this._resourcesLoaded);\n\n\t\t\t\t\t\tthis._complete = true;\n\t\t\t\t\t} else if (aProgress && sequentialMode && this._collectionPending.length) {\n\t\t\t\t\t\tthis._collectionPending = this._collectionPending.filter(x => x.id !== id);\n\n\t\t\t\t\t\tif (this._collectionPending.length) {\n\t\t\t\t\t\t\tthis._busy = this._collectionPending[0].instance.load();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!sequentialMode || (sequentialMode && !this._busy)) {\n\t\t\t\t\tthis._busy = thisLoadInstance.load();\n\t\t\t\t} else if (\n\t\t\t\t\tsequentialMode &&\n\t\t\t\t\tthis._busy &&\n\t\t\t\t\t(!this._settings.visible || !thisLoadInstance._exists || (this._settings.visible && thisLoadInstance._exists && isVisible(thisLoadInstance._originalElement)))\n\t\t\t\t) {\n\t\t\t\t\tthis._collectionPending.push({\n\t\t\t\t\t\tid: thisLoadId,\n\t\t\t\t\t\tinstance: thisLoadInstance\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tdone(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._done = function(resources) {\n\t\t\t\tcallback.call(this, resources);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tprogress(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._progress = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tsuccess(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._success = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\terror(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._error = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tabort() {\n\t\t\tthis._collectionInstances.forEach(thisInstance => {\n\t\t\t\tthisInstance.instance.abort();\n\t\t\t});\n\n\t\t\tthis._abort = true;\n\t\t}\n\t}\n\n\t// TODO: think about a better and more elegant module-oriented way\n\tif (jQueryIncluded) {\n\t\tconst $ = jQuery;\n\n\t\tconst $window = $(window);\n\n\t\t$[capitalize(pluginName)] = Loader;\n\n\t\tlet methodCollection = [];\n\n\t\t$.fn[pluginMethod] = function(options) {\n\t\t\tlet originalUserOptions = options;\n\n\t\t\tif (typeof options !== 'object') {\n\t\t\t\toptions = {};\n\t\t\t}\n\n\t\t\tlet settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tsequential: false,\n\n\t\t\t\t\tbackgrounds: false,\n\t\t\t\t\tplaythrough: false,\n\n\t\t\t\t\tearly: false,\n\t\t\t\t\tearlyTimeout: 0,\n\n\t\t\t\t\tonProgress: () => {},\n\t\t\t\t\tonLoad: () => {},\n\t\t\t\t\tonError: () => {},\n\n\t\t\t\t\tonComplete: () => {}\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tlet callback = settings.onComplete;\n\t\t\tif ($.isFunction(originalUserOptions)) {\n\t\t\t\tcallback = originalUserOptions;\n\t\t\t}\n\n\t\t\treturn this.each(function(i) {\n\t\t\t\t// TODO: mutation observer when new children are appended\n\n\t\t\t\tconst $element = $(this);\n\t\t\t\tconst uniqueMethodPluginName = generateInstanceID() + i;\n\t\t\t\tconst thisLoadInstance = new Loader(settings);\n\n\t\t\t\tthisLoadInstance.collection = this;\n\n\t\t\t\tmethodCollection.push({\n\t\t\t\t\tid: uniqueMethodPluginName,\n\t\t\t\t\tinstance: thisLoadInstance,\n\t\t\t\t\telement: this,\n\t\t\t\t\ttimeout: null\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.progress(resource => {\n\t\t\t\t\t$(resource.element).trigger(pluginPrefix + capitalize(resource.status) + '.' + pluginPrefix, [resource.element, resource.resource]);\n\t\t\t\t\t$element.trigger(pluginPrefix + 'Progress.' + pluginPrefix, [this, resource]);\n\n\t\t\t\t\tconst thisArguments = [thisLoadInstance, resource];\n\n\t\t\t\t\tif (typeof settings.onProgress === 'function') {\n\t\t\t\t\t\tsettings.onProgress.apply(this, thisArguments);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet eventName = capitalize(resource.status);\n\t\t\t\t\tif (typeof settings['on' + eventName] === 'function') {\n\t\t\t\t\t\tsettings['on' + eventName].apply(this, thisArguments);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.done(resources => {\n\t\t\t\t\t$element.trigger(pluginPrefix + 'Complete.' + pluginPrefix, [this, resources]);\n\t\t\t\t\tcallback.apply(this, [thisLoadInstance, resources]);\n\n\t\t\t\t\tif (settings.visible) {\n\t\t\t\t\t\t$window.off('scroll.' + uniqueMethodPluginName);\n\t\t\t\t\t}\n\n\t\t\t\t\t// refresh other method calls for same el (omitting this one)\n\t\t\t\t\tmethodCollection = methodCollection.filter(x => x.id !== uniqueMethodPluginName);\n\t\t\t\t\tmethodCollection.forEach(thisMethodCollection => {\n\t\t\t\t\t\tif ($element.is(thisMethodCollection.element)) {\n\t\t\t\t\t\t\tthisMethodCollection.instance.load();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.load();\n\n\t\t\t\tif (settings.visible) {\n\t\t\t\t\t$window.on('scroll.' + uniqueMethodPluginName, throttle(() => thisLoadInstance.load(), 250));\n\t\t\t\t}\n\n\t\t\t\tif (true === settings.early) {\n\t\t\t\t\tlet breakLoop = false;\n\n\t\t\t\t\tmethodCollection.forEach(thisMethodCollection => {\n\t\t\t\t\t\tif (breakLoop) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (methodCollection[key].id === uniqueMethodPluginName) {\n\t\t\t\t\t\t\tclearTimeout(thisMethodCollection.timeout);\n\n\t\t\t\t\t\t\tlet timeout = parseInt(settings.earlyTimeout);\n\n\t\t\t\t\t\t\tthisMethodCollection.timeout = setTimeout(() => {\n\t\t\t\t\t\t\t\t// TODO: $('.selector').niteLoad('option', 'value');\n\t\t\t\t\t\t\t\tthisMethodCollection.instance._settings.visible = false;\n\t\t\t\t\t\t\t\tthisMethodCollection.instance._settings.sequential = true;\n\n\t\t\t\t\t\t\t\tthisMethodCollection.instance.load();\n\t\t\t\t\t\t\t}, !isNaN(timeout) && isFinite(timeout) ? timeout : 0);\n\n\t\t\t\t\t\t\tbreakLoop = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t}\n\n\treturn Loader;\n\n})));\n"],"file":"nite.loader.min.js"}