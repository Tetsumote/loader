"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Loader",e):(void 0).Loader=e()}(0,function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e=function(t,e){return e.indexOf(t)>-1},n=function(t,e){return window.getComputedStyle(t).getPropertyValue(e)},r={image:["jp[e]?g","jpe","jif","jfif","jfi","gif","png","tif[f]?","bmp","dib","webp","ico","cur","svg"],audio:["mp3","ogg","oga","spx","ogg","wav"],video:["mp4","ogg","ogv","webm"]},i={image:["img","picture"],audio:["audio"],video:["video"],other:["iframe"]},o=_toConsumableArray(new Set(Object.values(i).reduce(function(t,e){return t.concat(e)}))),s=function(){function t(n){_classCallCheck(this,t);var s=n.element instanceof HTMLElement;if(this.url=n.url,this.consistent=s&&e(n.element.tagName.toLowerCase(),o),this.element=s?n.element:null,this.tagName=this.consistent?this.element.tagName.toLowerCase():null,this.type=null,this.extension=null,this.url){for(var a in this.url=n.url,r){var c=r[a].join("|");if(new RegExp("(.("+c+")$)|data:"+a+"/("+c+");base64,").test(this.url)){var l=this.url.match(new RegExp(".("+c+")$","g"))||this.url.match(new RegExp("^data:"+a+"/("+c+")","g"));if(null!==l){this.type=a,this.extension=l[0].replace("data:"+a+"/","").replace(".",""),this.tagName=this.tagName?this.tagName:i[a][0];break}}}if(!this.consistent||"audio"!==this.tagName&&"video"!==this.tagName&&"iframe"!==this.tagName){if(this.tagName)for(var u in i)if(e(this.tagName,i[u])){this.type=u;break}}else this.type=this.tagName}}return _createClass(t,null,[{key:"isResource",value:function(t){return"object"===_typeof(t)&&"tagName"in t&&"type"in t&&"url"in t&&"extension"in t&&"element"in t}}]),t}(),a=function(t){function e(t){var n;return _classCallCheck(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,function(e,r){t(e,r,function(t){try{return n._progress.forEach(function(e){return e(t)})}catch(t){r(t)}})})))._progress=[],n}return _inherits(e,_wrapNativeSuper(Promise)),_createClass(e,[{key:"progress",value:function(t){return"function"==typeof t&&this._progress.push(t),this}}]),e}(),c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_objectSpread({},{srcAttributes:{src:e.lazy?"data-src":"src",srcset:e.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:e.lazy?"data-sizes":"sizes",media:e.lazy?"data-media":"media"},backgrounds:!1},e),i=[],a=o.join(","),c=Object.values(r.srcAttributes),l=c.map(function(t){return"["+t+"]"}).join(","),u=_toConsumableArray(t.querySelectorAll(a)).filter(function(t){return!t.parentElement||"picture"!==t.parentElement.tagName.toLowerCase()});return!t.matches(a)||t.parentElement&&"picture"===t.parentElement.tagName.toLowerCase()||u.push(t),u.forEach(function(t){var e=t;if(t.querySelectorAll("source").length&&(e=_toConsumableArray(e=t.querySelectorAll("source"))[0]),e.matches(l)){for(var n="",r=0,o=c.length;r<o&&!(n=e.getAttribute(c[r]));r++);i.push(new s({element:t,url:n}))}}),!0===r.backgrounds&&((u=_toConsumableArray(t.querySelectorAll("*"))).push(t),(u=(u=u.filter(function(t){return!t.matches(a)})).filter(function(t){return"none"!==n(t,"background-image")})).forEach(function(t){var e=n(t,"background-image").match(/\((.*?)\)/);null!==e&&e.length>=2&&i.push(new s({element:t,url:e[1].replace(/('|")/g,"")}))})),i},l=function(t,e){Object.keys(e).forEach(function(n){var r=e[n];r="src"===r||"srcset"===r?"data-"+r:r;var i=t.getAttribute(r);i&&(t.setAttribute(n,i),t.removeAttribute(r))})},u=function(t,e,n){return n.forEach(function(n){var r=e.getAttribute(n);r&&t.setAttribute("src"===n||"srcset"===n?"data-"+n:n,r)})},f=function(t,e){return e.forEach(function(e){return t.removeAttribute(e)})},h=function(t){return t=t>100?100:t<0?0:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return parseFloat(t.toFixed(e))}(t,4)},p="IntersectionObserver"in window,d=function(){function t(){_classCallCheck(this,t),this._window=window,this._html=document.documentElement,this._body=document.body,this._frame1=this._window,this._frame2=this._html||this._body,this._prefix1="inner",this._prefix2="offset",!this._prefix1+"Width"in this._frame1&&(this._prefix1="client",this._frame1=this._frame2),this._offsetWidth=0,this._offsetHeight=0,this._width=0,this._height=0,this._scrollTop=0,this._scrollLeft=0,this._lock=!1,this.calcAll()}return _createClass(t,[{key:"calcOffsetWidth",value:function(){return this._offsetWidth=this._body[this._prefix2+"Width"],this.offsetWidth}},{key:"calcOffsetHeight",value:function(){return this._offsetHeight=this._body[this._prefix2+"Height"],this.offsetHeight}},{key:"calcWidth",value:function(){return this._width=this._frame1[this._prefix1+"Width"],this.width}},{key:"calcHeight",value:function(){return this._height=this._frame1[this._prefix1+"Height"],this.height}},{key:"calcScrollTop",value:function(){return this._scrollTop=this._frame2.scrollTop||0,this.scrollTop}},{key:"calcScrollLeft",value:function(){return this._scrollLeft=this._frame2.scrollLeft||0,this.scrollLeft}},{key:"calcAll",value:function(){return this.calcOffsetWidth(),this.calcOffsetHeight(),this.calcWidth(),this.calcHeight(),this.calcScrollTop(),this.calcScrollLeft(),this.all}},{key:"offsetWidth",get:function(){return this._offsetWidth}},{key:"offsetHeight",get:function(){return this._offsetHeight}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"scrollTop",get:function(){return this._scrollTop}},{key:"scrollLeft",get:function(){return this._scrollLeft}},{key:"all",get:function(){return{offsetWidth:this.offsetWidth,offsetHeight:this.offsetHeight,width:this.width,height:this.height,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft}}},{key:"lock",get:function(){return this._lock},set:function(t){if(this._lock=t,this._lock){this._body.style.top=-this.calcScrollTop()+"px",this._body.style.left=-this.calcScrollLeft()+"px";var e=this.calcOffsetWidth(),n=this.calcOffsetHeight();this._html.style.top="0px",this._html.style.left="0px",this._html.style.position="fixed",this._body.style.position="fixed",this._html.style.width="100%",this._body.style.width="100%";var r=this.calcOffsetWidth(),i=this.calcOffsetHeight();e=r-e,n=i-n,this._body.style.width=r-e+"px",this._body.style.height=i-n+"px"}else{var o=Math.abs(parseFloat(this._body.style.top)),s=Math.abs(parseFloat(this._body.style.left));this._html.style.position="",this._html.style.top="",this._html.style.left="",this._html.style.width="",this._body.style.position="",this._body.style.top="",this._body.style.left="",this._body.style.width="",this._window.scroll({top:o,left:s,behavior:"instant"})}}}]),t}(),y=function(t){return!!_(t.getBoundingClientRect()).ratio},_=function(t){var e=new d;if(t.right<0||t.bottom<0||t.left>e.width||t.top>e.height)return{x:0,y:0,ratio:0};var n=t.top<0,r=t.top+t.height>e.height,i=t.left<0,o=t.left+t.width>e.width;if(!(n||r||i||o))return{x:100,y:100,ratio:100};var s=0,a=0;n&&(s=Math.abs(t.top)),r&&(s=t.top+t.height-e.height),i&&(a=Math.abs(t.left)),o&&(a=t.left+t.width-e.width);var c=h(100*(t.width-a)/(t.width||1)),l=h(100*(t.height-s)/(t.height||1));return{x:c,y:l,ratio:Math.min(c,l)}},m=t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();return function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,t),this._options=_objectSpread({},{srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},lazy:!1,playthrough:!1,backgrounds:!0,sequential:!1},n),this._collection=[],this._queue=new Map,this._load=null,this._percentage=0,this._state=0,!p){this.manuallyObservedElements=[];var r=function(){return e.manuallyObservedElements.filter(function(t){return!t.intersected}).forEach(function(t){!t.intersected&&y(t.element)&&(t.intersected=!0,t.element.dispatchEvent(new CustomEvent("intersected__"+m)))})};window.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("load",r)}}return _createClass(t,[{key:"abort",value:function(){0!==this._state&&(this._state=0,this._queue.forEach(function(t,e){return e.dispatchEvent(new CustomEvent("abort__"+m))}))}},{key:"load",value:function(){var t=this;return this._load=new a(function(e,n,r){if(1===t._state&&n("This Loader instance is already in progress"),t._collection.length||n("Resources collection is empty"),t._state=1,t._options.sequential){var i=0;!function o(){if(0===t._state)return n("Loader instance aborted"),void(t._collection=[]);t.fetch(t._collection[i]).catch(function(t){return console.warn(t.event.detail.message+": "+t.resource.url),t}).then(function(n){0!==t._state&&i++,t._percentage=i/t._collection.length*100,0!==t._state&&r(n),i<t._collection.length?o():(t._state=0,e(n))})}()}else!function(){for(var i=0,o=0;o<t._collection.length;o++){if(0===t._state){n("Loader instance aborted"),t._collection=[];break}t.fetch(t._collection[o]).catch(function(t){return console.warn(t.event.detail.message+": "+t.resource.url),t}).then(function(n){0!==t._state&&i++,t._percentage=i/t._collection.length*100,0!==t._state&&r(n),i>=t._collection.length&&(t._state=0,e())})}}()}),this._load}},{key:"fetch",value:function(t){var e=this;return new Promise(function(n,r){var i=t.consistent&&document.body.contains(t.element),o=i&&t.element.querySelectorAll("source").length,s=document.createElement(t.tagName),a=s;"iframe"===t.type&&(s.style.visibility="hidden",s.style.position="fixed",s.style.top="-999px",s.style.left="-999px",s.style.width="1px",s.style.height="1px",document.body.appendChild(s)),i&&(u(s,t.element,Object.values(e._options.srcAttributes)),u(s,t.element,Object.values(e._options.sizesAttributes)),o&&_toConsumableArray(t.element.querySelectorAll("source")).forEach(function(t){var n=document.createElement("source");u(n,t,Object.values(e._options.srcAttributes)),u(n,t,Object.values(e._options.sizesAttributes)),s.append(n)}),"picture"===t.tagName&&(a=document.createElement("img"),s.append(a)));var c=function(n,r){i&&(l(t.element,e._options.srcAttributes),l(t.element,e._options.sizesAttributes),o&&_toConsumableArray(t.element.querySelectorAll("source")).forEach(function(t){l(t,e._options.srcAttributes),l(t,e._options.sizesAttributes)}),"video"!==t.type&&"audio"!==t.type||t.element.load(),"iframe"===t.type&&s.parentElement.removeChild(s)),e._queue.delete(s),r({event:n,resource:t})},h=function(){i?(l(s,e._options.srcAttributes),l(s,e._options.sizesAttributes),o&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(t){l(t,e._options.srcAttributes),l(t,e._options.sizesAttributes)})):s.setAttribute("src",t.url),"video"!==t.type&&"audio"!==t.type||s.load()},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new CustomEvent(e,{detail:_objectSpread({},n,{resource:t})});return t.element&&t.element.dispatchEvent(r),document.dispatchEvent(r),r},_={resource:t,observer:null,element:s};s.addEventListener("abort__"+m,function(){f(s,Object.keys(e._options.srcAttributes)),f(s,Object.values(e._options.srcAttributes)),f(s,Object.keys(e._options.sizesAttributes)),f(s,Object.values(e._options.sizesAttributes)),o&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(t){f(t,Object.keys(e._options.srcAttributes)),f(t,Object.values(e._options.srcAttributes)),f(t,Object.keys(e._options.sizesAttributes)),f(t,Object.values(e._options.sizesAttributes))});var t=d("resourceError",{type:"abortion",message:"Resource load aborted"});c(t,r)}),a.addEventListener("error",function(t){var e=d("resourceError",{type:t.type,message:"Resource failed to load"});c(e,r)}),"image"!==t.type&&"iframe"!==t.type||a.addEventListener("load",function(t){if("iframe"!==t.target.tagName.toLowerCase()||t.target.getAttribute("src")){var e=d("resourceLoad",{type:t.type});c(e,n)}}),"audio"!==t.type&&"video"!==t.type||a.addEventListener(e._options.playthrough?"canplaythrough":"loadedmetadata",function(t){var e=d("resourceLoad",{type:t.type});c(e,n)}),t.element instanceof HTMLElement&&e._options.lazy?(p?(_.observer=new IntersectionObserver(function(t,e){t.forEach(function(t){t.intersectionRatio>0&&(e.unobserve(t.target),h())})},{root:null,rootMargin:"0px",threshold:.1}),_.observer.observe(t.element)):y(t.element)?h():(e.manuallyObservedElements.push({element:t.element,intersected:!1}),t.element.addEventListener("intersected__"+m,function(){return h()})),e._queue.set(t.element,_)):(e._queue.set(s,_),h())})}},{key:"percentage",get:function(){return this._percentage}},{key:"collection",set:function(t){var e=this;0===this._state&&(t instanceof NodeList&&(t=_toConsumableArray(t)),t instanceof HTMLElement&&(t=c(t,this._options)),"string"==typeof t&&(t=[new s({url:t})]),s.isResource(t)&&(t=[t]),Array.isArray(t)&&(this._collection=[],t.forEach(function(t){var n=function(t){"image"===t.type||"video"===t.type||"audio"===t.type||"iframe"===t.type&&t.consistent?e._collection.push(t):console.warn("Couldn't add resource to collection",t)};t instanceof HTMLElement&&c(t,e._options).forEach(function(t){return n(new s(t))}),"string"==typeof t&&n(new s({url:t})),s.isResource(t)&&n(t)})))},get:function(){return this._collection}}]),t}()});
//# sourceMappingURL=loader.min.js.map
