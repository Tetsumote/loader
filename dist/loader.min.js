"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(void 0).Loader=t()}(0,function(){var e=function(e,t){return t.indexOf(e)>-1},t=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},n={image:["jp[e]?g","jpe","jif","jfif","jfi","gif","png","tif[f]?","bmp","dib","webp","ico","cur","svg"],audio:["mp3","ogg","oga","spx","ogg","wav"],video:["mp4","ogg","ogv","webm"]},r={image:["img","picture"],audio:["audio"],video:["video"],other:["iframe"]},o=_toConsumableArray(new Set(Object.values(r).reduce(function(e,t){return e.concat(t)}))),i=function(){function t(i){_classCallCheck(this,t);var s=i.element instanceof HTMLElement;if(this.url=i.url,this.consistent=s&&e(i.element.tagName.toLowerCase(),o),this.element=s?i.element:null,this.tagName=this.consistent?this.element.tagName.toLowerCase():null,this.type=null,this.extension=null,this.url){for(var a in this.url=i.url,n){var u=n[a].join("|");if(new RegExp("(.("+u+")$)|data:"+a+"/("+u+");base64,").test(this.url)){var c=this.url.match(new RegExp(".("+u+")$","g"))||this.url.match(new RegExp("^data:"+a+"/("+u+")","g"));if(null!==c){this.type=a,this.extension=c[0].replace("data:"+a+"/","").replace(".",""),this.tagName=this.tagName?this.tagName:r[a][0];break}}}if(!this.consistent||"audio"!==this.tagName&&"video"!==this.tagName&&"iframe"!==this.tagName){if(this.tagName)for(var l in r)if(e(this.tagName,r[l])){this.type=l;break}}else this.type=this.tagName}}return _createClass(t,null,[{key:"isMedia",value:function(e){return"object"===_typeof(e)&&"tagName"in e&&"type"in e&&"url"in e&&"extension"in e&&"element"in e}}]),t}(),s=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,function(t,r){e(t,r,function(e){try{return n._progress.forEach(function(t){return t(e)})}catch(e){r(e)}})})))._progress=[],n}return _inherits(t,_wrapNativeSuper(Promise)),_createClass(t,[{key:"progress",value:function(e){return"function"==typeof e&&this._progress.push(e),this}}]),t}(),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_objectSpread({},{srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},backgrounds:!1},n),s=[],a=o.join(","),u=Object.values(r.srcAttributes),c=u.map(function(e){return"["+e+"]"}).join(","),l=_toConsumableArray(e.querySelectorAll(a)).filter(function(e){return!e.parentElement||"picture"!==e.parentElement.tagName.toLowerCase()});return!e.matches(a)||e.parentElement&&"picture"===e.parentElement.tagName.toLowerCase()||l.push(e),l.forEach(function(e){var t=e;if(e.querySelectorAll("source").length&&(t=_toConsumableArray(t=e.querySelectorAll("source"))[0]),t.matches(c)){for(var n="",r=0,o=u.length;r<o&&!(n=t.getAttribute(u[r]));r++);s.push(new i({element:e,url:n}))}}),!0===r.backgrounds&&((l=_toConsumableArray(e.querySelectorAll("*"))).push(e),(l=(l=l.filter(function(e){return!e.matches(a)})).filter(function(e){return"none"!==t(e,"background-image")})).forEach(function(e){var n=t(e,"background-image").match(/\((.*?)\)/);null!==n&&n.length>=2&&s.push(new i({element:e,url:n[1].replace(/('|")/g,"")}))})),s},u=function(e,t){Object.keys(t).forEach(function(n){var r=t[n];r="src"===r||"srcset"===r?"data-"+r:r;var o=e.getAttribute(r);o&&(e.setAttribute(n,o),e.removeAttribute(r))})},c=function(e,t,n){return n.forEach(function(n){var r=t.getAttribute(n);r&&e.setAttribute("src"===n||"srcset"===n?"data-"+n:n,r)})},l=function(e,t){return t.forEach(function(t){return e.removeAttribute(t)})};return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this._options=_objectSpread({},{srcAttributes:{src:t.lazy?"data-src":"src",srcset:t.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:t.lazy?"data-sizes":"sizes",media:t.lazy?"data-media":"media"},lazy:!1,playthrough:!1,backgrounds:!0,sequential:!1},t),this._collection=[],this._queue=new Map,this._load=null,this._percentage=0,this._state=0}return _createClass(e,[{key:"abort",value:function(){0!==this._state&&(this._state=0,this._queue.forEach(function(e,t){return t.dispatchEvent(new CustomEvent("Aborted"))}))}},{key:"load",value:function(){var e=this;return this._load=new s(function(t,n,r){if(1===e._state&&n("A Loader instance is already in progress."),e._collection.length||n("Collection is empty."),e._state=1,e._options.sequential){var o=0;!function i(){if(0!==e._state){var s=function(t,n){o++,e._percentage=o/e._collection.length*100,r(t),o<e._collection.length?i():(e._state=0,n())},a=e.fetch(e._collection[o]);a.then(function(e){return s(e,function(){return t({})})}),a.catch(function(e){return s(e,function(){return n("Error")})})}else n("Aborted")}()}else!function(){for(var o=0,i=function(t,n){o++,e._percentage=o/e._collection.length*100,r(t),o>=e._collection.length&&(e._state=0,n())},s=0;s<e._collection.length;s++){if(0===e._state){n("Aborted");break}var a=e.fetch(e._collection[s]);a.then(function(e){return i(e,function(){return t({})})}),a.catch(function(e){return i(e,function(){return n(e)})})}}()}),this._load}},{key:"fetch",value:function(e){var t=this;return new Promise(function(n,r){var o=e.consistent&&document.body.contains(e.element),i=o&&e.element.querySelectorAll("source").length,s=document.createElement(e.tagName),a=s;"iframe"===e.type&&(s.style.visibility="hidden",s.style.position="fixed",s.style.top="-999px",s.style.left="-999px",s.style.width="1px",s.style.height="1px",document.body.appendChild(s)),o&&(c(s,e.element,Object.values(t._options.srcAttributes)),c(s,e.element,Object.values(t._options.sizesAttributes)),i&&_toConsumableArray(e.element.querySelectorAll("source")).forEach(function(e){var n=document.createElement("source");c(n,e,Object.values(t._options.srcAttributes)),c(n,e,Object.values(t._options.sizesAttributes)),s.append(n)}),"picture"===e.tagName&&(a=document.createElement("img"),s.append(a)));var f=function(n){o&&(u(e.element,t._options.srcAttributes),u(e.element,t._options.sizesAttributes),i&&_toConsumableArray(e.element.querySelectorAll("source")).forEach(function(e){u(e,t._options.srcAttributes),u(e,t._options.sizesAttributes)}),"video"!==e.type&&"audio"!==e.type||e.element.load(),"iframe"===e.type&&s.parentElement.removeChild(s)),t._queue.delete(s),n(e)},p=function(){o?(u(s,t._options.srcAttributes),u(s,t._options.sizesAttributes),i&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(e){u(e,t._options.srcAttributes),u(e,t._options.sizesAttributes)})):s.setAttribute("src",e.url),"video"!==e.type&&"audio"!==e.type||s.load()},y=function(t){var n=new CustomEvent(t,{detail:e});e.element&&e.element.dispatchEvent(n),document.dispatchEvent(n)},d={media:e,observer:null,element:s};s.addEventListener("abort",function(){l(s,Object.keys(t._options.srcAttributes)),l(s,Object.values(t._options.srcAttributes)),l(s,Object.keys(t._options.sizesAttributes)),l(s,Object.values(t._options.sizesAttributes)),i&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(e){l(e,Object.keys(t._options.srcAttributes)),l(e,Object.values(t._options.srcAttributes)),l(e,Object.keys(t._options.sizesAttributes)),l(e,Object.values(t._options.sizesAttributes))}),f(r)}),a.addEventListener("error",function(){f(r),y("mediaError")}),"image"!==e.type&&"iframe"!==e.type||a.addEventListener("load",function(e){("iframe"!==e.target.tagName.toLowerCase()||e.target.getAttribute("src"))&&(f(n),y("mediaLoad"))}),"audio"!==e.type&&"video"!==e.type||a.addEventListener(t._options.playthrough?"canplaythrough":"loadedmetadata",function(){f(n),y("mediaLoad")}),e.element instanceof HTMLElement&&t._options.lazy&&"IntersectionObserver"in window?(d.observer=new IntersectionObserver(function(e,t){e.forEach(function(e){e.intersectionRatio>0&&(t.unobserve(e.target),p())})},{root:null,rootMargin:"0px",threshold:.1}),d.observer.observe(e.element),t._queue.set(e.element,d)):(t._queue.set(s,d),p())})}},{key:"percentage",get:function(){return this._percentage}},{key:"collection",set:function(e){var t=this;0===this._state&&(e instanceof HTMLElement&&(e=a(e,this._options)),"string"==typeof item&&(e=[new i({url:item})]),i.isMedia(e)&&(e=[e]),Array.isArray(e)&&e.forEach(function(e){var n=function(e){"image"===e.type||"video"===e.type||"audio"===e.type||"iframe"===e.type&&e.consistent?t._collection.push(e):console.warn("Couldn't add media to collection",e)};e instanceof HTMLElement&&a(e,t._options).forEach(function(e){return n(new i(e))}),"string"==typeof e&&n(new i({url:e})),i.isMedia(e)&&n(e)}))},get:function(){return this._collection}}]),e}()});
//# sourceMappingURL=loader.min.js.map
