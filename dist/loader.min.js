"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Loader",e):(void 0).Loader=e()}(0,function(){var t=function(t,e){return e.indexOf(t)>-1},e=function(t,e){return window.getComputedStyle(t).getPropertyValue(e)},n={image:["jp[e]?g","jpe","jif","jfif","jfi","gif","png","tif[f]?","bmp","dib","webp","ico","cur","svg"],audio:["mp3","ogg","oga","spx","ogg","wav"],video:["mp4","ogg","ogv","webm"]},r={image:["img","picture"],audio:["audio"],video:["video"],other:["iframe"]},i=_toConsumableArray(new Set(Object.values(r).reduce(function(t,e){return t.concat(e)}))),o=function(){function e(o){_classCallCheck(this,e);var s=o.element instanceof HTMLElement;if(this.url=o.url,this.consistent=s&&t(o.element.tagName.toLowerCase(),i),this.element=s?o.element:null,this.tagName=this.consistent?this.element.tagName.toLowerCase():null,this.type=null,this.extension=null,this.url){for(var c in this.url=o.url,n){var a=n[c].join("|");if(new RegExp("(.("+a+")$)|data:"+c+"/("+a+");base64,").test(this.url)){var l=this.url.match(new RegExp(".("+a+")$","g"))||this.url.match(new RegExp("^data:"+c+"/("+a+")","g"));if(null!==l){this.type=c,this.extension=l[0].replace("data:"+c+"/","").replace(".",""),this.tagName=this.tagName?this.tagName:r[c][0];break}}}if(!this.consistent||"audio"!==this.tagName&&"video"!==this.tagName&&"iframe"!==this.tagName){if(this.tagName)for(var u in r)if(t(this.tagName,r[u])){this.type=u;break}}else this.type=this.tagName}}return _createClass(e,null,[{key:"isResource",value:function(t){return"object"===_typeof(t)&&"tagName"in t&&"type"in t&&"url"in t&&"extension"in t&&"element"in t}}]),e}(),s=function(t){function e(t){var n;return _classCallCheck(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,function(e,r){t(e,r,function(t){try{return n._progress.forEach(function(e){return e(t)})}catch(t){r(t)}})})))._progress=[],n}return _inherits(e,_wrapNativeSuper(Promise)),_createClass(e,[{key:"progress",value:function(t){return"function"==typeof t&&this._progress.push(t),this}}]),e}(),c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_objectSpread({},{srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},backgrounds:!1},n),s=[],c=i.join(","),a=Object.values(r.srcAttributes),l=a.map(function(t){return"["+t+"]"}).join(","),u=_toConsumableArray(t.querySelectorAll(c)).filter(function(t){return!t.parentElement||"picture"!==t.parentElement.tagName.toLowerCase()});return!t.matches(c)||t.parentElement&&"picture"===t.parentElement.tagName.toLowerCase()||u.push(t),u.forEach(function(t){var e=t;if(t.querySelectorAll("source").length&&(e=_toConsumableArray(e=t.querySelectorAll("source"))[0]),e.matches(l)){for(var n="",r=0,i=a.length;r<i&&!(n=e.getAttribute(a[r]));r++);s.push(new o({element:t,url:n}))}}),!0===r.backgrounds&&((u=_toConsumableArray(t.querySelectorAll("*"))).push(t),(u=(u=u.filter(function(t){return!t.matches(c)})).filter(function(t){return"none"!==e(t,"background-image")})).forEach(function(t){var n=e(t,"background-image").match(/\((.*?)\)/);null!==n&&n.length>=2&&s.push(new o({element:t,url:n[1].replace(/('|")/g,"")}))})),s},a=function(t,e){Object.keys(e).forEach(function(n){var r=e[n];r="src"===r||"srcset"===r?"data-"+r:r;var i=t.getAttribute(r);i&&(t.setAttribute(n,i),t.removeAttribute(r))})},l=function(t,e,n){return n.forEach(function(n){var r=e.getAttribute(n);r&&t.setAttribute("src"===n||"srcset"===n?"data-"+n:n,r)})},u=function(t,e){return e.forEach(function(e){return t.removeAttribute(e)})},f=function(t){return t=t>100?100:t<0?0:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;return parseFloat(t.toFixed(e))}(t,4)},h="IntersectionObserver"in window,p=function(){function t(){_classCallCheck(this,t),this._window=window,this._html=document.documentElement,this._body=document.body,this._frame1=this._window,this._frame2=this._html||this._body,this._prefix1="inner",this._prefix2="offset",!this._prefix1+"Width"in this._frame1&&(this._prefix1="client",this._frame1=this._frame2),this._offsetWidth=0,this._offsetHeight=0,this._width=0,this._height=0,this._scrollTop=0,this._scrollLeft=0,this._lock=!1,this.calcAll()}return _createClass(t,[{key:"calcOffsetWidth",value:function(){return this._offsetWidth=this._body[this._prefix2+"Width"],this.offsetWidth}},{key:"calcOffsetHeight",value:function(){return this._offsetHeight=this._body[this._prefix2+"Height"],this.offsetHeight}},{key:"calcWidth",value:function(){return this._width=this._frame1[this._prefix1+"Width"],this.width}},{key:"calcHeight",value:function(){return this._height=this._frame1[this._prefix1+"Height"],this.height}},{key:"calcScrollTop",value:function(){return this._scrollTop=this._frame2.scrollTop||0,this.scrollTop}},{key:"calcScrollLeft",value:function(){return this._scrollLeft=this._frame2.scrollLeft||0,this.scrollLeft}},{key:"calcAll",value:function(){return this.calcOffsetWidth(),this.calcOffsetHeight(),this.calcWidth(),this.calcHeight(),this.calcScrollTop(),this.calcScrollLeft(),this.all}},{key:"offsetWidth",get:function(){return this._offsetWidth}},{key:"offsetHeight",get:function(){return this._offsetHeight}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"scrollTop",get:function(){return this._scrollTop}},{key:"scrollLeft",get:function(){return this._scrollLeft}},{key:"all",get:function(){return{offsetWidth:this.offsetWidth,offsetHeight:this.offsetHeight,width:this.width,height:this.height,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft}}},{key:"lock",get:function(){return this._lock},set:function(t){if(this._lock=t,this._lock){this._body.style.top=-this.calcScrollTop()+"px",this._body.style.left=-this.calcScrollLeft()+"px";var e=this.calcOffsetWidth(),n=this.calcOffsetHeight();this._html.style.top="0px",this._html.style.left="0px",this._html.style.position="fixed",this._body.style.position="fixed",this._html.style.width="100%",this._body.style.width="100%";var r=this.calcOffsetWidth(),i=this.calcOffsetHeight();e=r-e,n=i-n,this._body.style.width=r-e+"px",this._body.style.height=i-n+"px"}else{var o=Math.abs(parseFloat(this._body.style.top)),s=Math.abs(parseFloat(this._body.style.left));this._html.style.position="",this._html.style.top="",this._html.style.left="",this._html.style.width="",this._body.style.position="",this._body.style.top="",this._body.style.left="",this._body.style.width="",this._window.scroll({top:o,left:s,behavior:"instant"})}}}]),t}(),d=function(t){return!!y(t.getBoundingClientRect()).ratio},y=function(t){var e=new p;if(t.right<0||t.bottom<0||t.left>e.width||t.top>e.height)return{x:0,y:0,ratio:0};var n=t.top<0,r=t.top+t.height>e.height,i=t.left<0,o=t.left+t.width>e.width;if(!(n||r||i||o))return{x:100,y:100,ratio:100};var s=0,c=0;n&&(s=Math.abs(t.top)),r&&(s=t.top+t.height-e.height),i&&(c=Math.abs(t.left)),o&&(c=t.left+t.width-e.width);var a=f(100*(t.width-c)/(t.width||1)),l=f(100*(t.height-s)/(t.height||1));return{x:a,y:l,ratio:Math.min(a,l)}};return function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,t),this._options=_objectSpread({},{srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},lazy:!1,playthrough:!1,backgrounds:!0,sequential:!1},n),this._collection=[],this._queue=new Map,this._load=null,this._percentage=0,this._state=0,!h){this.manuallyObservedElements=[];var r=function(){return e.manuallyObservedElements.filter(function(t){return!t.intersected}).forEach(function(t){!t.intersected&&d(t.element)&&(t.intersected=!0,t.element.dispatchEvent(new CustomEvent("intersected")))})};window.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("load",r)}}return _createClass(t,[{key:"abort",value:function(){0!==this._state&&(this._state=0,this._queue.forEach(function(t,e){return e.dispatchEvent(new CustomEvent("Aborted"))}))}},{key:"load",value:function(){var t=this;return this._load=new s(function(e,n,r){if(1===t._state&&n("A Loader instance is already in progress."),t._collection.length||n("Collection is empty."),t._state=1,t._options.sequential){var i=0;!function o(){if(0!==t._state){var s=function(e,n){i++,t._percentage=i/t._collection.length*100,r(e),i<t._collection.length?o():(t._state=0,n())},c=t.fetch(t._collection[i]);c.then(function(t){return s(t,function(){return e({})})}),c.catch(function(t){return s(t,function(){return n("Error")})})}else n("Aborted")}()}else!function(){for(var i=0,o=function(e,n){i++,t._percentage=i/t._collection.length*100,r(e),i>=t._collection.length&&(t._state=0,n())},s=0;s<t._collection.length;s++){if(0===t._state){n("Aborted");break}var c=t.fetch(t._collection[s]);c.then(function(t){return o(t,function(){return e({})})}),c.catch(function(t){return o(t,function(){return n(t)})})}}()}),this._load}},{key:"fetch",value:function(t){var e=this;return new Promise(function(n,r){var i=t.consistent&&document.body.contains(t.element),o=i&&t.element.querySelectorAll("source").length,s=document.createElement(t.tagName),c=s;"iframe"===t.type&&(s.style.visibility="hidden",s.style.position="fixed",s.style.top="-999px",s.style.left="-999px",s.style.width="1px",s.style.height="1px",document.body.appendChild(s)),i&&(l(s,t.element,Object.values(e._options.srcAttributes)),l(s,t.element,Object.values(e._options.sizesAttributes)),o&&_toConsumableArray(t.element.querySelectorAll("source")).forEach(function(t){var n=document.createElement("source");l(n,t,Object.values(e._options.srcAttributes)),l(n,t,Object.values(e._options.sizesAttributes)),s.append(n)}),"picture"===t.tagName&&(c=document.createElement("img"),s.append(c)));var f=function(n){i&&(a(t.element,e._options.srcAttributes),a(t.element,e._options.sizesAttributes),o&&_toConsumableArray(t.element.querySelectorAll("source")).forEach(function(t){a(t,e._options.srcAttributes),a(t,e._options.sizesAttributes)}),"video"!==t.type&&"audio"!==t.type||t.element.load(),"iframe"===t.type&&s.parentElement.removeChild(s)),e._queue.delete(s),n(t)},p=function(){i?(a(s,e._options.srcAttributes),a(s,e._options.sizesAttributes),o&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(t){a(t,e._options.srcAttributes),a(t,e._options.sizesAttributes)})):s.setAttribute("src",t.url),"video"!==t.type&&"audio"!==t.type||s.load()},y=function(e){var n=new CustomEvent(e,{detail:t});t.element&&t.element.dispatchEvent(n),document.dispatchEvent(n)},_={resource:t,observer:null,element:s};s.addEventListener("abort",function(){u(s,Object.keys(e._options.srcAttributes)),u(s,Object.values(e._options.srcAttributes)),u(s,Object.keys(e._options.sizesAttributes)),u(s,Object.values(e._options.sizesAttributes)),o&&_toConsumableArray(s.querySelectorAll("source")).forEach(function(t){u(t,Object.keys(e._options.srcAttributes)),u(t,Object.values(e._options.srcAttributes)),u(t,Object.keys(e._options.sizesAttributes)),u(t,Object.values(e._options.sizesAttributes))}),f(r)}),c.addEventListener("error",function(){f(r),y("resourceError")}),"image"!==t.type&&"iframe"!==t.type||c.addEventListener("load",function(t){("iframe"!==t.target.tagName.toLowerCase()||t.target.getAttribute("src"))&&(f(n),y("resourceLoad"))}),"audio"!==t.type&&"video"!==t.type||c.addEventListener(e._options.playthrough?"canplaythrough":"loadedmetadata",function(){f(n),y("resourceLoad")}),t.element instanceof HTMLElement&&e._options.lazy?(h?(_.observer=new IntersectionObserver(function(t,e){t.forEach(function(t){t.intersectionRatio>0&&(e.unobserve(t.target),p())})},{root:null,rootMargin:"0px",threshold:.1}),_.observer.observe(t.element)):d(t.element)?p():(e.manuallyObservedElements.push({element:t.element,intersected:!1}),t.element.addEventListener("intersected",function(){return p()})),e._queue.set(t.element,_)):(e._queue.set(s,_),p())})}},{key:"percentage",get:function(){return this._percentage}},{key:"collection",set:function(t){var e=this;0===this._state&&(t instanceof NodeList&&(t=_toConsumableArray(t)),t instanceof HTMLElement&&(t=c(t,this._options)),"string"==typeof t&&(t=[new o({url:t})]),o.isResource(t)&&(t=[t]),Array.isArray(t)&&t.forEach(function(t){var n=function(t){"image"===t.type||"video"===t.type||"audio"===t.type||"iframe"===t.type&&t.consistent?e._collection.push(t):console.warn("Couldn't add resource to collection",t)};t instanceof HTMLElement&&c(t,e._options).forEach(function(t){return n(new o(t))}),"string"==typeof t&&n(new o({url:t})),o.isResource(t)&&n(t)}))},get:function(){return this._collection}}]),t}()});
//# sourceMappingURL=loader.min.js.map
