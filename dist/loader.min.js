"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _fixBabelExtend=function(e){var t=e.getPrototypeOf||function(e){return e.__proto__},n=e.setPrototypeOf||function(e,t){return e.__proto__=t,e},r="object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))?Reflect.construct:function(e,t,r){var o,i=[null];return i.push.apply(i,t),o=e.bind.apply(e,i),n(new o,r.prototype)};return function(e){var o=t(e);return n(e,n(function(){return r(o,arguments,t(this).constructor)},o))}}(Object);function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):e.Loader=t()}(this,function(){var e=function(e,t){return t.indexOf(e)>-1},t=function(e,t){return window.getComputedStyle(e).getPropertyValue(t)},n={image:["jp[e]?g","jpe","jif","jfif","jfi","gif","png","tif[f]?","bmp","dib","webp","ico","cur","svg"],audio:["mp3","ogg","oga","spx","ogg","wav"],video:["mp4","ogg","ogv","webm"]},r={image:["img","picture"],audio:["audio"],video:["video"],other:["iframe"]},o=[].concat(_toConsumableArray(new Set(Object.values(r).reduce(function(e,t){return e.concat(t)})))),i=function(){function t(i){_classCallCheck(this,t);var s=i.element instanceof HTMLElement;if(this.url=i.url,this.consistent=s&&e(i.element.tagName.toLowerCase(),o),this.element=s?i.element:null,this.tagName=this.consistent?this.element.tagName.toLowerCase():null,this.type=null,this.extension=null,this.url){for(var a in this.url=i.url,n){var c=n[a].join("|");if(new RegExp("(.("+c+")$)|data:"+a+"/("+c+");base64,").test(this.url)){var u=this.url.match(new RegExp(".("+c+")$","g"))||this.url.match(new RegExp("^data:"+a+"/("+c+")","g"));if(null!==u){this.type=a,this.extension=u[0].replace("data:"+a+"/","").replace(".",""),this.tagName=this.tagName?this.tagName:r[a][0];break}}}if(!this.consistent||"audio"!==this.tagName&&"video"!==this.tagName&&"iframe"!==this.tagName){if(this.tagName)for(var l in r)if(e(this.tagName,r[l])){this.type=l;break}}else this.type=this.tagName}}return _createClass(t,null,[{key:"isMedia",value:function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"tagName"in e&&"type"in e&&"url"in e&&"extension"in e&&"element"in e}}]),t}(),s=_fixBabelExtend(function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,function(t,r){e(t,r,function(e){try{return n._progress.forEach(function(t){return t(e)})}catch(e){r(e)}})}));return n._progress=[],n}return _inherits(t,Promise),_createClass(t,[{key:"progress",value:function(e){return"function"==typeof e&&this._progress.push(e),this}}]),t}()),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_extends({srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},backgrounds:!1},n),s=[],a=o.join(","),c=Object.values(r.srcAttributes),u=c.map(function(e){return"["+e+"]"}).join(","),l=[].concat(_toConsumableArray(e.querySelectorAll(a))).filter(function(e){return!e.parentElement||"picture"!==e.parentElement.tagName.toLowerCase()});return!e.matches(a)||e.parentElement&&"picture"===e.parentElement.tagName.toLowerCase()||l.push(e),l.forEach(function(e){var t=e;if(e.querySelectorAll("source").length&&(t=e.querySelectorAll("source"),t=[].concat(_toConsumableArray(t))[0]),t.matches(u)){for(var n="",r=0,o=c.length;r<o&&!(n=t.getAttribute(c[r]));r++);s.push(new i({element:e,url:n}))}}),!0===r.backgrounds&&((l=[].concat(_toConsumableArray(e.querySelectorAll("*")))).push(e),(l=(l=l.filter(function(e){return!e.matches(a)})).filter(function(e){return"none"!==t(e,"background-image")})).forEach(function(e){var n=t(e,"background-image").match(/\((.*?)\)/);null!==n&&n.length>=2&&s.push(new i({element:e,url:n[1].replace(/('|")/g,"")}))})),s},c=function(e,t){Object.keys(t).forEach(function(n){var r=t[n];r="src"===r||"srcset"===r?"data-"+r:r;var o=e.getAttribute(r);o&&(e.setAttribute(n,o),e.removeAttribute(r))})},u=function(e,t,n){return n.forEach(function(n){var r=t.getAttribute(n);r&&e.setAttribute("src"===n||"srcset"===n?"data-"+n:n,r)})},l=function(e,t){return t.forEach(function(t){return e.removeAttribute(t)})};return function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this._options=_extends({srcAttributes:{src:t.lazy?"data-src":"src",srcset:t.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:t.lazy?"data-sizes":"sizes",media:t.lazy?"data-media":"media"},lazy:!1,playthrough:!1,backgrounds:!0,sequential:!1},t),this._collection=[],this._queue=new Map,this._load=null,this._percentage=0,this._state=0}return _createClass(e,[{key:"abort",value:function(){0!==this._state&&(this._state=0,this._queue.forEach(function(e,t){return t.dispatchEvent(new CustomEvent("Aborted"))}))}},{key:"load",value:function(){var e=this;return this._load=new s(function(t,n,r){if(1===e._state&&n("A Loader instance is already in progress."),e._collection.length||n("Collection is empty."),e._state=1,e._options.sequential){var o=0;!function i(){if(0!==e._state){var s=function(t,n){o++,e._percentage=o/e._collection.length*100,r(t),o<e._collection.length?i():(e._state=0,n())},a=e.fetch(e._collection[o]);a.then(function(e){return s(e,function(){return t({})})}),a.catch(function(e){return s(e,function(){return n("Error")})})}else n("Aborted")}()}else!function(){for(var o=0,i=function(t,n){o++,e._percentage=o/e._collection.length*100,r(t),o>=e._collection.length&&(e._state=0,n())},s=0;s<e._collection.length;s++){if(0===e._state){n("Aborted");break}var a=e.fetch(e._collection[s]);a.then(function(e){return i(e,function(){return t({})})}),a.catch(function(e){return i(e,function(){return n(e)})})}}()}),this._load}},{key:"fetch",value:function(e){var t=this;return new Promise(function(n,r){var o=e.consistent&&document.body.contains(e.element),i=o&&e.element.querySelectorAll("source").length,s=document.createElement(e.tagName),a=s;"iframe"===e.type&&(s.style.visibility="hidden",s.style.position="fixed",s.style.top="-999px",s.style.left="-999px",s.style.width="1px",s.style.height="1px",document.body.appendChild(s)),o&&(u(s,e.element,Object.values(t._options.srcAttributes)),u(s,e.element,Object.values(t._options.sizesAttributes)),i&&[].concat(_toConsumableArray(e.element.querySelectorAll("source"))).forEach(function(e){var n=document.createElement("source");u(n,e,Object.values(t._options.srcAttributes)),u(n,e,Object.values(t._options.sizesAttributes)),s.append(n)}),"picture"===e.tagName&&(a=document.createElement("img"),s.append(a)));var f=function(n){o&&(c(e.element,t._options.srcAttributes),c(e.element,t._options.sizesAttributes),i&&[].concat(_toConsumableArray(e.element.querySelectorAll("source"))).forEach(function(e){c(e,t._options.srcAttributes),c(e,t._options.sizesAttributes)}),"video"!==e.type&&"audio"!==e.type||e.element.load(),"iframe"===e.type&&s.parentElement.removeChild(s)),t._queue.delete(s),n(e)},p=function(){o?(c(s,t._options.srcAttributes),c(s,t._options.sizesAttributes),i&&[].concat(_toConsumableArray(s.querySelectorAll("source"))).forEach(function(e){c(e,t._options.srcAttributes),c(e,t._options.sizesAttributes)})):s.setAttribute("src",e.url),"video"!==e.type&&"audio"!==e.type||s.load()},d=function(t){var n=new CustomEvent(t,{detail:e});e.element&&e.element.dispatchEvent(n),document.dispatchEvent(n)},h={media:e,observer:null,element:s};s.addEventListener("abort",function(){l(s,Object.keys(t._options.srcAttributes)),l(s,Object.values(t._options.srcAttributes)),l(s,Object.keys(t._options.sizesAttributes)),l(s,Object.values(t._options.sizesAttributes)),i&&[].concat(_toConsumableArray(s.querySelectorAll("source"))).forEach(function(e){l(e,Object.keys(t._options.srcAttributes)),l(e,Object.values(t._options.srcAttributes)),l(e,Object.keys(t._options.sizesAttributes)),l(e,Object.values(t._options.sizesAttributes))}),f(r)}),a.addEventListener("error",function(){f(r),d("mediaError")}),"image"!==e.type&&"iframe"!==e.type||a.addEventListener("load",function(e){("iframe"!==e.target.tagName.toLowerCase()||e.target.getAttribute("src"))&&(f(n),d("mediaLoad"))}),"audio"!==e.type&&"video"!==e.type||a.addEventListener(t._options.playthrough?"canplaythrough":"loadedmetadata",function(){f(n),d("mediaLoad")}),e.element instanceof HTMLElement&&t._options.lazy&&"IntersectionObserver"in window?(h.observer=new IntersectionObserver(function(e,t){e.forEach(function(e){e.intersectionRatio>0&&(t.unobserve(e.target),p())})},{root:null,rootMargin:"0px",threshold:.1}),h.observer.observe(e.element),t._queue.set(e.element,h)):(t._queue.set(s,h),p())})}},{key:"percentage",get:function(){return this._percentage}},{key:"collection",set:function(e){var t=this;0===this._state&&(e instanceof HTMLElement&&(e=a(e,this._options)),"string"==typeof item&&(e=[new i({url:item})]),i.isMedia(e)&&(e=[e]),Array.isArray(e)&&e.forEach(function(e){var n=function(e){"image"===e.type||"video"===e.type||"audio"===e.type||"iframe"===e.type&&e.consistent?t._collection.push(e):console.warn("Couldn't add media to collection",e)};e instanceof HTMLElement&&a(e,t._options).forEach(function(e){return n(new i(e))}),"string"==typeof e&&n(new i({url:e})),i.isMedia(e)&&n(e)}))},get:function(){return this._collection}}]),e}()});
//# sourceMappingURL=loader.min.js.map
