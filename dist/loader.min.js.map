{"version":3,"sources":["loader.mjs"],"names":["_objectSpread","target","i","arguments","length","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","_possibleConstructorReturn","self","call","_typeof","_assertThisInitialized","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","create","constructor","_setPrototypeOf","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","has","get","set","Wrapper","_construct","_getPrototypeOf","this","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","e","Parent","args","a","push","apply","instance","Function","bind","fn","indexOf","o","p","setPrototypeOf","__proto__","getPrototypeOf","_classCallCheck","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","Symbol","iterator","Array","from","isArray","arr2","global","factory","exports","module","define","amd","Loader","s4","Math","floor","random","substring","isInArray","needle","heystack","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","values","reduce","b","Resource","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","_format","LoaderPromise","_Promise","_this","resolve","reject","_progress","listener","error","Promise","handler","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","el","parentElement","attribute","j","getAttribute","switchAttributes","attrs","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","roundPercentage","percentage","num","decimals","parseFloat","toFixed","roundDecimals","isIntersectionObserverSupported","Viewport","_window","_html","documentElement","_body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","bool","style","top","left","scrollBarWidth","scrollBarHeight","position","abs","scroll","behavior","isElementInViewport","getBoundsViewportIntersection","getBoundingClientRect","ratio","bounds","viewport","right","bottom","y","offTop","offBottom","offLeft","offRight","offY","offX","percentageX","percentageY","min","ID","_this2","_options","playthrough","sequential","_collection","_queue","_load","_percentage","_state","manuallyObservedElements","manuallyObserve","intersected","dispatchEvent","CustomEvent","addEventListener","data","_this3","progress","loaded","pipeline","fetch","catch","payload","console","warn","event","detail","message","resource","then","_this4","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","visibility","appendChild","createdSource","append","finishPromise","resolver","load","removeChild","delete","prepareLoad","eventName","queuer","observer","dispatchedEvent","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","_this5","NodeList","isResource","pushCheck"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {(string|number)} num\n     * @returns {number}\n     */\n    const roundDecimals = (num, decimals = 4) => parseFloat(num.toFixed(decimals));\n\n    const s4 = () => Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    /**\n     * @returns {string}\n     */\n    const uniqueID = () => s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => heystack.indexOf(needle) > -1;\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     * @param {Number} percentage\n     * @returns {Number}\n     */\n    const roundPercentage = percentage => {\n        if (percentage > 100) {\n            percentage = 100;\n        } else if (percentage < 0) {\n            percentage = 0;\n        } else {\n            percentage = roundDecimals(percentage, 4);\n        }\n\n        return percentage;\n    };\n\n    const isIntersectionObserverSupported = 'IntersectionObserver' in window;\n\n    /**\n     *\n     */\n    class Viewport {\n        constructor() {\n            this._window = window;\n            this._html = document.documentElement;\n            this._body = document.body;\n\n            this._frame1 = this._window;\n            this._frame2 = this._html || this._body;\n            this._prefix1 = 'inner';\n            this._prefix2 = 'offset';\n            if (!this._prefix1 + 'Width' in this._frame1) {\n                this._prefix1 = 'client';\n                this._frame1 = this._frame2;\n            }\n\n            this._offsetWidth = 0;\n            this._offsetHeight = 0;\n            this._width = 0;\n            this._height = 0;\n            this._scrollTop = 0;\n            this._scrollLeft = 0;\n\n            this._lock = false;\n\n            this.calcAll();\n        }\n\n        get offsetWidth() {\n            return this._offsetWidth;\n        }\n        get offsetHeight() {\n            return this._offsetHeight;\n        }\n        get width() {\n            return this._width;\n        }\n        get height() {\n            return this._height;\n        }\n        get scrollTop() {\n            return this._scrollTop;\n        }\n        get scrollLeft() {\n            return this._scrollLeft;\n        }\n        get all() {\n            return {\n                offsetWidth: this.offsetWidth,\n                offsetHeight: this.offsetHeight,\n                width: this.width,\n                height: this.height,\n                scrollTop: this.scrollTop,\n                scrollLeft: this.scrollLeft\n            };\n        }\n\n        calcOffsetWidth() {\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\n            return this.offsetWidth;\n        }\n        calcOffsetHeight() {\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\n            return this.offsetHeight;\n        }\n        calcWidth() {\n            this._width = this._frame1[this._prefix1 + 'Width'];\n            return this.width;\n        }\n        calcHeight() {\n            this._height = this._frame1[this._prefix1 + 'Height'];\n            return this.height;\n        }\n        calcScrollTop() {\n            this._scrollTop = this._frame2.scrollTop || 0;\n            return this.scrollTop;\n        }\n        calcScrollLeft() {\n            this._scrollLeft = this._frame2.scrollLeft || 0;\n            return this.scrollLeft;\n        }\n        calcAll() {\n            this.calcOffsetWidth();\n            this.calcOffsetHeight();\n            this.calcWidth();\n            this.calcHeight();\n            this.calcScrollTop();\n            this.calcScrollLeft();\n            return this.all;\n        }\n\n        get lock() {\n            return this._lock;\n        }\n\n        set lock(bool) {\n            this._lock = bool;\n\n            if (this._lock) {\n                this._body.style.top = -this.calcScrollTop() + 'px';\n                this._body.style.left = -this.calcScrollLeft() + 'px';\n\n                let scrollBarWidth = this.calcOffsetWidth();\n                let scrollBarHeight = this.calcOffsetHeight();\n\n                this._html.style.top = '0px';\n                this._html.style.left = '0px';\n                this._html.style.position = 'fixed';\n                this._body.style.position = 'fixed';\n                this._html.style.width = '100%';\n                this._body.style.width = '100%';\n\n                let offsetWidth = this.calcOffsetWidth();\n                let offsetHeight = this.calcOffsetHeight();\n                scrollBarWidth = offsetWidth - scrollBarWidth;\n                scrollBarHeight = offsetHeight - scrollBarHeight;\n\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\n            } else {\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\n\n                this._html.style.position = '';\n                this._html.style.top = '';\n                this._html.style.left = '';\n                this._html.style.width = '';\n                this._body.style.position = '';\n                this._body.style.top = '';\n                this._body.style.left = '';\n                this._body.style.width = '';\n\n                this._window.scroll({\n                    top: scrollTop,\n                    left: scrollLeft,\n                    behavior: 'instant'\n                });\n            }\n        }\n    }\n\n    /**\n     * @param {HTMLElement} element\n     * @returns {Boolean}\n     */\n    const isElementInViewport = element => !!getBoundsViewportIntersection(element.getBoundingClientRect()).ratio;\n\n    /**\n     * @param {DOMRect} bounds\n     * @returns {Object}\n     */\n    const getBoundsViewportIntersection = bounds => {\n        const viewport = new Viewport();\n\n        if (bounds.right < 0 || bounds.bottom < 0 || bounds.left > viewport.width || bounds.top > viewport.height) {\n            return {\n                x: 0,\n                y: 0,\n                ratio: 0\n            };\n        }\n\n        const offTop = bounds.top < 0;\n        const offBottom = bounds.top + bounds.height > viewport.height;\n        const offLeft = bounds.left < 0;\n        const offRight = bounds.left + bounds.width > viewport.width;\n\n        if (!offTop && !offBottom && !offLeft && !offRight) {\n            return {\n                x: 100,\n                y: 100,\n                ratio: 100\n            };\n        }\n\n        let offY = 0;\n        let offX = 0;\n\n        if (offTop) {\n            offY = Math.abs(bounds.top);\n        }\n\n        if (offBottom) {\n            offY = bounds.top + bounds.height - viewport.height;\n        }\n\n        if (offLeft) {\n            offX = Math.abs(bounds.left);\n        }\n\n        if (offRight) {\n            offX = bounds.left + bounds.width - viewport.width;\n        }\n\n        const percentageX = roundPercentage(((bounds.width - offX) * 100) / (bounds.width || 1));\n        const percentageY = roundPercentage(((bounds.height - offY) * 100) / (bounds.height || 1));\n\n        return {\n            x: percentageX,\n            y: percentageY,\n            ratio: Math.min(percentageX, percentageY)\n        };\n    };\n\n    const ID = uniqueID();\n\n    /**\n     *\n     * TODO: find a way to get a recap of what Resource items were loaded and what failed in collection list...\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n\n            if (!isIntersectionObserverSupported) {\n                this.manuallyObservedElements = [];\n\n                const manuallyObserve = () =>\n                    this.manuallyObservedElements.filter(item => !item.intersected).forEach(item => {\n                        if (!item.intersected && isElementInViewport(item.element)) {\n                            item.intersected = true;\n                            item.element.dispatchEvent(new CustomEvent('intersected__' + ID));\n                        }\n                    });\n\n                window.addEventListener('scroll', manuallyObserve);\n                window.addEventListener('resize', manuallyObserve);\n                window.addEventListener('load', manuallyObserve);\n            }\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    this._collection = [];\n\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('abort__' + ID)));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('This Loader instance is already in progress');\n                }\n\n                if (!this._collection.length) {\n                    reject('Resources collection is empty');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            return;\n                        }\n\n                        this.fetch(this._collection[loaded])\n                            .catch(payload => {\n                                console.warn(payload.event.detail.message + ': ' + payload.resource.url);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: more robust way, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded < this._collection.length) {\n                                    pipeline();\n\n                                    return;\n                                }\n\n                                this._state = 0;\n\n                                resolve(payload);\n                            });\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            break;\n                        }\n\n                        this.fetch(this._collection[i])\n                            .catch(payload => {\n                                console.warn(payload.event.detail.message + ': ' + payload.resource.url);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: more robust way, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded >= this._collection.length) {\n                                    this._state = 0;\n\n                                    resolve();\n                                }\n                            });\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(resource.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (resource.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = (event, resolver) => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    resolver({\n                        event: event,\n                        resource: resource\n                    });\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = (eventName = '', data = {}) => {\n                    const event = new CustomEvent(eventName, {\n                        detail: {\n                            ...data,\n                            ...{\n                                resource: resource\n                            }\n                        }\n                    });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n\n                    return event;\n                };\n\n                let queuer = {\n                    resource: resource,\n                    observer: null,\n                    element: createdElement\n                };\n\n                createdElement.addEventListener('abort__' + ID, () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: 'abortion',\n                        message: 'Resource load aborted'\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                mainEventsTarget.addEventListener('error', e => {\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: e.type,\n                        message: 'Resource failed to load' // TODO: a way to retrieve http error code ?\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire \"load\" event when ready in dom\n                        }\n\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', e => {\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy) {\n                    if (isIntersectionObserverSupported) {\n                        queuer.observer = new IntersectionObserver(\n                            (entries, observer) => {\n                                entries.forEach(entry => {\n                                    if (entry.intersectionRatio > 0) {\n                                        observer.unobserve(entry.target);\n\n                                        prepareLoad();\n                                    }\n                                });\n                            },\n                            {\n                                root: null,\n                                rootMargin: '0px',\n                                threshold: 0.1\n                            }\n                        );\n\n                        queuer.observer.observe(resource.element);\n                    } else {\n                        if (isElementInViewport(resource.element)) {\n                            prepareLoad();\n                        } else {\n                            this.manuallyObservedElements.push({\n                                element: resource.element,\n                                intersected: false\n                            });\n                            resource.element.addEventListener('intersected__' + ID, () => prepareLoad());\n                        }\n                    }\n\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.min.js"}