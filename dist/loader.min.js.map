{"version":3,"sources":["loader.mjs"],"names":["_objectSpread","target","i","arguments","length","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","_possibleConstructorReturn","self","call","_typeof","_assertThisInitialized","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","create","constructor","_setPrototypeOf","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","has","get","set","Wrapper","_construct","_getPrototypeOf","this","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","e","Parent","args","a","push","apply","instance","Function","bind","fn","indexOf","o","p","setPrototypeOf","__proto__","getPrototypeOf","_classCallCheck","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","Symbol","iterator","Array","from","isArray","arr2","global","factory","exports","module","define","amd","Loader","isInArray","needle","heystack","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","values","reduce","b","Resource","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","_format","LoaderPromise","_Promise","_this","resolve","reject","_progress","listener","error","Promise","handler","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","el","parentElement","attribute","j","getAttribute","switchAttributes","attrs","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","_options","playthrough","sequential","_collection","_queue","_load","_percentage","_state","data","dispatchEvent","CustomEvent","_this2","progress","loaded","pipeline","loadStep","resource","cb","load","fetch","then","catch","_this3","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","style","visibility","position","top","left","width","height","appendChild","createdSource","append","finishPromise","removeChild","delete","prepareLoad","event","detail","queuer","observer","addEventListener","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","_this4","NodeList","isResource","pushCheck","console","warn"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => heystack.indexOf(needle) > -1;\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     *\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('Aborted')));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('A Loader instance is already in progress.');\n                }\n                if (!this._collection.length) {\n                    reject('Collection is empty.');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            return;\n                        }\n\n                        const loadStep = (resource, cb) => {\n                            loaded++;\n\n                            this._percentage = (loaded / this._collection.length) * 100;\n\n                            progress(resource);\n\n                            if (loaded < this._collection.length) {\n                                pipeline();\n\n                                return;\n                            }\n\n                            this._state = 0;\n\n                            cb();\n                        };\n\n                        const load = this.fetch(this._collection[loaded]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject('Error')));\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n                    const loadStep = (e, cb) => {\n                        loaded++;\n\n                        this._percentage = (loaded / this._collection.length) * 100;\n\n                        progress(e);\n\n                        if (loaded >= this._collection.length) {\n                            this._state = 0;\n\n                            cb();\n                        }\n                    };\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            break;\n                        }\n\n                        const load = this.fetch(this._collection[i]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject(e)));\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(resource.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (resource.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = cb => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    cb(resource);\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = type => {\n                    const event = new CustomEvent(type, { detail: resource });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n                };\n\n                let queuer = { resource: resource, observer: null, element: createdElement };\n\n                // TODO: \"abort\" custom event must be \"private\" . instance?\n                createdElement.addEventListener('abort', () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    finishPromise(reject);\n                });\n\n                mainEventsTarget.addEventListener('error', () => {\n                    finishPromise(reject);\n\n                    dispatchEvent('resourceError');\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire load at landing\n                        }\n\n                        finishPromise(resolve);\n\n                        dispatchEvent('resourceLoad');\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', () => {\n                        finishPromise(resolve);\n\n                        dispatchEvent('resourceLoad');\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy && 'IntersectionObserver' in window) {\n                    queuer.observer = new IntersectionObserver(\n                        (entries, observer) => {\n                            entries.forEach(entry => {\n                                if (entry.intersectionRatio > 0) {\n                                    observer.unobserve(entry.target);\n\n                                    prepareLoad();\n                                }\n                            });\n                        },\n                        { root: null, rootMargin: '0px', threshold: 0.1 }\n                    );\n\n                    queuer.observer.observe(resource.element);\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.min.js"}