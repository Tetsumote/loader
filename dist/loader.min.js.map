{"version":3,"sources":["loader.mjs"],"names":["_objectSpread","target","i","arguments","length","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","_possibleConstructorReturn","self","call","_typeof","_assertThisInitialized","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","create","constructor","_setPrototypeOf","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","has","get","set","Wrapper","_construct","_getPrototypeOf","this","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","e","Parent","args","a","push","apply","instance","Function","bind","fn","indexOf","o","p","setPrototypeOf","__proto__","getPrototypeOf","_classCallCheck","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","Symbol","iterator","Array","from","isArray","arr2","global","factory","exports","module","define","amd","Loader","isInArray","needle","heystack","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","values","reduce","b","Resource","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","_format","LoaderPromise","_Promise","_this","resolve","reject","_progress","listener","error","Promise","handler","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","el","parentElement","attribute","j","getAttribute","switchAttributes","attrs","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","roundPercentage","percentage","num","decimals","parseFloat","toFixed","roundDecimals","isIntersectionObserverSupported","Viewport","_window","_html","documentElement","_body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","bool","style","top","left","scrollBarWidth","scrollBarHeight","position","Math","abs","scroll","behavior","isElementInViewport","getBoundsViewportIntersection","getBoundingClientRect","ratio","bounds","viewport","right","bottom","y","offTop","offBottom","offLeft","offRight","offY","offX","percentageX","percentageY","min","_this2","_options","playthrough","sequential","_collection","_queue","_load","_percentage","_state","manuallyObservedElements","manuallyObserve","intersected","dispatchEvent","CustomEvent","addEventListener","data","_this3","progress","loaded","pipeline","loadStep","resource","cb","load","fetch","then","catch","resolver","_this4","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","visibility","appendChild","createdSource","append","finishPromise","removeChild","delete","prepareLoad","event","detail","queuer","observer","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","_this5","NodeList","isResource","pushCheck","console","warn"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {(string|number)} num\n     * @returns {number}\n     */\n    const roundDecimals = (num, decimals = 4) => parseFloat(num.toFixed(decimals));\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => heystack.indexOf(needle) > -1;\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     * @param {Number} percentage\n     * @returns {Number}\n     */\n    const roundPercentage = percentage => {\n        if (percentage > 100) {\n            percentage = 100;\n        } else if (percentage < 0) {\n            percentage = 0;\n        } else {\n            percentage = roundDecimals(percentage, 4);\n        }\n\n        return percentage;\n    };\n\n    const isIntersectionObserverSupported = 'IntersectionObserver' in window;\n\n    /**\n     *\n     */\n    class Viewport {\n        constructor() {\n            this._window = window;\n            this._html = document.documentElement;\n            this._body = document.body;\n\n            this._frame1 = this._window;\n            this._frame2 = this._html || this._body;\n            this._prefix1 = 'inner';\n            this._prefix2 = 'offset';\n            if (!this._prefix1 + 'Width' in this._frame1) {\n                this._prefix1 = 'client';\n                this._frame1 = this._frame2;\n            }\n\n            this._offsetWidth = 0;\n            this._offsetHeight = 0;\n            this._width = 0;\n            this._height = 0;\n            this._scrollTop = 0;\n            this._scrollLeft = 0;\n\n            this._lock = false;\n\n            this.calcAll();\n        }\n\n        get offsetWidth() {\n            return this._offsetWidth;\n        }\n        get offsetHeight() {\n            return this._offsetHeight;\n        }\n        get width() {\n            return this._width;\n        }\n        get height() {\n            return this._height;\n        }\n        get scrollTop() {\n            return this._scrollTop;\n        }\n        get scrollLeft() {\n            return this._scrollLeft;\n        }\n        get all() {\n            return {\n                offsetWidth: this.offsetWidth,\n                offsetHeight: this.offsetHeight,\n                width: this.width,\n                height: this.height,\n                scrollTop: this.scrollTop,\n                scrollLeft: this.scrollLeft\n            };\n        }\n\n        calcOffsetWidth() {\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\n            return this.offsetWidth;\n        }\n        calcOffsetHeight() {\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\n            return this.offsetHeight;\n        }\n        calcWidth() {\n            this._width = this._frame1[this._prefix1 + 'Width'];\n            return this.width;\n        }\n        calcHeight() {\n            this._height = this._frame1[this._prefix1 + 'Height'];\n            return this.height;\n        }\n        calcScrollTop() {\n            this._scrollTop = this._frame2.scrollTop || 0;\n            return this.scrollTop;\n        }\n        calcScrollLeft() {\n            this._scrollLeft = this._frame2.scrollLeft || 0;\n            return this.scrollLeft;\n        }\n        calcAll() {\n            this.calcOffsetWidth();\n            this.calcOffsetHeight();\n            this.calcWidth();\n            this.calcHeight();\n            this.calcScrollTop();\n            this.calcScrollLeft();\n            return this.all;\n        }\n\n        get lock() {\n            return this._lock;\n        }\n\n        set lock(bool) {\n            this._lock = bool;\n\n            if (this._lock) {\n                this._body.style.top = -this.calcScrollTop() + 'px';\n                this._body.style.left = -this.calcScrollLeft() + 'px';\n\n                let scrollBarWidth = this.calcOffsetWidth();\n                let scrollBarHeight = this.calcOffsetHeight();\n\n                this._html.style.top = '0px';\n                this._html.style.left = '0px';\n                this._html.style.position = 'fixed';\n                this._body.style.position = 'fixed';\n                this._html.style.width = '100%';\n                this._body.style.width = '100%';\n\n                let offsetWidth = this.calcOffsetWidth();\n                let offsetHeight = this.calcOffsetHeight();\n                scrollBarWidth = offsetWidth - scrollBarWidth;\n                scrollBarHeight = offsetHeight - scrollBarHeight;\n\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\n            } else {\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\n\n                this._html.style.position = '';\n                this._html.style.top = '';\n                this._html.style.left = '';\n                this._html.style.width = '';\n                this._body.style.position = '';\n                this._body.style.top = '';\n                this._body.style.left = '';\n                this._body.style.width = '';\n\n                this._window.scroll({\n                    top: scrollTop,\n                    left: scrollLeft,\n                    behavior: 'instant'\n                });\n            }\n        }\n    }\n\n    /**\n     * @param {HTMLElement} element\n     * @returns {Boolean}\n     */\n    const isElementInViewport = element => !!getBoundsViewportIntersection(element.getBoundingClientRect()).ratio;\n\n    /**\n     * @param {DOMRect} bounds\n     * @returns {Object}\n     */\n    const getBoundsViewportIntersection = bounds => {\n        const viewport = new Viewport();\n\n        if (bounds.right < 0 || bounds.bottom < 0 || bounds.left > viewport.width || bounds.top > viewport.height) {\n            return {\n                x: 0,\n                y: 0,\n                ratio: 0\n            };\n        }\n\n        const offTop = bounds.top < 0;\n        const offBottom = bounds.top + bounds.height > viewport.height;\n        const offLeft = bounds.left < 0;\n        const offRight = bounds.left + bounds.width > viewport.width;\n\n        if (!offTop && !offBottom && !offLeft && !offRight) {\n            return {\n                x: 100,\n                y: 100,\n                ratio: 100\n            };\n        }\n\n        let offY = 0;\n        let offX = 0;\n\n        if (offTop) {\n            offY = Math.abs(bounds.top);\n        }\n\n        if (offBottom) {\n            offY = bounds.top + bounds.height - viewport.height;\n        }\n\n        if (offLeft) {\n            offX = Math.abs(bounds.left);\n        }\n\n        if (offRight) {\n            offX = bounds.left + bounds.width - viewport.width;\n        }\n\n        const percentageX = roundPercentage(((bounds.width - offX) * 100) / (bounds.width || 1));\n        const percentageY = roundPercentage(((bounds.height - offY) * 100) / (bounds.height || 1));\n\n        return {\n            x: percentageX,\n            y: percentageY,\n            ratio: Math.min(percentageX, percentageY)\n        };\n    };\n\n    /**\n     *\n     *\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n\n            if (!isIntersectionObserverSupported) {\n                this.manuallyObservedElements = [];\n\n                const manuallyObserve = () =>\n                    this.manuallyObservedElements.filter(item => !item.intersected).forEach(item => {\n                        if (!item.intersected && isElementInViewport(item.element)) {\n                            item.intersected = true;\n                            // TODO: use a class-instance-relative generated-id to privatize internal custom event\n                            item.element.dispatchEvent(new CustomEvent('intersected'));\n                        }\n                    });\n\n                window.addEventListener('scroll', manuallyObserve);\n                window.addEventListener('resize', manuallyObserve);\n                window.addEventListener('load', manuallyObserve);\n            }\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('Aborted')));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            /**\n             * TODO: error cause Uncaught in Promise...\n             * TODO: returned argument catch/then methods, then should return something else, error should return something more detailed to the error intercurse (?)\n             */\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('A Loader instance is already in progress.');\n                }\n                if (!this._collection.length) {\n                    reject('Collection is empty.');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            return;\n                        }\n\n                        const loadStep = (resource, cb) => {\n                            loaded++;\n\n                            this._percentage = (loaded / this._collection.length) * 100;\n\n                            progress(resource);\n\n                            if (loaded < this._collection.length) {\n                                pipeline();\n\n                                return;\n                            }\n\n                            this._state = 0;\n\n                            cb(resource);\n                        };\n\n                        const load = this.fetch(this._collection[loaded]);\n                        load.then(resource => loadStep(resource, resolve));\n                        load.catch(resource => loadStep(resource, reject));\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n                    const loadStep = (resource, resolver) => {\n                        loaded++;\n\n                        this._percentage = (loaded / this._collection.length) * 100;\n\n                        progress(resource);\n\n                        if (loaded >= this._collection.length) {\n                            this._state = 0;\n\n                            resolver(resource);\n                        }\n                    };\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            break;\n                        }\n\n                        const load = this.fetch(this._collection[i]);\n                        load.then(resource => loadStep(resource, resolve));\n                        load.catch(resource => loadStep(resource, reject));\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(resource.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (resource.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = cb => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    cb(resource);\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = type => {\n                    const event = new CustomEvent(type, { detail: resource });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n                };\n\n                let queuer = { resource: resource, observer: null, element: createdElement };\n\n                // TODO: use a class-instance-relative generated-id to privatize internal custom event\n                createdElement.addEventListener('abort', () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    finishPromise(reject);\n                });\n\n                mainEventsTarget.addEventListener('error', () => {\n                    finishPromise(reject);\n\n                    dispatchEvent('resourceError');\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire \"load\" event when ready in dom\n                        }\n\n                        finishPromise(resolve);\n\n                        dispatchEvent('resourceLoad');\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', () => {\n                        finishPromise(resolve);\n\n                        dispatchEvent('resourceLoad');\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy) {\n                    if (isIntersectionObserverSupported) {\n                        queuer.observer = new IntersectionObserver(\n                            (entries, observer) => {\n                                entries.forEach(entry => {\n                                    if (entry.intersectionRatio > 0) {\n                                        observer.unobserve(entry.target);\n\n                                        prepareLoad();\n                                    }\n                                });\n                            },\n                            {\n                                root: null,\n                                rootMargin: '0px',\n                                threshold: 0.1\n                            }\n                        );\n\n                        queuer.observer.observe(resource.element);\n                    } else {\n                        if (isElementInViewport(resource.element)) {\n                            prepareLoad();\n                        } else {\n                            this.manuallyObservedElements.push({\n                                element: resource.element,\n                                intersected: false\n                            });\n                            resource.element.addEventListener('intersected', () => prepareLoad());\n                        }\n                    }\n\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.min.js"}