{"version":3,"sources":["loader.mjs"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread","arguments","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","obj","value","_typeof","Symbol","iterator","constructor","global","factory","exports","module","define","amd","self","Loader","head","document","querySelector","defaults","url","proxy","attr","success","error","host","ILoad","options","undefined","Promise","resolve","reject","removeChild","message","lineno","colno","appendChild","window","requestAnimationFrame","disabled","hidden","defaults$1","IMediaLoad","SupportedFileExtensions","IMAGE","AUDIO","VIDEO","SCRIPT","STYLE","parseResource","resource","HTMLElement","element","currentSrc","Error","parseElementResource","string","format","RegExp","concat","test","split","pop","reduce","x","y","extensions","join","toLowerCase","match","type","parseStringResource","loaders","image","createElement","audio","video","tag","style","link","rel","script","_load","e","then","resources","this","_resources","_this"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global = global || self, global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    const head = document.querySelector(\"head\");\n\n    /**\n     *\n     * @param url\n     * @param tag\n     * @param success\n     * @param error\n     * @param parentTarget\n     */\n    const defaults = {\n        url: \"\",\n        proxy: null,\n        attr: \"src\",\n        success: \"onload\",\n        error: \"onerror\",\n        host: null\n    };\n\n    const ILoad = (options = defaults) =>\n        new Promise((resolve, reject) => {\n            options = { ...defaults, ...options };\n\n            options.proxy[options.success] = () => {\n                if (options.host) {\n                    options.host.removeChild(options.proxy);\n                }\n\n                resolve(options.url);\n            };\n            \n            options.proxy[options.error] = (\n                message,\n                source,\n                lineno,\n                colno,\n                error\n            ) => reject(error);\n\n            options.proxy[options.attr] = options.url;\n\n            if (!options.host) {\n                return;\n            }\n\n            options.host.appendChild(options.proxy);\n\n            window.requestAnimationFrame(() => {\n                options.proxy.disabled = \"disabled\";\n                options.proxy.hidden = \"hidden\";\n            });\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadStyle = url =>\n        ILoad({\n            url: url,\n            proxy: (() => {\n                const link = document.createElement(\"link\");\n\n                link.rel = \"stylesheet\";\n\n                return link;\n            })(),\n            attr: \"href\",\n            host: head\n        });\n\n    // TODO: check ff?\n    /* new Promise((resolve, reject) => {\n            const proxy = document.createElement(\"style\");\n\n            proxy.textContent = '@import \"' + url + '\"';\n\n            const loop = () =>\n                window.requestAnimationFrame(() => {\n                    if (proxy.sheet.cssRules) {\n                        resolve(url);\n\n                        return;\n                    }\n\n                    loop();\n                });\n\n            loop();\n\n            // TODO: reject(new Error(\"?\"))\n\n            head.appendChild(proxy);\n        }); */\n\n    /**\n     *\n     * @param url\n     */\n    const loadScript = url =>\n        ILoad({\n            url: url,\n            proxy: document.createElement(\"script\"),\n            host: head\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadImage = url =>\n        ILoad({\n            url: url,\n            proxy: document.createElement(\"img\")\n        });\n\n    const defaults$1 = {\n        url: \"\",\n        proxy: null\n    };\n\n    /**\n     *\n     * @param url\n     * @param tag\n     */\n    const IMediaLoad = (options = defaults$1) =>\n        ILoad({\n            ...{ ...options, ...defaults$1 },\n            ...{ success: \"onloadedmetadata\" }\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadAudio = url =>\n        IMediaLoad({\n            url: url,\n            proxy: document.createElement(\"audio\")\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadVideo = url =>\n        IMediaLoad({\n            url: url,\n            tag: document.createElement(\"video\")\n        });\n\n    const SupportedFileExtensions = {\n        IMAGE: [\n            \"jp[e]?g\",\n            \"jpe\",\n            \"jif\",\n            \"jfif\",\n            \"jfi\",\n            \"gif\",\n            \"png\",\n            \"tif[f]?\",\n            \"bmp\",\n            \"dib\",\n            \"webp\",\n            \"ico\",\n            \"cur\",\n            \"svg\"\n        ],\n        AUDIO: [\"mp3\", \"ogg\", \"oga\", \"spx\", \"ogg\", \"wav\"],\n        VIDEO: [\"mp4\", \"ogg\", \"ogv\", \"webm\"],\n        SCRIPT: [\"js\", \"mjs\"],\n        STYLE: [\"css\"]\n    };\n\n    const BASE_64_HEAD = \";base64,\";\n\n    /**\n     *\n     * @param string\n     */\n    const parseStringResource = string => {\n        if (!new RegExp(`${BASE_64_HEAD}`).test(string)) {\n            string = string\n                .split(\",\")\n                .pop() // gets the last\n                .split(\" \")\n                .reduce((x, y) => (x.length > y.length ? x : y)); // gets the longest fragment in order to skip \"x2\", \"\" etc...\n        }\n\n        for (let format in SupportedFileExtensions) {\n            const extensions = SupportedFileExtensions[format].join(\"|\");\n\n            format = format.toLowerCase();\n\n            if (\n                new RegExp(\n                    `(.(${extensions})$)|data:${format}/(${extensions})${BASE_64_HEAD}`\n                ).test(string)\n            ) {\n                const matches =\n                    string.match(new RegExp(`.(${extensions})$`, \"g\")) ||\n                    string.match(\n                        new RegExp(`^data:${format}/(${extensions})`, \"g\")\n                    );\n\n                if (null !== matches) {\n                    return {\n                        type: format,\n                        url: string /*,\n                        extension: matches[0]\n                            .replace(`data:${format}/`, \"\")\n                            .replace(\".\", \"\")*/\n                    };\n                }\n            }\n        }\n\n        throw new Error(\"Error while parsing the resource string.\");\n    };\n\n    /**\n     *\n     * @param element\n     */\n    const parseElementResource = element => {\n        if (\"currentSrc\" in element) {\n            return element.currentSrc;\n        }\n\n        throw new Error(\"Error while parsing the resource element.\");\n    };\n\n    /**\n     *\n     * @param resource\n     */\n    const parseResource = resource => {\n        if (resource instanceof HTMLElement) {\n            resource = parseElementResource(resource);\n        }\n\n        if (typeof resource === \"string\") {\n            resource = parseStringResource(resource);\n        }\n\n        return resource;\n    };\n\n    const loaders = {\n        image: loadImage,\n        audio: loadAudio,\n        video: loadVideo,\n        style: loadStyle,\n        script: loadScript\n    };\n\n    /**\n     *\n     * @param resource\n     */\n    const load = resource =>\n        new Promise((resolve, reject) => {\n            try {\n                resource = parseResource(resource);\n            } catch (e) {\n                reject(e);\n            }\n\n            loaders[resource.type](resource.url)\n                .then(resolve)\n                .catch(reject);\n        });\n\n    /**\n     *\n     */\n    class Loader {\n        constructor(resources = []) {\n            this._resources = resources;\n        }\n\n        /**\n         *\n         */\n        load() {\n            return new Promise((resolve, reject) => {\n                for (var key in this._resources) {\n                    load(this._resources[key])\n                        .then(resolve)\n                        .catch(reject);\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.min.js"}