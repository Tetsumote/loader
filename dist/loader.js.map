{"version":3,"sources":["loader.js"],"names":["global","factory","exports","module","define","amd","Loader","isInArray","needle","heystack","indexOf","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","Object","values","reduce","a","b","concat","Media","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","LoaderPromise","fn","resolve","reject","_progress","forEach","listener","value","error","handler","push","Promise","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","filter","el","parentElement","source","target","length","attribute","i","j","getAttribute","switchAttributes","attrs","keys","dataAttr","attr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","_options","playthrough","sequential","_collection","_queue","Map","_load","_percentage","_state","data","dispatchEvent","CustomEvent","progress","loaded","pipeline","loadStep","cb","load","fetch","then","e","catch","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","style","visibility","position","top","left","width","height","appendChild","createdSource","append","finishPromise","removeChild","delete","prepareLoad","event","detail","queuer","observer","addEventListener","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","set","isMedia","Array","isArray","pushCheck","console","warn"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAC,WAAUA,MAAV,EAAkBC,OAAlB,EAA2B;AACxB,YAAOC,OAAP,yCAAOA,OAAP,OAAmB,QAAnB,IAA+B,OAAOC,MAAP,KAAkB,WAAjD,GAA+DA,OAAOD,OAAP,GAAiBD,SAAhF,GACA,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAAvC,GAA6CD,OAAO,QAAP,EAAiBH,OAAjB,CAA7C,GACCD,OAAOM,MAAP,GAAgBL,SAFjB;AAGH,CAJA,EAIC,IAJD,EAIQ,YAAY;AAAE;;AAanB,QAAMM,YAAY,SAAZA,SAAY,CAACC,MAAD,EAASC,QAAT,EAAsB;AACpC,eAAOA,SAASC,OAAT,CAAiBF,MAAjB,IAA2B,CAAC,CAAnC;AACH,KAFD;;AAWA,QAAMG,cAAc,SAAdA,WAAc,CAACC,OAAD,EAAUC,QAAV;AAAA,eAAuBC,OAAOC,gBAAP,CAAwBH,OAAxB,EAAiCI,gBAAjC,CAAkDH,QAAlD,CAAvB;AAAA,KAApB;;AAEA,QAAMI,sBAAsB;AACxBC,eAAO,CAAC,SAAD,EAAY,KAAZ,EAAmB,KAAnB,EAA0B,MAA1B,EAAkC,KAAlC,EAAyC,KAAzC,EAAgD,KAAhD,EAAuD,SAAvD,EAAkE,KAAlE,EAAyE,KAAzE,EAAgF,MAAhF,EAAwF,KAAxF,EAA+F,KAA/F,EAAsG,KAAtG,CADiB;AAExBC,eAAO,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,EAA6B,KAA7B,EAAoC,KAApC,CAFiB;AAGxBC,eAAO,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,MAAtB;AAHiB,KAA5B;AAKA,QAAMC,gBAAgB;AAClBH,eAAO,CAAC,KAAD,EAAQ,SAAR,CADW;AAElBC,eAAO,CAAC,OAAD,CAFW;AAGlBC,eAAO,CAAC,OAAD,CAHW;AAIlBE,eAAO,CAAC,QAAD,CAJW,EAAtB;AAMA,QAAMC,gDAAuB,IAAIC,GAAJ,CAAQC,OAAOC,MAAP,CAAcL,aAAd,EAA6BM,MAA7B,CAAoC,UAACC,CAAD,EAAIC,CAAJ;AAAA,eAAUD,EAAEE,MAAF,CAASD,CAAT,CAAV;AAAA,KAApC,CAAR,CAAvB,EAAN;;AArCiB,QA2CXE,KA3CW;AA4Cb,uBAAYC,IAAZ,EAAkB;AAAA;;AACd,gBAAMC,YAAYD,KAAKpB,OAAL,YAAwBsB,WAA1C;;AAEA,iBAAKC,GAAL,GAAWH,KAAKG,GAAhB;AACA,iBAAKC,UAAL,GAAkBH,aAAa1B,UAAUyB,KAAKpB,OAAL,CAAayB,OAAb,CAAqBC,WAArB,EAAV,EAA8Cf,gBAA9C,CAA/B;AACA,iBAAKX,OAAL,GAAeqB,YAAYD,KAAKpB,OAAjB,GAA2B,IAA1C;AACA,iBAAKyB,OAAL,GAAe,KAAKD,UAAL,GAAkB,KAAKxB,OAAL,CAAayB,OAAb,CAAqBC,WAArB,EAAlB,GAAuD,IAAtE;AACA,iBAAKC,IAAL,GAAY,IAAZ;AACA,iBAAKC,SAAL,GAAiB,IAAjB;;AAEA,gBAAI,CAAC,KAAKL,GAAV,EAAe;AACX;AACH;;AAED,iBAAKA,GAAL,GAAWH,KAAKG,GAAhB;;AAEA,iBAAK,IAAIM,MAAT,IAAmBxB,mBAAnB,EAAwC;AACpC,oBAAMyB,aAAazB,oBAAoBwB,MAApB,EAA4BE,IAA5B,CAAiC,GAAjC,CAAnB;;AAEA,oBAAI,IAAIC,MAAJ,CAAW,QAAQF,UAAR,GAAqB,WAArB,GAAmCD,MAAnC,GAA4C,IAA5C,GAAmDC,UAAnD,GAAgE,WAA3E,EAAwFG,IAAxF,CAA6F,KAAKV,GAAlG,CAAJ,EAA4G;AACxG,wBAAMW,UAAU,KAAKX,GAAL,CAASY,KAAT,CAAe,IAAIH,MAAJ,CAAW,OAAOF,UAAP,GAAoB,IAA/B,EAAqC,GAArC,CAAf,KAA6D,KAAKP,GAAL,CAASY,KAAT,CAAe,IAAIH,MAAJ,CAAW,WAAWH,MAAX,GAAoB,IAApB,GAA2BC,UAA3B,GAAwC,GAAnD,EAAwD,GAAxD,CAAf,CAA7E;;AAEA,wBAAI,SAASI,OAAb,EAAsB;AAClB,6BAAKP,IAAL,GAAYE,MAAZ;AACA,6BAAKD,SAAL,GAAiBM,QAAQ,CAAR,EAAWE,OAAX,CAAmB,UAAUP,MAAV,GAAmB,GAAtC,EAA2C,EAA3C,EAA+CO,OAA/C,CAAuD,GAAvD,EAA4D,EAA5D,CAAjB;AACA,6BAAKX,OAAL,GAAe,KAAKA,OAAL,GAAe,KAAKA,OAApB,GAA8BhB,cAAcoB,MAAd,EAAsB,CAAtB,CAA7C;;AAEA;AACH;AACJ;AACJ;;AAED,gBAAI,KAAKL,UAAL,KAAoB,KAAKC,OAAL,KAAiB,OAAjB,IAA4B,KAAKA,OAAL,KAAiB,OAA7C,IAAwD,KAAKA,OAAL,KAAiB,QAA7F,CAAJ,EAA4G;AACxG,qBAAKE,IAAL,GAAY,KAAKF,OAAjB;AACH,aAFD,MAEO,IAAI,KAAKA,OAAT,EAAkB;AACrB,qBAAK,IAAII,OAAT,IAAmBpB,aAAnB,EAAkC;AAC9B,wBAAId,UAAU,KAAK8B,OAAf,EAAwBhB,cAAcoB,OAAd,CAAxB,CAAJ,EAAoD;AAChD,6BAAKF,IAAL,GAAYE,OAAZ;AACA;AACH;AACJ;AACJ;AACJ;;AAtFY;AAAA;AAAA,oCAwFET,IAxFF,EAwFQ;AACjB,uBAAO,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IAA4B,aAAaA,IAAzC,IAAiD,UAAUA,IAA3D,IAAmE,SAASA,IAA5E,IAAoF,eAAeA,IAAnG,IAA2G,aAAaA,IAA/H;AACH;AA1FY;;AAAA;AAAA;;AAAA,QAgGXiB,aAhGW;AAAA;;AAiGb,+BAAYC,EAAZ,EAAgB;AAAA;;AAAA,sIACN,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvBF,mBAAGC,OAAH,EAAYC,MAAZ,EAAoB,iBAAS;AACzB,wBAAI;AACA,+BAAO,MAAKC,SAAL,CAAeC,OAAf,CAAuB;AAAA,mCAAYC,SAASC,KAAT,CAAZ;AAAA,yBAAvB,CAAP;AACH,qBAFD,CAEE,OAAOC,KAAP,EAAc;AACZL,+BAAOK,KAAP;AACH;AACJ,iBAND;AAOH,aATW;;AAWZ,kBAAKJ,SAAL,GAAiB,EAAjB;AAXY;AAYf;;AA7GY;AAAA;AAAA,qCA+GJK,OA/GI,EA+GK;AACd,oBAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;AAC/B,yBAAKL,SAAL,CAAeM,IAAf,CAAoBD,OAApB;AACH;;AAED,uBAAO,IAAP;AACH;AArHY;;AAAA;AAAA,MAgGWE,OAhGX;;AA8HjB,QAAMC,OAAO,SAAPA,IAAO,GAA2C;AAAA,YAA1CjD,OAA0C,uEAAhCkD,SAASC,IAAuB;AAAA,YAAjBC,OAAiB,uEAAP,EAAO;;AACpD,YAAIC,oBACG;AACCC,2BAAe;AACXC,qBAAK,CAAC,CAAC,CAACH,QAAQI,IAAX,GAAkB,KAAlB,GAA0B,UADpB;AAEXC,wBAAQ,CAAC,CAAC,CAACL,QAAQI,IAAX,GAAkB,QAAlB,GAA6B;AAF1B,aADhB;AAKCE,6BAAiB;AACbC,uBAAO,CAAC,CAAC,CAACP,QAAQI,IAAX,GAAkB,OAAlB,GAA4B,YADtB;AAEbI,uBAAO,CAAC,CAAC,CAACR,QAAQI,IAAX,GAAkB,OAAlB,GAA4B;AAFtB,aALlB;AASCK,yBAAa;AATd,SADH,EAYGT,OAZH,CAAJ;;AAeA,YAAIU,aAAa,EAAjB;;AAEA,YAAMC,eAAepD,iBAAiBoB,IAAjB,CAAsB,GAAtB,CAArB;AACA,YAAMiC,sBAAsBnD,OAAOC,MAAP,CAAcuC,SAASC,aAAvB,CAA5B;AACA,YAAMW,wBAAwBD,oBAAoBE,GAApB,CAAwB;AAAA,mBAAK,MAAMC,CAAN,GAAU,GAAf;AAAA,SAAxB,EAA4CpC,IAA5C,CAAiD,GAAjD,CAA9B;;AAEA,YAAIqC,UAAU,6BAAIpE,QAAQqE,gBAAR,CAAyBN,YAAzB,CAAJ,GAA4CO,MAA5C,CAAmD;AAAA,mBAAM,CAACC,GAAGC,aAAJ,IAAqBD,GAAGC,aAAH,CAAiB/C,OAAjB,CAAyBC,WAAzB,OAA2C,SAAtE;AAAA,SAAnD,CAAd;AACA,YAAI1B,QAAQkC,OAAR,CAAgB6B,YAAhB,MAAkC,CAAC/D,QAAQwE,aAAT,IAA0BxE,QAAQwE,aAAR,CAAsB/C,OAAtB,CAA8BC,WAA9B,OAAgD,SAA5G,CAAJ,EAA4H;AACxH0C,oBAAQrB,IAAR,CAAa/C,OAAb;AACH;;AAEDoE,gBAAQ1B,OAAR,CAAgB,kBAAU;AACtB,gBAAI+B,SAASC,MAAb;;AAEA,gBAAIA,OAAOL,gBAAP,CAAwB,QAAxB,EAAkCM,MAAtC,EAA8C;AAC1CF,yBAASC,OAAOL,gBAAP,CAAwB,QAAxB,CAAT;AACAI,yBAAS,6BAAIA,MAAJ,GAAY,CAAZ,CAAT;AACH;;AAED,gBAAIA,OAAOvC,OAAP,CAAe+B,qBAAf,CAAJ,EAA2C;AACvC,oBAAIW,YAAY,EAAhB;;AAEA,qBAAK,IAAIC,IAAI,CAAR,EAAWC,IAAId,oBAAoBW,MAAxC,EAAgDE,IAAIC,CAApD,EAAuDD,GAAvD,EAA4D;AACxDD,gCAAYH,OAAOM,YAAP,CAAoBf,oBAAoBa,CAApB,CAApB,CAAZ;AACA,wBAAID,SAAJ,EAAe;AACX;AACH;AACJ;;AAEDd,2BAAWf,IAAX,CACI,IAAI5B,KAAJ,CAAU;AACNnB,6BAAS0E,MADH;AAENnD,yBAAKqD;AAFC,iBAAV,CADJ;AAMH;AACJ,SAzBD;;AA2BA,YAAI,SAASvB,SAASQ,WAAtB,EAAmC;AAC/BO,mDAAcpE,QAAQqE,gBAAR,CAAyB,GAAzB,CAAd;AACAD,oBAAQrB,IAAR,CAAa/C,OAAb;AACAoE,sBAAUA,QAAQE,MAAR,CAAe;AAAA,uBAAU,CAACI,OAAOxC,OAAP,CAAe6B,YAAf,CAAX;AAAA,aAAf,CAAV;AACAK,sBAAUA,QAAQE,MAAR,CAAe;AAAA,uBAAUvE,YAAY2E,MAAZ,EAAoB,kBAApB,MAA4C,MAAtD;AAAA,aAAf,CAAV;AACAN,oBAAQ1B,OAAR,CAAgB,kBAAU;AACtB,oBAAMnB,MAAMxB,YAAY2E,MAAZ,EAAoB,kBAApB,EAAwCvC,KAAxC,CAA8C,WAA9C,CAAZ;;AAEA,oBAAI,SAASZ,GAAT,IAAgBA,IAAIoD,MAAJ,IAAc,CAAlC,EAAqC;AACjCb,+BAAWf,IAAX,CACI,IAAI5B,KAAJ,CAAU;AACNnB,iCAAS0E,MADH;AAENnD,6BAAKA,IAAI,CAAJ,EAAOa,OAAP,CAAe,QAAf,EAAyB,EAAzB;AAFC,qBAAV,CADJ;AAMH;AACJ,aAXD;AAYH;;AAED,eAAO0B,UAAP;AACH,KA1ED;;AAkFA,QAAMkB,mBAAmB,SAAnBA,gBAAmB,CAACT,EAAD,EAAKU,KAAL,EAAe;AACpCpE,eAAOqE,IAAP,CAAYD,KAAZ,EAAmBvC,OAAnB,CAA2B,gBAAQ;AAC/B,gBAAIyC,WAAWF,MAAMG,IAAN,CAAf;AACAD,uBAAWA,aAAa,KAAb,IAAsBA,aAAa,QAAnC,GAA8C,UAAUA,QAAxD,GAAmEA,QAA9E;AACA,gBAAME,cAAcd,GAAGQ,YAAH,CAAgBI,QAAhB,CAApB;;AAEA,gBAAIE,WAAJ,EAAiB;AACbd,mBAAGe,YAAH,CAAgBF,IAAhB,EAAsBC,WAAtB;AACAd,mBAAGgB,eAAH,CAAmBJ,QAAnB;AACH;AACJ,SATD;AAUH,KAXD;;AAmBA,QAAMK,iBAAiB,SAAjBA,cAAiB,CAACjB,EAAD,EAAKG,MAAL,EAAae,UAAb;AAAA,eACnBA,WAAW/C,OAAX,CAAmB,gBAAQ;AACvB,gBAAMkC,YAAYF,OAAOK,YAAP,CAAoBK,IAApB,CAAlB;AACA,gBAAIR,SAAJ,EAAe;AACXL,mBAAGe,YAAH,CAAgBF,SAAS,KAAT,IAAkBA,SAAS,QAA3B,GAAsC,UAAUA,IAAhD,GAAuDA,IAAvE,EAA6ER,SAA7E;AACH;AACJ,SALD,CADmB;AAAA,KAAvB;;AAcA,QAAMc,mBAAmB,SAAnBA,gBAAmB,CAACnB,EAAD,EAAKkB,UAAL;AAAA,eAAoBA,WAAW/C,OAAX,CAAmB;AAAA,mBAAQ6B,GAAGgB,eAAH,CAAmBH,IAAnB,CAAR;AAAA,SAAnB,CAApB;AAAA,KAAzB;;AAjPiB,QAuPX1F,MAvPW;AAwPb,0BAA0B;AAAA,gBAAd0D,OAAc,uEAAJ,EAAI;;AAAA;;AACtB,iBAAKuC,QAAL,YACO;AACCrC,+BAAe;AACXC,yBAAK,CAAC,CAAC,CAACH,QAAQI,IAAX,GAAkB,KAAlB,GAA0B,UADpB;AAEXC,4BAAQ,CAAC,CAAC,CAACL,QAAQI,IAAX,GAAkB,QAAlB,GAA6B;AAF1B,iBADhB;AAKCE,iCAAiB;AACbC,2BAAO,CAAC,CAAC,CAACP,QAAQI,IAAX,GAAkB,OAAlB,GAA4B,YADtB;AAEbI,2BAAO,CAAC,CAAC,CAACR,QAAQI,IAAX,GAAkB,OAAlB,GAA4B;AAFtB,iBALlB;AASCA,sBAAM,KATP;AAUCoC,6BAAa,KAVd;AAWC/B,6BAAa,IAXd;AAYCgC,4BAAY;AAZb,aADP,EAeOzC,OAfP;;AAkBA,iBAAK0C,WAAL,GAAmB,EAAnB;AACA,iBAAKC,MAAL,GAAc,IAAIC,GAAJ,EAAd;;AAEA,iBAAKC,KAAL,GAAa,IAAb;;AAEA,iBAAKC,WAAL,GAAmB,CAAnB;AACA,iBAAKC,MAAL,GAAc,CAAd;AACH;;AAlRY;AAAA;AAAA,oCAoVL;AACJ,oBAAI,KAAKA,MAAL,KAAgB,CAApB,EAAuB;AACnB;AACH;;AAED,qBAAKA,MAAL,GAAc,CAAd;;AAEA,qBAAKJ,MAAL,CAAYrD,OAAZ,CAAoB,UAAC0D,IAAD,EAAOpG,OAAP;AAAA,2BAAmBA,QAAQqG,aAAR,CAAsB,IAAIC,WAAJ,CAAgB,SAAhB,CAAtB,CAAnB;AAAA,iBAApB;AACH;AA5VY;AAAA;AAAA,mCAkWN;AAAA;;AACH,qBAAKL,KAAL,GAAa,IAAI5D,aAAJ,CAAkB,UAACE,OAAD,EAAUC,MAAV,EAAkB+D,QAAlB,EAA+B;AAC1D,wBAAI,OAAKJ,MAAL,KAAgB,CAApB,EAAuB;AACnB3D,+BAAO,2CAAP;AACH;AACD,wBAAI,CAAC,OAAKsD,WAAL,CAAiBnB,MAAtB,EAA8B;AAC1BnC,+BAAO,sBAAP;AACH;;AAED,2BAAK2D,MAAL,GAAc,CAAd;;AAEA,wBAAI,OAAKR,QAAL,CAAcE,UAAlB,EAA8B;AAC1B,4BAAIW,SAAS,CAAb;AACA,4BAAMC,WAAW,SAAXA,QAAW,GAAM;AACnB,gCAAI,OAAKN,MAAL,KAAgB,CAApB,EAAuB;AACnB3D,uCAAO,SAAP;;AAEA;AACH;;AAED,gCAAMkE,WAAW,SAAXA,QAAW,CAAC9C,KAAD,EAAQ+C,EAAR,EAAe;AAC5BH;;AAEA,uCAAKN,WAAL,GAAoBM,SAAS,OAAKV,WAAL,CAAiBnB,MAA3B,GAAqC,GAAxD;;AAEA4B,yCAAS3C,KAAT;;AAEA,oCAAI4C,SAAS,OAAKV,WAAL,CAAiBnB,MAA9B,EAAsC;AAClC8B;;AAEA;AACH;;AAED,uCAAKN,MAAL,GAAc,CAAd;;AAEAQ;AACH,6BAhBD;;AAkBA,gCAAMC,OAAO,OAAKC,KAAL,CAAW,OAAKf,WAAL,CAAiBU,MAAjB,CAAX,CAAb;AACAI,iCAAKE,IAAL,CAAU;AAAA,uCAAKJ,SAASK,CAAT,EAAY;AAAA,2CAAMxE,QAAQ,EAAR,CAAN;AAAA,iCAAZ,CAAL;AAAA,6BAAV;AACAqE,iCAAKI,KAAL,CAAW;AAAA,uCAAKN,SAASK,CAAT,EAAY;AAAA,2CAAMvE,OAAO,OAAP,CAAN;AAAA,iCAAZ,CAAL;AAAA,6BAAX;AACH,yBA5BD;;AA8BAiE;AACH,qBAjCD,MAiCO;AAAA;AACH,gCAAID,SAAS,CAAb;AACA,gCAAME,WAAW,SAAXA,QAAW,CAACK,CAAD,EAAIJ,EAAJ,EAAW;AACxBH;;AAEA,uCAAKN,WAAL,GAAoBM,SAAS,OAAKV,WAAL,CAAiBnB,MAA3B,GAAqC,GAAxD;;AAEA4B,yCAASQ,CAAT;;AAEA,oCAAIP,UAAU,OAAKV,WAAL,CAAiBnB,MAA/B,EAAuC;AACnC,2CAAKwB,MAAL,GAAc,CAAd;;AAEAQ;AACH;AACJ,6BAZD;;AAcA,iCAAK,IAAI9B,IAAI,CAAb,EAAgBA,IAAI,OAAKiB,WAAL,CAAiBnB,MAArC,EAA6CE,GAA7C,EAAkD;AAC9C,oCAAI,OAAKsB,MAAL,KAAgB,CAApB,EAAuB;AACnB3D,2CAAO,SAAP;;AAEA;AACH;;AAED,oCAAMoE,OAAO,OAAKC,KAAL,CAAW,OAAKf,WAAL,CAAiBjB,CAAjB,CAAX,CAAb;AACA+B,qCAAKE,IAAL,CAAU;AAAA,2CAAKJ,SAASK,CAAT,EAAY;AAAA,+CAAMxE,QAAQ,EAAR,CAAN;AAAA,qCAAZ,CAAL;AAAA,iCAAV;AACAqE,qCAAKI,KAAL,CAAW;AAAA,2CAAKN,SAASK,CAAT,EAAY;AAAA,+CAAMvE,OAAOuE,CAAP,CAAN;AAAA,qCAAZ,CAAL;AAAA,iCAAX;AACH;AA1BE;AA2BN;AACJ,iBAvEY,CAAb;;AAyEA,uBAAO,KAAKd,KAAZ;AACH;AA7aY;AAAA;AAAA,kCAobPrC,KApbO,EAobA;AAAA;;AACT,uBAAO,IAAIZ,OAAJ,CAAY,UAACT,OAAD,EAAUC,MAAV,EAAqB;AACpC,wBAAMyE,eAAerD,MAAMpC,UAAN,IAAoB0B,SAASC,IAAT,CAAc+D,QAAd,CAAuBtD,MAAM5D,OAA7B,CAAzC;AACA,wBAAMmH,aAAaF,gBAAgBrD,MAAM5D,OAAN,CAAcqE,gBAAd,CAA+B,QAA/B,EAAyCM,MAA5E;AACA,wBAAMyC,iBAAiBlE,SAASmE,aAAT,CAAuBzD,MAAMnC,OAA7B,CAAvB;;AAEA,wBAAI6F,mBAAmBF,cAAvB;;AAEA,wBAAIxD,MAAMjC,IAAN,KAAe,QAAnB,EAA6B;AACzByF,uCAAeG,KAAf,CAAqBC,UAArB,GAAkC,QAAlC;AACAJ,uCAAeG,KAAf,CAAqBE,QAArB,GAAgC,OAAhC;AACAL,uCAAeG,KAAf,CAAqBG,GAArB,GAA2B,QAA3B;AACAN,uCAAeG,KAAf,CAAqBI,IAArB,GAA4B,QAA5B;AACAP,uCAAeG,KAAf,CAAqBK,KAArB,GAA6B,KAA7B;AACAR,uCAAeG,KAAf,CAAqBM,MAArB,GAA8B,KAA9B;AACA3E,iCAASC,IAAT,CAAc2E,WAAd,CAA0BV,cAA1B;AACH;;AAED,wBAAIH,YAAJ,EAAkB;AACdzB,uCAAe4B,cAAf,EAA+BxD,MAAM5D,OAArC,EAA8Ca,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcrC,aAA5B,CAA9C;AACAkC,uCAAe4B,cAAf,EAA+BxD,MAAM5D,OAArC,EAA8Ca,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcjC,eAA5B,CAA9C;;AAEA,4BAAIyD,UAAJ,EAAgB;AACZ,yDAAIvD,MAAM5D,OAAN,CAAcqE,gBAAd,CAA+B,QAA/B,CAAJ,GAA8C3B,OAA9C,CAAsD,kBAAU;AAC5D,oCAAMqF,gBAAgB7E,SAASmE,aAAT,CAAuB,QAAvB,CAAtB;AACA7B,+CAAeuC,aAAf,EAA8BtD,MAA9B,EAAsC5D,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcrC,aAA5B,CAAtC;AACAkC,+CAAeuC,aAAf,EAA8BtD,MAA9B,EAAsC5D,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcjC,eAA5B,CAAtC;AACA0D,+CAAeY,MAAf,CAAsBD,aAAtB;AACH,6BALD;AAMH;;AAED,4BAAInE,MAAMnC,OAAN,KAAkB,SAAtB,EAAiC;AAE7B6F,+CAAmBpE,SAASmE,aAAT,CAAuB,KAAvB,CAAnB;AACAD,2CAAeY,MAAf,CAAsBV,gBAAtB;AACH;AACJ;;AAED,wBAAMW,gBAAgB,SAAhBA,aAAgB,KAAM;AACxB,4BAAIhB,YAAJ,EAAkB;AACdjC,6CAAiBpB,MAAM5D,OAAvB,EAAgC,OAAK2F,QAAL,CAAcrC,aAA9C;AACA0B,6CAAiBpB,MAAM5D,OAAvB,EAAgC,OAAK2F,QAAL,CAAcjC,eAA9C;;AAEA,gCAAIyD,UAAJ,EAAgB;AACZ,6DAAIvD,MAAM5D,OAAN,CAAcqE,gBAAd,CAA+B,QAA/B,CAAJ,GAA8C3B,OAA9C,CAAsD,kBAAU;AAC5DsC,qDAAiBP,MAAjB,EAAyB,OAAKkB,QAAL,CAAcrC,aAAvC;AACA0B,qDAAiBP,MAAjB,EAAyB,OAAKkB,QAAL,CAAcjC,eAAvC;AACH,iCAHD;AAIH;;AAED,gCAAIE,MAAMjC,IAAN,KAAe,OAAf,IAA0BiC,MAAMjC,IAAN,KAAe,OAA7C,EAAsD;AAClDiC,sCAAM5D,OAAN,CAAc4G,IAAd;AACH;;AAED,gCAAIhD,MAAMjC,IAAN,KAAe,QAAnB,EAA6B;AACzByF,+CAAe5C,aAAf,CAA6B0D,WAA7B,CAAyCd,cAAzC;AACH;AACJ;;AAED,+BAAKrB,MAAL,CAAYoC,MAAZ,CAAmBf,cAAnB;;AAEAT,2BAAG/C,KAAH;AACH,qBAxBD;;AA0BA,wBAAMwE,cAAc,SAAdA,WAAc,GAAM;AACtB,4BAAInB,YAAJ,EAAkB;AACdjC,6CAAiBoC,cAAjB,EAAiC,OAAKzB,QAAL,CAAcrC,aAA/C;AACA0B,6CAAiBoC,cAAjB,EAAiC,OAAKzB,QAAL,CAAcjC,eAA/C;;AAEA,gCAAIyD,UAAJ,EAAgB;AACZ,6DAAIC,eAAe/C,gBAAf,CAAgC,QAAhC,CAAJ,GAA+C3B,OAA/C,CAAuD,kBAAU;AAC7DsC,qDAAiBP,MAAjB,EAAyB,OAAKkB,QAAL,CAAcrC,aAAvC;AACA0B,qDAAiBP,MAAjB,EAAyB,OAAKkB,QAAL,CAAcjC,eAAvC;AACH,iCAHD;AAIH;AACJ,yBAVD,MAUO;AACH0D,2CAAe9B,YAAf,CAA4B,KAA5B,EAAmC1B,MAAMrC,GAAzC;AACH;;AAED,4BAAIqC,MAAMjC,IAAN,KAAe,OAAf,IAA0BiC,MAAMjC,IAAN,KAAe,OAA7C,EAAsD;AAClDyF,2CAAeR,IAAf;AACH;AACJ,qBAlBD;;AAoBA,wBAAMP,gBAAgB,SAAhBA,aAAgB,OAAQ;AAC1B,4BAAMgC,QAAQ,IAAI/B,WAAJ,CAAgB3E,IAAhB,EAAsB,EAAE2G,QAAQ1E,KAAV,EAAtB,CAAd;;AAEA,4BAAIA,MAAM5D,OAAV,EAAmB;AACf4D,kCAAM5D,OAAN,CAAcqG,aAAd,CAA4BgC,KAA5B;AACH;;AAEDnF,iCAASmD,aAAT,CAAuBgC,KAAvB;AACH,qBARD;;AAUA,wBAAIE,SAAS,EAAE3E,OAAOA,KAAT,EAAgB4E,UAAU,IAA1B,EAAgCxI,SAASoH,cAAzC,EAAb;;AAGAA,mCAAeqB,gBAAf,CAAgC,OAAhC,EAAyC,YAAM;AAC3C/C,yCAAiB0B,cAAjB,EAAiCvG,OAAOqE,IAAP,CAAY,OAAKS,QAAL,CAAcrC,aAA1B,CAAjC;AACAoC,yCAAiB0B,cAAjB,EAAiCvG,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcrC,aAA5B,CAAjC;AACAoC,yCAAiB0B,cAAjB,EAAiCvG,OAAOqE,IAAP,CAAY,OAAKS,QAAL,CAAcjC,eAA1B,CAAjC;AACAgC,yCAAiB0B,cAAjB,EAAiCvG,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcjC,eAA5B,CAAjC;;AAEA,4BAAIyD,UAAJ,EAAgB;AACZ,yDAAIC,eAAe/C,gBAAf,CAAgC,QAAhC,CAAJ,GAA+C3B,OAA/C,CAAuD,kBAAU;AAC7DgD,iDAAiBjB,MAAjB,EAAyB5D,OAAOqE,IAAP,CAAY,OAAKS,QAAL,CAAcrC,aAA1B,CAAzB;AACAoC,iDAAiBjB,MAAjB,EAAyB5D,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcrC,aAA5B,CAAzB;AACAoC,iDAAiBjB,MAAjB,EAAyB5D,OAAOqE,IAAP,CAAY,OAAKS,QAAL,CAAcjC,eAA1B,CAAzB;AACAgC,iDAAiBjB,MAAjB,EAAyB5D,OAAOC,MAAP,CAAc,OAAK6E,QAAL,CAAcjC,eAA5B,CAAzB;AACH,6BALD;AAMH;;AAEDuE,sCAAczF,MAAd;AACH,qBAhBD;;AAkBA8E,qCAAiBmB,gBAAjB,CAAkC,OAAlC,EAA2C,YAAM;AAC7CR,sCAAczF,MAAd;;AAEA6D,sCAAc,YAAd;AACH,qBAJD;;AAMA,wBAAIzC,MAAMjC,IAAN,KAAe,OAAf,IAA0BiC,MAAMjC,IAAN,KAAe,QAA7C,EAAuD;AACnD2F,yCAAiBmB,gBAAjB,CAAkC,MAAlC,EAA0C,aAAK;AAC3C,gCAAI1B,EAAErC,MAAF,CAASjD,OAAT,CAAiBC,WAAjB,OAAmC,QAAnC,IAA+C,CAACqF,EAAErC,MAAF,CAASK,YAAT,CAAsB,KAAtB,CAApD,EAAkF;AAC9E;AACH;;AAEDkD,0CAAc1F,OAAd;;AAEA8D,0CAAc,WAAd;AACH,yBARD;AASH;;AAED,wBAAIzC,MAAMjC,IAAN,KAAe,OAAf,IAA0BiC,MAAMjC,IAAN,KAAe,OAA7C,EAAsD;AAClD2F,yCAAiBmB,gBAAjB,CAAkC,OAAK9C,QAAL,CAAcC,WAAd,GAA4B,gBAA5B,GAA+C,gBAAjF,EAAmG,YAAM;AACrGqC,0CAAc1F,OAAd;;AAEA8D,0CAAc,WAAd;AACH,yBAJD;AAKH;;AAED,wBAAIzC,MAAM5D,OAAN,YAAyBsB,WAAzB,IAAwC,OAAKqE,QAAL,CAAcnC,IAAtD,IAA8D,0BAA0BtD,MAA5F,EAAoG;AAChGqI,+BAAOC,QAAP,GAAkB,IAAIE,oBAAJ,CACd,UAACC,OAAD,EAAUH,QAAV,EAAuB;AACnBG,oCAAQjG,OAAR,CAAgB,iBAAS;AACrB,oCAAIkG,MAAMC,iBAAN,GAA0B,CAA9B,EAAiC;AAC7BL,6CAASM,SAAT,CAAmBF,MAAMlE,MAAzB;;AAEA0D;AACH;AACJ,6BAND;AAOH,yBATa,EAUd;AACIW,kCAAM,IADV;AAEIC,wCAAY,KAFhB;AAGIC,uCAAW;AAHf,yBAVc,CAAlB;;AAiBAV,+BAAOC,QAAP,CAAgBU,OAAhB,CAAwBtF,MAAM5D,OAA9B;AACA,+BAAK+F,MAAL,CAAYoD,GAAZ,CAAgBvF,MAAM5D,OAAtB,EAA+BuI,MAA/B;AACH,qBApBD,MAoBO;AACH,+BAAKxC,MAAL,CAAYoD,GAAZ,CAAgB/B,cAAhB,EAAgCmB,MAAhC;;AAEAH;AACH;AACJ,iBArKM,CAAP;AAsKH;AA3lBY;AAAA;AAAA,gCAuRI;AACb,uBAAO,KAAKlC,WAAZ;AACH;AAzRY;AAAA;AAAA,8BA8REpC,UA9RF,EA8Rc;AAAA;;AACvB,oBAAI,KAAKqC,MAAL,KAAgB,CAApB,EAAuB;AACnB,wBAAIrC,sBAAsBxC,WAA1B,EAAuC;AACnCwC,qCAAab,KAAKa,UAAL,EAAiB,KAAK6B,QAAtB,CAAb;AACH;;AAED,wBAAI,OAAOvE,IAAP,KAAgB,QAApB,EAA8B;AAC1B0C,qCAAa,CAAC,IAAI3C,KAAJ,CAAU,EAAEI,KAAKH,IAAP,EAAV,CAAD,CAAb;AACH;;AAED,wBAAID,MAAMiI,OAAN,CAActF,UAAd,CAAJ,EAA+B;AAC3BA,qCAAa,CAACA,UAAD,CAAb;AACH;;AAED,wBAAIuF,MAAMC,OAAN,CAAcxF,UAAd,CAAJ,EAA+B;AAC3BA,mCAAWpB,OAAX,CAAmB,gBAAQ;AACvB,gCAAM6G,YAAY,SAAZA,SAAY,QAAS;AACvB,oCAAI3F,MAAMjC,IAAN,KAAe,OAAf,IAA0BiC,MAAMjC,IAAN,KAAe,OAAzC,IAAoDiC,MAAMjC,IAAN,KAAe,OAAnE,IAA+EiC,MAAMjC,IAAN,KAAe,QAAf,IAA2BiC,MAAMpC,UAApH,EAAiI;AAC7H,2CAAKsE,WAAL,CAAiB/C,IAAjB,CAAsBa,KAAtB;;AAEA;AACH;;AAED4F,wCAAQC,IAAR,CAAa,kCAAb,EAAiD7F,KAAjD;AACH,6BARD;;AAUA,gCAAIxC,gBAAgBE,WAApB,EAAiC;AAC7B2B,qCAAK7B,IAAL,EAAW,OAAKuE,QAAhB,EAA0BjD,OAA1B,CAAkC;AAAA,2CAAS6G,UAAU,IAAIpI,KAAJ,CAAUyC,KAAV,CAAV,CAAT;AAAA,iCAAlC;AACH;;AAED,gCAAI,OAAOxC,IAAP,KAAgB,QAApB,EAA8B;AAC1BmI,0CAAU,IAAIpI,KAAJ,CAAU,EAAEI,KAAKH,IAAP,EAAV,CAAV;AACH;;AAED,gCAAID,MAAMiI,OAAN,CAAchI,IAAd,CAAJ,EAAyB;AACrBmI,0CAAUnI,IAAV;AACH;AACJ,yBAtBD;AAuBH;AACJ;AACJ,aAtUY;AAAA,gCA4UI;AACb,uBAAO,KAAK0E,WAAZ;AACH;AA9UY;;AAAA;AAAA;;AA8lBjB,WAAOpG,MAAP;AAEH,CApmBA,CAAD","file":"loader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => {\n        return heystack.indexOf(needle) > -1;\n    };\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Media {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isMedia(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Media({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Media({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     *\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Media)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof item === 'string') {\n                    collection = [new Media({ url: item })];\n                }\n\n                if (Media.isMedia(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    collection.forEach(item => {\n                        const pushCheck = media => {\n                            if (media.type === 'image' || media.type === 'video' || media.type === 'audio' || (media.type === 'iframe' && media.consistent)) {\n                                this._collection.push(media);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add media to collection\", media);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(media => pushCheck(new Media(media)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Media({ url: item }));\n                        }\n\n                        if (Media.isMedia(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('Aborted')));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('A Loader instance is already in progress.');\n                }\n                if (!this._collection.length) {\n                    reject('Collection is empty.');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            return;\n                        }\n\n                        const loadStep = (media, cb) => {\n                            loaded++;\n\n                            this._percentage = (loaded / this._collection.length) * 100;\n\n                            progress(media);\n\n                            if (loaded < this._collection.length) {\n                                pipeline();\n\n                                return;\n                            }\n\n                            this._state = 0;\n\n                            cb();\n                        };\n\n                        const load = this.fetch(this._collection[loaded]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject('Error')));\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n                    const loadStep = (e, cb) => {\n                        loaded++;\n\n                        this._percentage = (loaded / this._collection.length) * 100;\n\n                        progress(e);\n\n                        if (loaded >= this._collection.length) {\n                            this._state = 0;\n\n                            cb();\n                        }\n                    };\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Aborted');\n\n                            break;\n                        }\n\n                        const load = this.fetch(this._collection[i]);\n                        load.then(e => loadStep(e, () => resolve({}))); // TODO: returned something\n                        load.catch(e => loadStep(e, () => reject(e)));\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Media} resource\n         * @returns {Promise}\n         */\n        fetch(media) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = media.consistent && document.body.contains(media.element);\n                const hasSources = isConsistent && media.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(media.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (media.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, media.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, media.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...media.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (media.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = cb => {\n                    if (isConsistent) {\n                        switchAttributes(media.element, this._options.srcAttributes);\n                        switchAttributes(media.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...media.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (media.type === 'video' || media.type === 'audio') {\n                            media.element.load();\n                        }\n\n                        if (media.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    cb(media);\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', media.url);\n                    }\n\n                    if (media.type === 'video' || media.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = type => {\n                    const event = new CustomEvent(type, { detail: media });\n\n                    if (media.element) {\n                        media.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n                };\n\n                let queuer = { media: media, observer: null, element: createdElement };\n\n                // TODO: \"abort\" custom event must be \"private\" . instance?\n                createdElement.addEventListener('abort', () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    finishPromise(reject);\n                });\n\n                mainEventsTarget.addEventListener('error', () => {\n                    finishPromise(reject);\n\n                    dispatchEvent('mediaError');\n                });\n\n                if (media.type === 'image' || media.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire load at landing\n                        }\n\n                        finishPromise(resolve);\n\n                        dispatchEvent('mediaLoad');\n                    });\n                }\n\n                if (media.type === 'audio' || media.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', () => {\n                        finishPromise(resolve);\n\n                        dispatchEvent('mediaLoad');\n                    });\n                }\n\n                if (media.element instanceof HTMLElement && this._options.lazy && 'IntersectionObserver' in window) {\n                    queuer.observer = new IntersectionObserver(\n                        (entries, observer) => {\n                            entries.forEach(entry => {\n                                if (entry.intersectionRatio > 0) {\n                                    observer.unobserve(entry.target);\n\n                                    prepareLoad();\n                                }\n                            });\n                        },\n                        {\n                            root: null,\n                            rootMargin: '0px',\n                            threshold: 0.1\n                        }\n                    );\n\n                    queuer.observer.observe(media.element);\n                    this._queue.set(media.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"]}