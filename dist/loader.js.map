{"version":3,"sources":["loader.mjs"],"names":["global","factory","exports","module","define","amd","self","Loader","defaults","url","proxy","attr","success","error","ILoad","options","Promise","resolve","reject","message","Error","loadStyle","document","createElement","rel","promise","head","appendChild","disabled","then","removeChild","loadScript","width","height","body","loadImage","defaults$1","IMediaLoad","loadAudio","loadVideo","SupportedFileExtensions","IMAGE","AUDIO","VIDEO","SCRIPT","STYLE","BASE_64_HEAD","parseStringResource","string","RegExp","test","split","pop","reduce","x","y","length","format","extensions","join","toLowerCase","matches","match","type","parseElementResource","element","currentSrc","parseResource","resource","HTMLElement","loaders","image","audio","video","style","script","load","e","LoaderPromise","fn","value","_progress","forEach","listener","handler","push","resources","_resources","progress","loaded","errors","key"],"mappings":"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","file":"loader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global = global || self, global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     *\n     * @param url\n     * @param tag\n     * @param success\n     * @param error\n     * @param parentTarget\n     */\n    const defaults = {\n        url: \"\",\n        proxy: null,\n        attr: \"src\",\n        success: \"onload\",\n        error: \"onerror\"\n    };\n\n    const ILoad = (options = defaults) =>\n        new Promise((resolve, reject) => {\n            options = { ...defaults, ...options };\n\n            options.proxy[options.success] = () => resolve(options.url);\n            options.proxy[options.error] = message => reject(new Error(message));\n\n            options.proxy[options.attr] = options.url;\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadStyle = url => {\n        const proxy = document.createElement(\"link\");\n\n        proxy.rel = \"stylesheet\";\n\n        const promise = ILoad({\n            url: url,\n            proxy: proxy,\n            attr: \"href\"\n        });\n\n        document.head.appendChild(proxy);\n\n        proxy.disabled = \"disabled\";\n\n        promise.then(() => document.head.removeChild(proxy));\n\n        return promise;\n    };\n\n    /**\n     *\n     * @param url\n     */\n    const loadScript = url => {\n        const proxy = document.createElement(\"object\");\n\n        proxy.width = 0;\n        proxy.height = 0;\n\n        const promise = ILoad({\n            url: url,\n            proxy: proxy,\n            attr: \"data\"\n        });\n\n        document.body.appendChild(proxy);\n\n        promise.then(() => document.body.removeChild(proxy));\n\n        return promise;\n    };\n\n    /**\n     *\n     * @param url\n     */\n    const loadImage = url =>\n        ILoad({\n            url: url,\n            proxy: document.createElement(\"img\")\n        });\n\n    const defaults$1 = {\n        url: \"\",\n        proxy: null\n    };\n\n    /**\n     *\n     * @param url\n     * @param tag\n     */\n    const IMediaLoad = (options = defaults$1) =>\n        ILoad({\n            ...{ ...defaults$1, ...options },\n            ...{ success: \"onloadedmetadata\" }\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadAudio = url =>\n        IMediaLoad({\n            url: url,\n            proxy: document.createElement(\"audio\")\n        });\n\n    /**\n     *\n     * @param url\n     */\n    const loadVideo = url =>\n        IMediaLoad({\n            url: url,\n            proxy: document.createElement(\"video\")\n        });\n\n    const SupportedFileExtensions = {\n        IMAGE: [\n            \"jp[e]?g\",\n            \"jpe\",\n            \"jif\",\n            \"jfif\",\n            \"jfi\",\n            \"gif\",\n            \"png\",\n            \"tif[f]?\",\n            \"bmp\",\n            \"dib\",\n            \"webp\",\n            \"ico\",\n            \"cur\",\n            \"svg\"\n        ],\n        AUDIO: [\"mp3\", \"ogg\", \"oga\", \"spx\", \"ogg\", \"wav\"],\n        VIDEO: [\"mp4\", \"ogg\", \"ogv\", \"webm\"],\n        SCRIPT: [\"js\", \"mjs\"],\n        STYLE: [\"css\"]\n    };\n\n    const BASE_64_HEAD = \";base64,\";\n\n    /**\n     *\n     * @param string\n     */\n    const parseStringResource = string => {\n        if (!new RegExp(`${BASE_64_HEAD}`).test(string)) {\n            string = string\n                .split(\",\")\n                .pop() // gets the last\n                .split(\" \")\n                .reduce((x, y) => (x.length > y.length ? x : y)); // gets the longest fragment in order to skip \"x2\", \"\" etc...\n        }\n\n        for (let format in SupportedFileExtensions) {\n            const extensions = SupportedFileExtensions[format].join(\"|\");\n\n            format = format.toLowerCase();\n\n            if (\n                new RegExp(\n                    `(.(${extensions})$)|data:${format}/(${extensions})${BASE_64_HEAD}`\n                ).test(string)\n            ) {\n                const matches =\n                    string.match(new RegExp(`.(${extensions})$`, \"g\")) ||\n                    string.match(\n                        new RegExp(`^data:${format}/(${extensions})`, \"g\")\n                    );\n\n                if (null !== matches) {\n                    return {\n                        type: format,\n                        url: string /*,\n                        extension: matches[0]\n                            .replace(`data:${format}/`, \"\")\n                            .replace(\".\", \"\")*/\n                    };\n                }\n            }\n        }\n\n        throw new Error(\"Error while parsing the resource string.\");\n    };\n\n    /**\n     *\n     * @param element\n     */\n    const parseElementResource = element => {\n        if (\"currentSrc\" in element) {\n            return element.currentSrc;\n        }\n\n        throw new Error(\"Error while parsing the resource element.\");\n    };\n\n    /**\n     *\n     * @param resource\n     */\n    const parseResource = resource => {\n        if (resource instanceof HTMLElement) {\n            resource = parseElementResource(resource);\n        }\n\n        if (typeof resource === \"string\") {\n            resource = parseStringResource(resource);\n        }\n\n        return resource;\n    };\n\n    const loaders = {\n        image: loadImage,\n        audio: loadAudio,\n        video: loadVideo,\n        style: loadStyle,\n        script: loadScript\n    };\n\n    /**\n     *\n     * @param resource\n     */\n    const load = resource =>\n        new Promise((resolve, reject) => {\n            try {\n                resource = parseResource(resource);\n            } catch (e) {\n                reject(e);\n            }\n\n            loaders[resource.type](resource.url)\n                .then(resolve)\n                .catch(reject);\n        });\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     */\n    class Loader {\n        constructor(resources = []) {\n            this._resources = resources;\n        }\n\n        /**\n         *\n         */\n        load() {\n            return new LoaderPromise((resolve, reject, progress) => {\n                let loaded = 0;\n                const length = this._resources.length;\n\n                let errors = false;\n\n                for (var key in this._resources) {\n                    load(this._resources[key])\n                        .catch(() => {\n                            errors = true;\n                        })\n                        .finally(() => {\n                            progress();\n\n                            loaded++;\n\n                            if (loaded < length) {\n                                return;\n                            }\n\n                            if (errors) {\n                                reject(\n                                    new Error(\n                                        \"One or more resources had troubles loading.\"\n                                    )\n                                );\n                            }\n\n                            resolve();\n                        });\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"]}