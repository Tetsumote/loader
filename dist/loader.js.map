{"version":3,"sources":["loader.mjs"],"names":["global","factory","exports","module","define","amd","Loader","roundDecimals","num","decimals","parseFloat","toFixed","s4","Math","floor","random","toString","substring","uniqueID","isInArray","needle","heystack","indexOf","getComputed","element","property","window","getComputedStyle","getPropertyValue","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","Object","values","reduce","a","b","concat","Resource","item","isElement","HTMLElement","url","consistent","tagName","toLowerCase","type","extension","format","extensions","join","RegExp","test","matches","match","replace","LoaderPromise","fn","resolve","reject","value","_progress","forEach","listener","error","handler","push","Promise","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","x","targets","querySelectorAll","filter","el","parentElement","target","source","length","attribute","i","j","getAttribute","switchAttributes","attrs","keys","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","roundPercentage","percentage","isIntersectionObserverSupported","Viewport","_window","_html","documentElement","_body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","bool","style","top","left","scrollBarWidth","scrollBarHeight","position","abs","scroll","behavior","isElementInViewport","getBoundsViewportIntersection","getBoundingClientRect","ratio","bounds","viewport","right","bottom","y","offTop","offBottom","offLeft","offRight","offY","offX","percentageX","percentageY","min","ID","_options","playthrough","sequential","_collection","_queue","Map","_load","_percentage","_state","manuallyObservedElements","manuallyObserve","intersected","dispatchEvent","CustomEvent","addEventListener","data","progress","loaded","pipeline","fetch","catch","payload","console","warn","event","detail","message","resource","then","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","visibility","appendChild","createdSource","append","finishPromise","resolver","load","removeChild","delete","prepareLoad","eventName","queuer","observer","dispatchedEvent","e","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","threshold","observe","set","NodeList","isResource","Array","isArray","pushCheck"],"mappings":"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","file":"loader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {(string|number)} num\n     * @returns {number}\n     */\n    const roundDecimals = (num, decimals = 4) => parseFloat(num.toFixed(decimals));\n\n    const s4 = () => Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    /**\n     * @returns {string}\n     */\n    const uniqueID = () => s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => heystack.indexOf(needle) > -1;\n\n    // TODO: cache?\n    /**\n     *\n     * @param {HTMLElement} element\n     * @param {string} property\n     * @returns {string}\n     */\n    const getComputed = (element, property) => window.getComputedStyle(element).getPropertyValue(property);\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && isInArray(item.element.tagName.toLowerCase(), allSupportedTags);\n            this.element = isElement ? item.element : null;\n            this.tagName = this.consistent ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp('(.(' + extensions + ')$)|data:' + format + '/(' + extensions + ');base64,').test(this.url)) {\n                    const matches = this.url.match(new RegExp('.(' + extensions + ')$', 'g')) || this.url.match(new RegExp('^data:' + format + '/(' + extensions + ')', 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace('data:' + format + '/', '').replace('.', '');\n                        this.tagName = this.tagName ? this.tagName : supportedTags[format][0];\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (this.tagName === 'audio' || this.tagName === 'video' || this.tagName === 'iframe')) {\n                this.type = this.tagName;\n            } else if (this.tagName) {\n                for (let format in supportedTags) {\n                    if (isInArray(this.tagName, supportedTags[format])) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'tagName' in item && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => '[' + x + ']').join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => getComputed(target, 'background-image') !== 'none');\n            targets.forEach(target => {\n                const url = getComputed(target, 'background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? 'data-' + dataAttr : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? 'data-' + attr : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     *\n     * @param {Number} percentage\n     * @returns {Number}\n     */\n    const roundPercentage = percentage => {\n        if (percentage > 100) {\n            percentage = 100;\n        } else if (percentage < 0) {\n            percentage = 0;\n        } else {\n            percentage = roundDecimals(percentage, 4);\n        }\n\n        return percentage;\n    };\n\n    const isIntersectionObserverSupported = 'IntersectionObserver' in window;\n\n    /**\n     *\n     */\n    class Viewport {\n        constructor() {\n            this._window = window;\n            this._html = document.documentElement;\n            this._body = document.body;\n\n            this._frame1 = this._window;\n            this._frame2 = this._html || this._body;\n            this._prefix1 = 'inner';\n            this._prefix2 = 'offset';\n            if (!this._prefix1 + 'Width' in this._frame1) {\n                this._prefix1 = 'client';\n                this._frame1 = this._frame2;\n            }\n\n            this._offsetWidth = 0;\n            this._offsetHeight = 0;\n            this._width = 0;\n            this._height = 0;\n            this._scrollTop = 0;\n            this._scrollLeft = 0;\n\n            this._lock = false;\n\n            this.calcAll();\n        }\n\n        get offsetWidth() {\n            return this._offsetWidth;\n        }\n        get offsetHeight() {\n            return this._offsetHeight;\n        }\n        get width() {\n            return this._width;\n        }\n        get height() {\n            return this._height;\n        }\n        get scrollTop() {\n            return this._scrollTop;\n        }\n        get scrollLeft() {\n            return this._scrollLeft;\n        }\n        get all() {\n            return {\n                offsetWidth: this.offsetWidth,\n                offsetHeight: this.offsetHeight,\n                width: this.width,\n                height: this.height,\n                scrollTop: this.scrollTop,\n                scrollLeft: this.scrollLeft\n            };\n        }\n\n        calcOffsetWidth() {\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\n            return this.offsetWidth;\n        }\n        calcOffsetHeight() {\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\n            return this.offsetHeight;\n        }\n        calcWidth() {\n            this._width = this._frame1[this._prefix1 + 'Width'];\n            return this.width;\n        }\n        calcHeight() {\n            this._height = this._frame1[this._prefix1 + 'Height'];\n            return this.height;\n        }\n        calcScrollTop() {\n            this._scrollTop = this._frame2.scrollTop || 0;\n            return this.scrollTop;\n        }\n        calcScrollLeft() {\n            this._scrollLeft = this._frame2.scrollLeft || 0;\n            return this.scrollLeft;\n        }\n        calcAll() {\n            this.calcOffsetWidth();\n            this.calcOffsetHeight();\n            this.calcWidth();\n            this.calcHeight();\n            this.calcScrollTop();\n            this.calcScrollLeft();\n            return this.all;\n        }\n\n        get lock() {\n            return this._lock;\n        }\n\n        set lock(bool) {\n            this._lock = bool;\n\n            if (this._lock) {\n                this._body.style.top = -this.calcScrollTop() + 'px';\n                this._body.style.left = -this.calcScrollLeft() + 'px';\n\n                let scrollBarWidth = this.calcOffsetWidth();\n                let scrollBarHeight = this.calcOffsetHeight();\n\n                this._html.style.top = '0px';\n                this._html.style.left = '0px';\n                this._html.style.position = 'fixed';\n                this._body.style.position = 'fixed';\n                this._html.style.width = '100%';\n                this._body.style.width = '100%';\n\n                let offsetWidth = this.calcOffsetWidth();\n                let offsetHeight = this.calcOffsetHeight();\n                scrollBarWidth = offsetWidth - scrollBarWidth;\n                scrollBarHeight = offsetHeight - scrollBarHeight;\n\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\n            } else {\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\n\n                this._html.style.position = '';\n                this._html.style.top = '';\n                this._html.style.left = '';\n                this._html.style.width = '';\n                this._body.style.position = '';\n                this._body.style.top = '';\n                this._body.style.left = '';\n                this._body.style.width = '';\n\n                this._window.scroll({\n                    top: scrollTop,\n                    left: scrollLeft,\n                    behavior: 'instant'\n                });\n            }\n        }\n    }\n\n    /**\n     * @param {HTMLElement} element\n     * @returns {Boolean}\n     */\n    const isElementInViewport = element => !!getBoundsViewportIntersection(element.getBoundingClientRect()).ratio;\n\n    /**\n     * @param {DOMRect} bounds\n     * @returns {Object}\n     */\n    const getBoundsViewportIntersection = bounds => {\n        const viewport = new Viewport();\n\n        if (bounds.right < 0 || bounds.bottom < 0 || bounds.left > viewport.width || bounds.top > viewport.height) {\n            return {\n                x: 0,\n                y: 0,\n                ratio: 0\n            };\n        }\n\n        const offTop = bounds.top < 0;\n        const offBottom = bounds.top + bounds.height > viewport.height;\n        const offLeft = bounds.left < 0;\n        const offRight = bounds.left + bounds.width > viewport.width;\n\n        if (!offTop && !offBottom && !offLeft && !offRight) {\n            return {\n                x: 100,\n                y: 100,\n                ratio: 100\n            };\n        }\n\n        let offY = 0;\n        let offX = 0;\n\n        if (offTop) {\n            offY = Math.abs(bounds.top);\n        }\n\n        if (offBottom) {\n            offY = bounds.top + bounds.height - viewport.height;\n        }\n\n        if (offLeft) {\n            offX = Math.abs(bounds.left);\n        }\n\n        if (offRight) {\n            offX = bounds.left + bounds.width - viewport.width;\n        }\n\n        const percentageX = roundPercentage(((bounds.width - offX) * 100) / (bounds.width || 1));\n        const percentageY = roundPercentage(((bounds.height - offY) * 100) / (bounds.height || 1));\n\n        return {\n            x: percentageX,\n            y: percentageY,\n            ratio: Math.min(percentageX, percentageY)\n        };\n    };\n\n    const ID = uniqueID();\n\n    /**\n     *\n     * TODO: find a way to get a recap of what Resource items were loaded and what failed in collection list...\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n\n            if (!isIntersectionObserverSupported) {\n                this.manuallyObservedElements = [];\n\n                const manuallyObserve = () =>\n                    this.manuallyObservedElements.filter(item => !item.intersected).forEach(item => {\n                        if (!item.intersected && isElementInViewport(item.element)) {\n                            item.intersected = true;\n                            item.element.dispatchEvent(new CustomEvent('intersected__' + ID));\n                        }\n                    });\n\n                window.addEventListener('scroll', manuallyObserve);\n                window.addEventListener('resize', manuallyObserve);\n                window.addEventListener('load', manuallyObserve);\n            }\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    this._collection = [];\n\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new CustomEvent('abort__' + ID)));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('This Loader instance is already in progress');\n                }\n\n                if (!this._collection.length) {\n                    reject('Resources collection is empty');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            return;\n                        }\n\n                        this.fetch(this._collection[loaded])\n                            .catch(payload => {\n                                console.warn(payload.event.detail.message + ': ' + payload.resource.url);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: more robust way, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded < this._collection.length) {\n                                    pipeline();\n\n                                    return;\n                                }\n\n                                this._state = 0;\n\n                                resolve(payload);\n                            });\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            break;\n                        }\n\n                        this.fetch(this._collection[i])\n                            .catch(payload => {\n                                console.warn(payload.event.detail.message + ': ' + payload.resource.url);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: more robust way, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded >= this._collection.length) {\n                                    this._state = 0;\n\n                                    resolve();\n                                }\n                            });\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const createdElement = document.createElement(resource.tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (resource.tagName === 'picture') {\n                        // picture element loads only with a fallback img in it...\n                        mainEventsTarget = document.createElement('img');\n                        createdElement.append(mainEventsTarget);\n                    }\n                }\n\n                const finishPromise = (event, resolver) => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    resolver({\n                        event: event,\n                        resource: resource\n                    });\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = (eventName = '', data = {}) => {\n                    const event = new CustomEvent(eventName, {\n                        detail: {\n                            ...data,\n                            ...{\n                                resource: resource\n                            }\n                        }\n                    });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n\n                    return event;\n                };\n\n                let queuer = {\n                    resource: resource,\n                    observer: null,\n                    element: createdElement\n                };\n\n                createdElement.addEventListener('abort__' + ID, () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: 'abortion',\n                        message: 'Resource load aborted'\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                mainEventsTarget.addEventListener('error', e => {\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: e.type,\n                        message: 'Resource failed to load' // TODO: a way to retrieve http error code ?\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire \"load\" event when ready in dom\n                        }\n\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', e => {\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy) {\n                    if (isIntersectionObserverSupported) {\n                        queuer.observer = new IntersectionObserver(\n                            (entries, observer) => {\n                                entries.forEach(entry => {\n                                    if (entry.intersectionRatio > 0) {\n                                        observer.unobserve(entry.target);\n\n                                        prepareLoad();\n                                    }\n                                });\n                            },\n                            {\n                                root: null,\n                                rootMargin: '0px',\n                                threshold: 0.1\n                            }\n                        );\n\n                        queuer.observer.observe(resource.element);\n                    } else {\n                        if (isElementInViewport(resource.element)) {\n                            prepareLoad();\n                        } else {\n                            this.manuallyObservedElements.push({\n                                element: resource.element,\n                                intersected: false\n                            });\n                            resource.element.addEventListener('intersected__' + ID, () => prepareLoad());\n                        }\n                    }\n\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"]}