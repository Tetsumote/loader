{"version":3,"sources":["loader.js"],"names":["global","factory","exports","module","define","amd","Loader","generateInstanceID","Math","floor","random","stringContains","heystack","needle","String","prototype","includes","indexOf","stringStartsWith","startsWith","substr","length","arrayFindIndex","filter","Array","findIndex","index","hyphensToCamelCase","string","replace","g","toUpperCase","capitalize","charAt","slice","nodelistToArray","nodelist","isInArray","privateCache","intersectionObserverSupported","window","pictureElementSupported","isVisible","element","intersectionRatio","getComputedStyle","bodyEl","document","getElementsByTagName","winWidth","innerWidth","documnt","documentElement","clientWidth","winHeight","innerHeight","clientHeight","rect","getBoundingClientRect","right","bottom","left","top","isHTMLElement","HTMLElement","e","nodeType","style","ownerDocument","isLoaded","source","currentSrc","complete","readyState","isFullyBuffered","media","buffered","round","end","seekable","isBroken","naturalWidth","videoWidth","pluginInstance","eventNamespaceParserSeparator","supportedExtensions","image","audio","video","supportedTags","privateEventsStorage","CustomEvent$1","CustomEvent","_polyfill","event","params","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","Event","detachEventListener","events","key","eventNameWithNamespace","split","type","namespace","join","removeEventListener","handler","attachEventListener","once","count","_handler","call","addEventListener","decodeResource","output","format","extension","tag","consistent","resource","formatCandidate","base64Heading","RegExp","test","matches64","match","matches","tagName","toLowerCase","allTags","Object","values","forEach","tags","SingleLoader","options","_settings","srcAttr","srcsetAttr","playthrough","visible","Error","_id","_idEvent","_busy","_element","_resource","_format","_observer","_done","_success","_error","_callback","unobserve","src","push","thisArguments","apply","_exists","_consistent","_originalElement","picture","closest","dataset","querySelectorAll","el","setAttribute","isStandardPlaythrough","isFullPlaythrough","sources","callMediaLoad","sourcesErrorId","thisSource","load","onProgressReplacementInterval","setInterval","isError","duration","currentTime","paused","play","clearInterval","pause","callback","status","id","getAttribute","srcset","removeAttribute","data","info","_tag","createElement","IntersectionObserver","entries","observer","entry","target","root","rootMargin","threshold","observe","_collection","_collectionLoaded","_collectionInstances","_collectionPending","_resourcesLoaded","backgrounds","percentage","_progress","_loop","_abort","_loaded","_complete","sequentialMode","sequential","i","thisLoadId","thisLoadIndex","x","thisLoadInstance","instance","done","aProgress","parseFloat","toFixed","thisResource","dispatchEvent","resources","thisInstance","abort","collection","collectedResources","findResources","err","item","settings","body","targets","targetsExtended","targetsFilter","targetsTags","children","targetSource","targetsBg","backgroundImage","url"],"mappings":"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","file":"loader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    /**\n     * @returns {string}\n     */\n    const generateInstanceID = () => {\n        return Math.floor(Math.random() * (9999 - 1000)) + 1000;\n    };\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringContains = (heystack, needle) => {\n        return String.prototype.includes ? heystack.includes(needle) : heystack.indexOf(needle, 0) !== -1;\n    };\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringStartsWith = (heystack, needle) => {\n        return String.prototype.startsWith ? heystack.startsWith(needle) : heystack.substr(0, needle.length) === needle;\n    };\n\n    /**\n     * @param {Array} heystack\n     * @param {Function} filter\n     * @returns {number}\n     */\n    const arrayFindIndex = (heystack, filter) => {\n        return Array.prototype.findIndex\n            ? heystack.findIndex(filter)\n            : (() => {\n                  let length = heystack.length,\n                      index = -1;\n                  while (++index < length) {\n                      if (filter(heystack[index], index, heystack)) {\n                          return index;\n                      }\n                  }\n                  return -1;\n              })();\n    };\n\n    /**\n     * @param {string} string\n     * @returns {string}\n     */\n    const hyphensToCamelCase = string => {\n        return string.replace(/-([a-z])/g, g => g[1].toUpperCase());\n    };\n\n    /**\n     * @param {string} string\n     * @returns {string}\n     */\n    const capitalize = string => {\n        return string.charAt(0).toUpperCase() + string.slice(1);\n    };\n\n    /**\n     * @param {NodeList} nodelist\n     * @returns {Array}\n     */\n    const nodelistToArray = nodelist => {\n        return [...nodelist];\n    };\n\n    /**\n     * @param {String|number} needle\n     * @param {Array} heystack\n     * @returns {boolean}\n     */\n    const isInArray = (needle, heystack) => {\n        return heystack.indexOf(needle) > -1;\n    };\n\n    let privateCache = [];\n\n    const intersectionObserverSupported = 'IntersectionObserver' in window;\n    const pictureElementSupported = 'HTMLPictureElement' in window;\n\n    /**\n     * @param {HTMLElement} element\n     * @returns {boolean}\n     */\n    const isVisible = element => {\n        if (intersectionObserverSupported && 'intersectionRatio' in element) {\n            return element.intersectionRatio > 0;\n        }\n\n        if (window.getComputedStyle(element, 'display') === 'none') {\n            return false;\n        }\n\n        const bodyEl = document.getElementsByTagName('body')[0];\n        const winWidth = window.innerWidth || documnt.documentElement.clientWidth || bodyEl.clientWidth;\n        const winHeight = window.innerHeight || documnt.documentElement.clientHeight || bodyEl.clientHeight;\n        const rect = element.getBoundingClientRect();\n\n        return !(rect.right < 0 || rect.bottom < 0 || rect.left > winWidth || rect.top > winHeight);\n    };\n\n    /**\n     * @param {HTMLElement} element\n     * @returns {boolean}\n     */\n    const isHTMLElement = element => {\n        if (typeof element !== 'object') {\n            return false;\n        }\n        try {\n            return element instanceof HTMLElement;\n        } catch (e) {\n            return element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object';\n        }\n    };\n\n    /**\n     * @param {(string|HTMLVideoElement|HTMLAudioElement|HTMLImageElement)} source\n     * @returns {boolean}\n     */\n    const isLoaded = source => {\n        return (\n            (typeof source === 'string' && isInArray(source, privateCache)) ||\n            (isHTMLElement(source) &&\n                ('currentSrc' in source && source.currentSrc.length > 0) &&\n                (('complete' in source && source.complete) || ('readyState' in source && source.readyState >= 2)))\n        );\n    };\n\n    /**\n     * @param {(HTMLVideoElement|HTMLAudioElement)} source\n     * @returns {boolean}\n     */\n    const isFullyBuffered = media => {\n        return media.buffered.length && Math.round(media.buffered.end(0)) / Math.round(media.seekable.end(0)) === 1;\n    };\n\n    /**\n     * @param {(string|HTMLElement)} source\n     * @returns {boolean}\n     */\n    const isBroken = source => {\n        return (\n            isLoaded(source) &&\n            ((isHTMLElement(source) && (('naturalWidth' in source && Math.floor(source.naturalWidth) === 0) || ('videoWidth' in source && source.videoWidth === 0))) ||\n                typeof source === 'string')\n        );\n    };\n\n    const pluginInstance = generateInstanceID();\n    const eventNamespaceParserSeparator = '__namespace__';\n\n    const supportedExtensions = {\n        image: 'jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg',\n        audio: 'mp3|ogg|oga|spx|ogg|wav',\n        video: 'mp4|ogv|webm'\n    };\n\n    const supportedTags = {\n        image: 'img|picture|source',\n        audio: 'audio|source',\n        video: 'video|source'\n    };\n\n    let privateEventsStorage = {};\n\n    const CustomEvent$1 =\n        window.CustomEvent ||\n        (() => {\n            const _polyfill = (event, params) => {\n                params = params || { bubbles: false, cancelable: false, detail: undefined };\n                const evt = document.createEvent('CustomEvent');\n                evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n                return evt;\n            };\n            _polyfill.prototype = window.Event.prototype;\n            return _polyfill;\n        })();\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @returns {undefined}\n     */\n    const detachEventListener = (element, events) => {\n        if (!element || typeof events !== 'string') {\n            return;\n        }\n\n        if (stringStartsWith(events, '.')) {\n            for (let key in privateEventsStorage) {\n                const eventNameWithNamespace = key.replace(eventNamespaceParserSeparator, '.');\n                if (stringContains(eventNameWithNamespace, events) && privateEventsStorage[key].element === element) {\n                    detachEventListener(element, eventNameWithNamespace);\n                }\n            }\n        } else {\n            events = events.split('.');\n\n            const type = events[0],\n                namespace = events[1];\n\n            if (namespace) {\n                events = events.join(eventNamespaceParserSeparator);\n            }\n\n            if (events in privateEventsStorage) {\n                element.removeEventListener(type, privateEventsStorage[events].handler);\n                delete privateEventsStorage[events];\n            }\n        }\n    };\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @param {Function} handler\n     * @param {boolean} once\n     * @returns {undefined}\n     */\n    // TODO: Class EventListener .on .one .off .trigger jQuery-like...\n    const attachEventListener = (element, events, handler, once) => {\n        if (!element || typeof events !== 'string' || typeof handler !== 'function') {\n            return;\n        }\n\n        events = events.split('.');\n\n        const type = events[0];\n        const namespace = events[1];\n\n        if (namespace) {\n            events = events.join(eventNamespaceParserSeparator);\n        }\n\n        privateEventsStorage[events] = { element: element, count: 0, once: false };\n\n        if (true === once) {\n            let _handler = handler;\n            handler = function(event) {\n                if (events in privateEventsStorage) {\n                    privateEventsStorage[events].count++;\n                    if (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\n                        return;\n                    }\n                    _handler.call(this, event);\n                }\n                detachEventListener(element, events);\n            };\n        } else {\n            once = false;\n        }\n\n        privateEventsStorage[events] = {\n            ...privateEventsStorage[events],\n            ...{ handler: handler, once: once }\n        };\n\n        element.addEventListener(type, privateEventsStorage[events].handler, { once: once });\n    };\n\n    /**\n     * @param {Object} resource\n     * @returns {Object}\n     */\n    const decodeResource = resource => {\n        let output = { format: null, extension: null, tag: null, consistent: false };\n\n        resource.resource = resource.resource.split('?')[0];\n        resource.resource = resource.resource.split('#')[0];\n        for (let formatCandidate in supportedExtensions) {\n            const base64Heading = ';base64,';\n\n            if (new RegExp('(.(' + supportedExtensions[formatCandidate] + ')$)|' + base64Heading, 'g').test(resource.resource)) {\n                if (new RegExp(base64Heading, 'g').test(resource.resource)) {\n                    let matches64 = resource.resource.match(new RegExp('^data:' + formatCandidate + '/(' + supportedExtensions[formatCandidate] + ')', 'g'));\n\n                    if (null === matches64) {\n                        return;\n                    }\n\n                    matches64 = matches64[0];\n\n                    output.format = formatCandidate;\n                    output.extension = matches64.replace('data:' + formatCandidate + '/', '');\n                    output.tag = supportedTags[formatCandidate];\n\n                    break;\n                } else {\n                    let matches = resource.resource.match(new RegExp(supportedExtensions[formatCandidate], 'g'));\n\n                    if (matches) {\n                        output.format = formatCandidate;\n                        output.extension = matches[0];\n                        output.tag = supportedTags[formatCandidate];\n\n                        break;\n                    }\n                }\n            }\n        }\n\n        if (isHTMLElement(resource.element)) {\n            let tagName = resource.element.tagName.toLowerCase();\n            let allTags = '';\n\n            Object.values(supportedTags).forEach(tags => {\n                allTags += '|' + tags;\n            });\n\n            allTags = allTags.split('|');\n\n            if (isInArray(tagName, allTags)) {\n                output.tag = tagName;\n                output.consistent = true;\n                if (output.format === null) {\n                    for (let format in supportedTags) {\n                        if (stringContains(supportedTags[format], output.tag)) {\n                            output.format = format;\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (stringContains(output.tag, '|')) {\n            output.tag = output.tag.split('|')[0];\n        }\n\n        return output;\n    };\n\n    // TODO: Promise support\n    // TODO: think about useful vars in callback args (this class is not public but its vars are returned in .progress() callback)\n    /** TODO: description of the MyClass constructor function.\n     * @class\n     * @classdesc TODO: description of the SingleLoader class.\n     */\n    class SingleLoader {\n        /**\n         * @param {Object} [options={ srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false }]\n         */\n        constructor(options) {\n            this._settings = {\n                ...{\n                    srcAttr: 'data-src',\n                    srcsetAttr: 'data-srcset',\n                    playthrough: false,\n                    visible: false\n                },\n                ...options\n            };\n\n            if (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n                throw new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n            }\n\n            this.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n            this.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n            this._id = null;\n            this._idEvent = null;\n            this._busy = false;\n\n            this._element = null;\n            this._resource = null;\n            this._format = null;\n            this._observer = null;\n\n            this._done = () => {};\n            this._success = () => {};\n            this._error = () => {};\n\n            this._callback = e => {\n                this._busy = false;\n                if (null !== this._observer) {\n                    this._observer.unobserve(this._element);\n                }\n\n                const src = this._element.currentSrc || this._element.src;\n\n                if (!isInArray(src, privateCache)) {\n                    privateCache.push(src);\n                }\n\n                let thisArguments = [this._element, e.type, src, this._id];\n\n                this[e.type !== 'error' ? '_success' : '_error'].apply(this, thisArguments);\n                this._done.apply(this, thisArguments);\n            };\n        }\n\n        /**\n         * @param {Object} data\n         */\n        set resource(data) {\n            if (typeof data === 'object' && 'id' in data && 'element' in data && 'resource' in data) {\n                this._id = data.id;\n                this._element = data.element;\n                this._resource = data.resource;\n\n                this._busy = this._idEvent !== undefined;\n\n                // TODO: FIXME: if this.busy, ottieni tutte le variabili seguenti da una cache.\n\n                let info = decodeResource({\n                    resource: this._resource,\n                    element: this._element\n                });\n                this._tag = info.tag;\n                this._consistent = info.consistent; // wrong tag for resource type...\n                this._format = info.format;\n                this._exists = this._element !== null;\n                this._originalElement = this._element;\n\n                if (!this._exists || !this._consistent) {\n                    this._element = document.createElement(this._tag);\n                    this._element.dataset[this.srcAttr] = this._resource;\n                }\n\n                this._idEvent = this._busy ? this._element[pluginInstance + '_IDEvent'] : 'resourceLoader_unique_' + this._element.tagName + '_' + generateInstanceID();\n\n                //TODO: FIXME: this._lazy = this._busy ? this._lazy : !!(this._element.dataset[this.srcAttr] || this._element.dataset[this.srcsetAttr]);\n\n                if (this._exists && this._settings.visible && intersectionObserverSupported) {\n                    this._observer = new IntersectionObserver(\n                        (entries, observer) => {\n                            entries.forEach(entry => (entry.target.intersectionRatio = entry.intersectionRatio));\n                        },\n                        {\n                            root: null,\n                            rootMargin: '0px',\n                            threshold: 0.1\n                        }\n                    );\n                    this._observer.observe(this._originalElement);\n                }\n            }\n        }\n\n        /**\n         * @returns {string}\n         */\n        get resource() {\n            return this._resource;\n        }\n\n        /**\n         * @returns {boolean} se ha preso in carico il caricamento oppure no per vari motivi (è già caricato, non è nella viewport etc)\n         */\n        load() {\n            // TODO: FIXME: (3) check for placeholders / non-lazy resources\n            // if isLoaded(this._exists && this._consistent ? this._element : this._resource) &&\n            // (\n            //    ( this._lazy && ( data-xyz-src === src || data-xyz-srcset === srcset ) ) // TODO: capire come\n            //    ||\n            //    !this._lazy\n            // )\n\n            //TODO: remove elseif else when returning?\n            if (isLoaded(this._exists && this._consistent ? this._element : this._resource)) {\n                if (!this._busy) {\n                    // TODO: mayabe this should be called in this._callback\n                    detachEventListener(this._element, '.' + this._idEvent);\n                }\n\n                this._callback(new CustomEvent$1(!isBroken(this._exists && this._consistent ? this._element : this._resource) ? 'load' : 'error'));\n\n                return false;\n            } else if (this._exists && this._settings.visible && !isVisible(this._originalElement)) {\n                return false;\n            } else {\n                if (this._format === 'image') {\n                    attachEventListener(this._element, 'load.' + this._idEvent, this._callback, !this._busy);\n                    attachEventListener(this._element, 'error.' + this._idEvent, this._callback, !this._busy);\n\n                    const picture = this._element.closest('picture');\n\n                    if (picture && pictureElementSupported) {\n                        delete this._element.dataset[this.srcsetAttr];\n                        delete this._element.dataset[this.srcAttr];\n\n                        picture.querySelectorAll('source[' + this._settings.srcsetAttr + ']').forEach(el => {\n                            el.setAttribute('srcset', el.dataset[this.srcAttr]);\n                            delete el.dataset[this.srcAttr];\n                        });\n                    } else {\n                        if (this._element.matches('[' + this._settings.srcsetAttr + ']')) {\n                            this._element.setAttribute('srcset', this._element.dataset[this.srcsetAttr]);\n                            delete this._element.dataset[this.srcsetAttr];\n                        }\n\n                        if (this._element.matches('[' + this._settings.srcAttr + ']')) {\n                            this._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n                            delete this._element.dataset[this.srcAttr];\n                        }\n                    }\n                } else if (this._format === 'video' || this._format === 'audio') {\n                    const isStandardPlaythrough = true === this._settings.playthrough;\n                    const isFullPlaythrough = 'full' === this._settings.playthrough;\n                    const sources = this._element.querySelectorAll('source');\n\n                    let callMediaLoad = false;\n\n                    if (sources) {\n                        sources.forEach(source => {\n                            if (source.matches('[' + this._settings.srcAttr + ']')) {\n                                source.setAttribute('src', source.dataset[this.srcAttr]);\n                                delete source.dataset[this.srcsetAttr];\n\n                                callMediaLoad = true;\n                            }\n\n                            attachEventListener(\n                                source,\n                                'error.' + this._idEvent,\n                                e => {\n                                    const sourcesErrorId = 'resourceLoader_error';\n\n                                    source[pluginInstance + '_' + sourcesErrorId] = true;\n\n                                    if (sources.length === nodelistToArray(sources).filter(thisSource => true === thisSource[pluginInstance + '_' + sourcesErrorId]).length) {\n                                        this._callback(e);\n                                    }\n                                },\n                                !this._busy // true -> once, false -> on\n                            );\n                        });\n                    } else if (this._element.matches('[' + this._settings.srcAttr + ']')) {\n                        this._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n                        delete this._element.dataset[this.srcAttr];\n\n                        attachEventListener(\n                            this._element,\n                            'error.' + this._idEvent,\n                            this._callback,\n                            !this._busy // true -> once, false -> on\n                        );\n\n                        callMediaLoad = true;\n                    }\n\n                    if (callMediaLoad) {\n                        this._element.load();\n                    }\n\n                    attachEventListener(\n                        this._element,\n                        'loadedmetadata.' + this._idEvent,\n                        () => {\n                            if (!isStandardPlaythrough && !isFullPlaythrough) {\n                                this._callback(new CustomEvent$1('load'));\n                            }\n\n                            if (isFullPlaythrough) {\n                                let onProgressReplacementInterval = setInterval(() => {\n                                    let isError = this._element.readyState > 0 && !this._element.duration;\n\n                                    if (isError || isFullyBuffered(this._element)) {\n                                        this._element.currentTime = 0;\n\n                                        if (!isError && !this._busy && this._element.paused && this._element.matches('[autoplay]')) {\n                                            this._element.play();\n                                        }\n\n                                        clearInterval(onProgressReplacementInterval);\n\n                                        this._callback(new CustomEvent$1(!isError ? 'load' : 'error'));\n                                    } else {\n                                        if (!this._element.paused) {\n                                            this._element.pause();\n                                        }\n\n                                        if (!this._busy) {\n                                            this._element.currentTime += 2;\n                                        }\n                                    }\n                                }, 500);\n\n                                this._element[ 'resourceLoader_' + this._idEvent] = onProgressReplacementInterval;\n                            }\n                        },\n                        !this._busy // true -> once, false -> on\n                    );\n\n                    attachEventListener(\n                        this._element,\n                        'canplay.' + this._idEvent,\n                        () => {\n                            if (isFullPlaythrough && this._element.currentTime === 0 && !isFullyBuffered(this._element)) {\n                                this._element.currentTime++;\n                            }\n                        },\n                        !this._busy // true -> once, false -> on\n                    );\n\n                    attachEventListener(\n                        this._element,\n                        'canplaythrough.' + this._idEvent,\n                        () => {\n                            if (isStandardPlaythrough) {\n                                this._callback(new CustomEvent$1('load'));\n                            }\n                        },\n                        !this._busy // true -> once, false -> on\n                    );\n                } else {\n                    return false;\n                }\n\n                if (!this._busy) {\n                    this._element[pluginInstance + '_IDEvent'] = this._idEvent;\n                }\n            }\n\n            this._resource = this._element.currentSrc || this._element.src;\n\n            return !this._busy;\n        }\n\n        /**\n         * @param {Function} callback\n         * @returns {undefined}\n         */\n        done(callback) {\n            if (typeof callback !== 'function') {\n                return;\n            }\n\n            this._done = function(element, status, resource, id) {\n                callback.apply(this, [element, status, resource, id]);\n            };\n        }\n\n        /**\n         * @returns {undefined}\n         */\n        abort() {\n            detachEventListener(this._element, '.' + this._idEvent);\n\n            if (isLoaded(this._exists ? this._element : this._resource)) {\n                return;\n            }\n\n            const src = this._element.getAttribute('srcset'),\n                srcset = this._element.getAttribute('src');\n\n            if (undefined !== src) {\n                this._element.dataset[this.srcAttr] = src;\n                this._element.setAttribute(this._settings.srcAttr, src);\n                this._element.removeAttribute('src');\n                this._element.removeAttribute('srcset');\n            }\n\n            if (undefined !== srcset) {\n                this._element.dataset[this.srcsetAttr] = srcset;\n                this._element.setAttribute(this._settings.srcsetAttr, srcset);\n                this._element.removeAttribute('src');\n                this._element.removeAttribute('srcset');\n            }\n        }\n    }\n\n    // TODO: Promise support\n    // TODO: private vars\n    // TODO: refactory succes/done/progress code...\n    /** TODO: description of the MyClass constructor function.\n     * @class\n     * @classdesc TODO: description of the Loader class.\n     */\n    class Loader {\n        /**\n         * @param {Object} [options={srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false, backgrounds: false }]\n         */\n        constructor(options) {\n            this._collection = [];\n            this._collectionLoaded = [];\n            this._collectionInstances = [];\n            this._collectionPending = [];\n            this._resourcesLoaded = [];\n\n            this._settings = {\n                ...{\n                    srcAttr: 'data-src',\n                    srcsetAttr: 'data-srcset',\n                    playthrough: false,\n                    visible: false,\n                    backgrounds: false\n                },\n                ...options\n            };\n\n            if (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n                throw new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n            }\n\n            this.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n            this.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n            this.percentage = 0;\n\n            this._done = () => {};\n            this._progress = () => {};\n            this._success = () => {};\n            this._error = () => {};\n            this._loop = this.load;\n\n            this._abort = false;\n            this._loaded = 0;\n            this._complete = false;\n            this._busy = false;\n        }\n\n        /**\n         *\n         * @param {HTMLElement} [element=document.body]\n         * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n         */\n        static findResources(element, options) {\n            let settings = {\n                srcAttr: 'src',\n                srcsetAttr: 'srcset',\n                backgrounds: false\n            };\n\n            if (typeof element === 'object' && undefined === options) {\n                for (let key in settings) {\n                    if (key in element) {\n                        options = element;\n                        element = undefined;\n                        break;\n                    }\n                }\n            }\n\n            if (undefined === element || element === document) {\n                element = document.body;\n            }\n\n            if (!isHTMLElement(element)) {\n                throw new Error('TypeError: ' + element + ' is not of type HTMLElement.');\n            }\n\n            let collectedResources = [];\n\n            settings = {\n                ...settings,\n                ...options\n            };\n\n            const targets = 'img, video, audio';\n            const targetsExtended = targets + ', picture, source';\n            const targetsFilter = '[' + settings.srcAttr + '], [' + settings.srcsetAttr + ']';\n\n            let targetsTags = nodelistToArray(element.querySelectorAll(targets));\n\n            if (element.matches(targetsExtended)) {\n                targetsTags.push(element);\n            }\n\n            targetsTags = targetsTags.filter(target => {\n                let children = nodelistToArray(target.children);\n                children = children.filter(x => x.matches(targetsExtended));\n                children = children.filter(x => x.matches(targetsFilter));\n                return target.matches(targetsFilter) || children.length;\n            });\n            targetsTags.forEach(target => {\n                let targetSource = target;\n\n                if (!targetSource.matches(targetsFilter)) {\n                    targetSource = targetSource.querySelectorAll(targetsFilter);\n                    targetSource = [...targetSource][0];\n                }\n\n                collectedResources.push({\n                    element: target,\n                    resource: targetSource.getAttribute(settings.srcAttr) || targetSource.getAttribute(settings.srcsetAttr)\n                });\n            });\n\n            if (true === settings.backgrounds) {\n                let targetsBg = nodelistToArray(element.querySelectorAll('*'));\n                targetsBg.push(element);\n                targetsBg = targetsBg.filter(target => !target.matches(targetsExtended));\n                targetsBg = targetsBg.filter(target => getComputedStyle(target).backgroundImage !== 'none');\n                targetsBg.forEach(target => {\n                    const url = getComputedStyle(target).backgroundImage.match(/\\((.*?)\\)/);\n\n                    if (null !== url && url.length >= 2) {\n                        collectedResources.push({\n                            element: target,\n                            resource: url[1].replace(/('|\")/g, '')\n                        });\n                    }\n                });\n            }\n\n            return collectedResources;\n        }\n\n        /**\n         * @param {(Array.<String>|HTMLElement)} collection\n         */\n        set collection(collection) {\n            let collectedResources = collection;\n\n            try {\n                collectedResources = Loader.findResources(collection, this._settings);\n            } catch (err) {}\n\n            collectedResources.forEach(item => {\n                let element = {\n                    resource: '',\n                    element: null,\n                    id: generateInstanceID()\n                };\n\n                if (typeof item === 'string') {\n                    element.resource = item;\n                } else if (typeof item === 'object' && 'resource' in item) {\n                    element = { ...element, ...item };\n                } else {\n                    return;\n                }\n\n                this._collection.push(element);\n            });\n        }\n\n        /**\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         * @returns {undefined}\n         */\n        load() {\n            if (!this._collection.length) {\n                this._done.call(this, this._resourcesLoaded);\n            }\n\n            // resets pending elements (sequential opt helper array) every time we loop\n            this._collectionPending = [];\n\n            const sequentialMode = true === this._settings.sequential;\n\n            for (let i = 0; i < this._collection.length; i++) {\n                if (this._abort) {\n                    break;\n                }\n\n                let thisLoadId = this._collection[i].id;\n                let thisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n                let thisLoadInstance = new SingleLoader(this._settings);\n\n                if (thisLoadIndex === -1) {\n                    this._collectionInstances.push({\n                        id: thisLoadId,\n                        instance: thisLoadInstance\n                    });\n                    thisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n                } else {\n                    this._collectionInstances[thisLoadIndex].instance = thisLoadInstance;\n                }\n\n                thisLoadInstance.resource = this._collection[i];\n\n                thisLoadInstance.done((element, status, resource, id) => {\n                    if (this._complete || this._abort) {\n                        return;\n                    }\n\n                    const aProgress = !isInArray(id, this._collectionLoaded);\n\n                    if (aProgress) {\n                        this._collectionLoaded.push(id);\n                        this._busy = false;\n\n                        this._loaded++;\n                        this.percentage = (this._loaded / this._collection.length) * 100;\n                        this.percentage = parseFloat(this.percentage.toFixed(4));\n\n                        const thisResource = {\n                            resource: resource,\n                            status: status,\n                            element: element\n                        };\n                        this._resourcesLoaded.push(thisResource);\n                        this._progress.call(this, thisResource);\n                        this[status !== 'error' ? '_success' : '_error'].call(this, thisResource);\n\n                        element.dispatchEvent(new CustomEvent('resource' + capitalize(status), { detail: thisResource }));\n                        document.dispatchEvent(new CustomEvent('resource' + capitalize(status), { detail: thisResource }));\n                    }\n\n                    if (this._loaded === this._collection.length) {\n                        this._done.call(this, this._resourcesLoaded);\n\n                        this._complete = true;\n                    } else if (aProgress && sequentialMode && this._collectionPending.length) {\n                        this._collectionPending = this._collectionPending.filter(x => x.id !== id);\n\n                        if (this._collectionPending.length) {\n                            this._busy = this._collectionPending[0].instance.load();\n                        }\n                    }\n                });\n\n                if (!sequentialMode || (sequentialMode && !this._busy)) {\n                    this._busy = thisLoadInstance.load();\n                } else if (\n                    sequentialMode &&\n                    this._busy &&\n                    (!this._settings.visible || !thisLoadInstance._exists || (this._settings.visible && thisLoadInstance._exists && isVisible(thisLoadInstance._originalElement)))\n                ) {\n                    this._collectionPending.push({\n                        id: thisLoadId,\n                        instance: thisLoadInstance\n                    });\n                }\n            }\n        }\n\n        /**\n         * @param {Function} callback\n         * @returns {undefined}\n         */\n        done(callback) {\n            if (typeof callback !== 'function') {\n                return;\n            }\n\n            this._done = function(resources) {\n                callback.call(this, resources);\n            };\n        }\n\n        /**\n         * @param {Function} callback\n         * @returns {undefined}\n         */\n        progress(callback) {\n            if (typeof callback !== 'function') {\n                return;\n            }\n\n            this._progress = function(resource) {\n                callback.call(this, resource);\n            };\n        }\n\n        /**\n         * @param {Function} callback\n         * @returns {undefined}\n         */\n        success(callback) {\n            if (typeof callback !== 'function') {\n                return;\n            }\n\n            this._success = function(resource) {\n                callback.call(this, resource);\n            };\n        }\n\n        /**\n         * @param {Function} callback\n         * @returns {undefined}\n         */\n        error(callback) {\n            if (typeof callback !== 'function') {\n                return;\n            }\n\n            this._error = function(resource) {\n                callback.call(this, resource);\n            };\n        }\n\n        /**\n         * @returns {undefined}\n         */\n        abort() {\n            this._collectionInstances.forEach(thisInstance => {\n                thisInstance.instance.abort();\n            });\n\n            this._abort = true;\n        }\n    }\n\n    return Loader;\n\n})));\n"]}