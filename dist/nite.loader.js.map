{"version":3,"sources":["nite.loader.js"],"names":["global","factory","exports","module","define","amd","niteLoader","generateInstanceID","Math","floor","random","stringContains","heystack","needle","String","prototype","includes","indexOf","stringStartsWith","startsWith","substr","length","arrayFindIndex","filter","Array","findIndex","index","hyphensToCamelCase","string","replace","g","toUpperCase","capitalize","charAt","slice","nodelistToArray","nodelist","isInArray","throttle","callback","wait","context","undefined","timeout","callbackArgs","later","apply","arguments","setTimeout","privateCache","intersectionObserverSupported","window","pictureElementSupported","jQueryIncluded","isVisible","element","intersectionRatio","getComputedStyle","bodyEl","document","getElementsByTagName","winWidth","innerWidth","documnt","documentElement","clientWidth","winHeight","innerHeight","clientHeight","rect","getBoundingClientRect","right","bottom","left","top","isHTMLElement","HTMLElement","e","nodeType","style","ownerDocument","isLoaded","source","currentSrc","complete","readyState","isFullyBuffered","media","buffered","round","end","seekable","isBroken","naturalWidth","videoWidth","pluginPrefix","pluginMethod","pluginName","pluginInstance","eventNamespaceParserSeparator","supportedExtensions","image","audio","video","supportedTags","privateEventsStorage","CustomEvent","_polyfill","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","Event","detachEventListener","events","key","eventNameWithNamespace","split","type","namespace","join","removeEventListener","handler","attachEventListener","once","count","_handler","call","addEventListener","decodeResource","output","format","extension","tag","consistent","resource","formatCandidate","base64Heading","RegExp","test","matches64","match","matches","tagName","toLowerCase","allTags","Object","values","forEach","tags","SingleLoader","options","_settings","srcAttr","srcsetAttr","playthrough","visible","Error","_id","_idEvent","_busy","_element","_resource","_format","_observer","_done","_success","_error","_callback","unobserve","src","push","thisArguments","_exists","_consistent","_originalElement","picture","closest","dataset","querySelectorAll","el","setAttribute","isStandardPlaythrough","isFullPlaythrough","sources","callMediaLoad","sourcesErrorId","thisSource","load","onProgressReplacementInterval","setInterval","isError","duration","currentTime","paused","play","clearInterval","pause","status","id","getAttribute","srcset","removeAttribute","data","info","_tag","createElement","IntersectionObserver","entries","observer","entry","target","root","rootMargin","threshold","observe","Loader","_collection","_collectionLoaded","_collectionInstances","_collectionPending","_resourcesLoaded","backgrounds","percentage","_progress","_loop","_abort","_loaded","_complete","sequentialMode","sequential","i","thisLoadId","thisLoadIndex","x","thisLoadInstance","instance","done","aProgress","parseFloat","toFixed","thisResource","resources","thisInstance","abort","collection","collectedResources","findResources","err","item","settings","body","targets","targetsExtended","targetsFilter","targetsTags","children","targetSource","targetsBg","backgroundImage","url","$","jQuery","$window","methodCollection","fn","originalUserOptions","early","earlyTimeout","onProgress","onLoad","onError","onComplete","isFunction","each","$element","uniqueMethodPluginName","progress","trigger","eventName","off","is","thisMethodCollection","on","breakLoop","clearTimeout","parseInt","isNaN","isFinite"],"mappings":"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","file":"nite.loader.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define('niteLoader', factory) :\n\t(global.niteLoader = factory());\n}(this, (function () { 'use strict';\n\n\t/**\n\t * @returns {string}\n\t */\n\tconst generateInstanceID = () => {\n\t\treturn Math.floor(Math.random() * (9999 - 1000)) + 1000;\n\t};\n\n\t/**\n\t * @param {string} heystack\n\t * @param {string} needle\n\t * @returns {boolean}\n\t */\n\tconst stringContains = (heystack, needle) => {\n\t\treturn String.prototype.includes ? heystack.includes(needle) : heystack.indexOf(needle, 0) !== -1;\n\t};\n\n\t/**\n\t * @param {string} heystack\n\t * @param {string} needle\n\t * @returns {boolean}\n\t */\n\tconst stringStartsWith = (heystack, needle) => {\n\t\treturn String.prototype.startsWith ? heystack.startsWith(needle) : heystack.substr(0, needle.length) === needle;\n\t};\n\n\t/**\n\t * @param {Array} heystack\n\t * @param {Function} filter\n\t * @returns {number}\n\t */\n\tconst arrayFindIndex = (heystack, filter) => {\n\t\treturn Array.prototype.findIndex\n\t\t\t? heystack.findIndex(filter)\n\t\t\t: (() => {\n\t\t\t\t\tlet length = heystack.length,\n\t\t\t\t\t\tindex = -1;\n\t\t\t\t\twhile (++index < length) {\n\t\t\t\t\t\tif (filter(heystack[index], index, heystack)) {\n\t\t\t\t\t\t\treturn index;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn -1;\n\t\t\t  })();\n\t};\n\n\t/**\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tconst hyphensToCamelCase = string => {\n\t\treturn string.replace(/-([a-z])/g, g => g[1].toUpperCase());\n\t};\n\n\t/**\n\t * @param {string} string\n\t * @returns {string}\n\t */\n\tconst capitalize = string => {\n\t\treturn string.charAt(0).toUpperCase() + string.slice(1);\n\t};\n\n\t/**\n\t * @param {NodeList} nodelist\n\t * @returns {Array}\n\t */\n\tconst nodelistToArray = nodelist => {\n\t\treturn [...nodelist];\n\t};\n\n\t/**\n\t * @param {String|number} needle\n\t * @param {Array} heystack\n\t * @returns {boolean}\n\t */\n\tconst isInArray = (needle, heystack) => {\n\t\treturn heystack.indexOf(needle) > -1;\n\t};\n\n\t// thanks https://gist.github.com/beaucharman/e46b8e4d03ef30480d7f4db5a78498ca\n\tconst throttle = (callback, wait, context = undefined) => {\n\t\tlet timeout = null;\n\t\tlet callbackArgs = null;\n\t\tconst later = () => {\n\t\t\tcallback.apply(context, callbackArgs);\n\t\t\ttimeout = null;\n\t\t};\n\t\treturn function() {\n\t\t\tif (!timeout) {\n\t\t\t\tcallbackArgs = arguments;\n\t\t\t\ttimeout = setTimeout(later, wait);\n\t\t\t}\n\t\t};\n\t};\n\n\tlet privateCache = [];\n\n\tconst intersectionObserverSupported = 'IntersectionObserver' in window;\n\tconst pictureElementSupported = 'HTMLPictureElement' in window;\n\tconst jQueryIncluded = 'jQuery' in window;\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @returns {boolean}\n\t */\n\tconst isVisible = element => {\n\t\tif (intersectionObserverSupported && 'intersectionRatio' in element) {\n\t\t\treturn element.intersectionRatio > 0;\n\t\t}\n\n\t\tif (window.getComputedStyle(element, 'display') === 'none') {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst bodyEl = document.getElementsByTagName('body')[0];\n\t\tconst winWidth = window.innerWidth || documnt.documentElement.clientWidth || bodyEl.clientWidth;\n\t\tconst winHeight = window.innerHeight || documnt.documentElement.clientHeight || bodyEl.clientHeight;\n\t\tconst rect = element.getBoundingClientRect();\n\n\t\treturn !(rect.right < 0 || rect.bottom < 0 || rect.left > winWidth || rect.top > winHeight);\n\t};\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @returns {boolean}\n\t */\n\tconst isHTMLElement = element => {\n\t\tif (typeof element !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\ttry {\n\t\t\treturn element instanceof HTMLElement;\n\t\t} catch (e) {\n\t\t\treturn element.nodeType === 1 && typeof element.style === 'object' && typeof element.ownerDocument === 'object';\n\t\t}\n\t};\n\n\t/**\n\t * @param {(string|HTMLVideoElement|HTMLAudioElement|HTMLImageElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isLoaded = source => {\n\t\treturn (\n\t\t\t(typeof source === 'string' && isInArray(source, privateCache)) ||\n\t\t\t(isHTMLElement(source) &&\n\t\t\t\t('currentSrc' in source && source.currentSrc.length > 0) &&\n\t\t\t\t(('complete' in source && source.complete) || ('readyState' in source && source.readyState >= 2)))\n\t\t);\n\t};\n\n\t/**\n\t * @param {(HTMLVideoElement|HTMLAudioElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isFullyBuffered = media => {\n\t\treturn media.buffered.length && Math.round(media.buffered.end(0)) / Math.round(media.seekable.end(0)) === 1;\n\t};\n\n\t/**\n\t * @param {(string|HTMLElement)} source\n\t * @returns {boolean}\n\t */\n\tconst isBroken = source => {\n\t\treturn (\n\t\t\tisLoaded(source) &&\n\t\t\t((isHTMLElement(source) && (('naturalWidth' in source && Math.floor(source.naturalWidth) === 0) || ('videoWidth' in source && source.videoWidth === 0))) ||\n\t\t\t\ttypeof source === 'string')\n\t\t);\n\t};\n\n\tconst pluginPrefix = 'nite';\n\tconst pluginMethod = pluginPrefix + 'Load';\n\tconst pluginName = pluginMethod + 'er';\n\tconst pluginInstance = generateInstanceID();\n\tconst eventNamespaceParserSeparator = '__namespace__';\n\n\tconst supportedExtensions = {\n\t\timage: 'jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg',\n\t\taudio: 'mp3|ogg|oga|spx|ogg|wav',\n\t\tvideo: 'mp4|ogv|webm'\n\t};\n\tconst supportedTags = {\n\t\timage: 'img|picture|source',\n\t\taudio: 'audio|source',\n\t\tvideo: 'video|source'\n\t};\n\n\tlet privateEventsStorage = {};\n\n\tconst CustomEvent =\n\t\twindow.CustomEvent ||\n\t\t(() => {\n\t\t\tconst _polyfill = (event, params) => {\n\t\t\t\tparams = params || { bubbles: false, cancelable: false, detail: undefined };\n\t\t\t\tconst evt = document.createEvent('CustomEvent');\n\t\t\t\tevt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n\t\t\t\treturn evt;\n\t\t\t};\n\t\t\t_polyfill.prototype = window.Event.prototype;\n\t\t\treturn _polyfill;\n\t\t})();\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @param {string} events\n\t * @returns {undefined}\n\t */\n\tconst detachEventListener = (element, events) => {\n\t\tif (!element || typeof events !== 'string') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (stringStartsWith(events, '.')) {\n\t\t\tfor (let key in privateEventsStorage) {\n\t\t\t\tconst eventNameWithNamespace = key.replace(eventNamespaceParserSeparator, '.');\n\t\t\t\tif (stringContains(eventNameWithNamespace, events) && privateEventsStorage[key].element === element) {\n\t\t\t\t\tdetachEventListener(element, eventNameWithNamespace);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tevents = events.split('.');\n\n\t\t\tconst type = events[0],\n\t\t\t\tnamespace = events[1];\n\n\t\t\tif (namespace) {\n\t\t\t\tevents = events.join(eventNamespaceParserSeparator);\n\t\t\t}\n\n\t\t\tif (events in privateEventsStorage) {\n\t\t\t\telement.removeEventListener(type, privateEventsStorage[events].handler);\n\t\t\t\tdelete privateEventsStorage[events];\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * @param {HTMLElement} element\n\t * @param {string} events\n\t * @param {Function} handler\n\t * @param {boolean} once\n\t * @returns {undefined}\n\t */\n\t// TODO: Class EventListener .on .one .off .trigger jQuery-like...\n\tconst attachEventListener = (element, events, handler, once) => {\n\t\tif (!element || typeof events !== 'string' || typeof handler !== 'function') {\n\t\t\treturn;\n\t\t}\n\n\t\tevents = events.split('.');\n\n\t\tconst type = events[0];\n\t\tconst namespace = events[1];\n\n\t\tif (namespace) {\n\t\t\tevents = events.join(eventNamespaceParserSeparator);\n\t\t}\n\n\t\tprivateEventsStorage[events] = { element: element, count: 0, once: false };\n\n\t\tif (true === once) {\n\t\t\tlet _handler = handler;\n\t\t\thandler = function(event) {\n\t\t\t\tif (events in privateEventsStorage) {\n\t\t\t\t\tprivateEventsStorage[events].count++;\n\t\t\t\t\tif (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t_handler.call(this, event);\n\t\t\t\t}\n\t\t\t\tdetachEventListener(element, events);\n\t\t\t};\n\t\t} else {\n\t\t\tonce = false;\n\t\t}\n\n\t\tprivateEventsStorage[events] = {\n\t\t\t...privateEventsStorage[events],\n\t\t\t...{ handler: handler, once: once }\n\t\t};\n\n\t\telement.addEventListener(type, privateEventsStorage[events].handler, { once: once });\n\t};\n\n\t/**\n\t * @param {Object} resource\n\t * @returns {Object}\n\t */\n\tconst decodeResource = resource => {\n\t\tlet output = { format: null, extension: null, tag: null, consistent: false };\n\n\t\tresource.resource = resource.resource.split('?')[0];\n\t\tresource.resource = resource.resource.split('#')[0];\n\t\tfor (let formatCandidate in supportedExtensions) {\n\t\t\tconst base64Heading = ';base64,';\n\n\t\t\tif (new RegExp('(.(' + supportedExtensions[formatCandidate] + ')$)|' + base64Heading, 'g').test(resource.resource)) {\n\t\t\t\tif (new RegExp(base64Heading, 'g').test(resource.resource)) {\n\t\t\t\t\tlet matches64 = resource.resource.match(new RegExp('^data:' + formatCandidate + '/(' + supportedExtensions[formatCandidate] + ')', 'g'));\n\n\t\t\t\t\tif (null === matches64) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmatches64 = matches64[0];\n\n\t\t\t\t\toutput.format = formatCandidate;\n\t\t\t\t\toutput.extension = matches64.replace('data:' + formatCandidate + '/', '');\n\t\t\t\t\toutput.tag = supportedTags[formatCandidate];\n\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tlet matches = resource.resource.match(new RegExp(supportedExtensions[formatCandidate], 'g'));\n\n\t\t\t\t\tif (matches) {\n\t\t\t\t\t\toutput.format = formatCandidate;\n\t\t\t\t\t\toutput.extension = matches[0];\n\t\t\t\t\t\toutput.tag = supportedTags[formatCandidate];\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isHTMLElement(resource.element)) {\n\t\t\tlet tagName = resource.element.tagName.toLowerCase();\n\t\t\tlet allTags = '';\n\n\t\t\tObject.values(supportedTags).forEach(tags => {\n\t\t\t\tallTags += '|' + tags;\n\t\t\t});\n\n\t\t\tallTags = allTags.split('|');\n\n\t\t\tif (isInArray(tagName, allTags)) {\n\t\t\t\toutput.tag = tagName;\n\t\t\t\toutput.consistent = true;\n\t\t\t\tif (output.format === null) {\n\t\t\t\t\tfor (let format in supportedTags) {\n\t\t\t\t\t\tif (stringContains(supportedTags[format], output.tag)) {\n\t\t\t\t\t\t\toutput.format = format;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (stringContains(output.tag, '|')) {\n\t\t\toutput.tag = output.tag.split('|')[0];\n\t\t}\n\n\t\treturn output;\n\t};\n\n\t// TODO: Promise support\n\t// TODO: think about useful vars in callback args (this class is not public but its vars are returned in .progress() callback)\n\t/** TODO: description of the MyClass constructor function.\n\t * @class\n\t * @classdesc TODO: description of the SingleLoader class.\n\t */\n\tclass SingleLoader {\n\t\t/**\n\t\t * @param {Object} [options={ srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false }]\n\t\t */\n\t\tconstructor(options) {\n\t\t\tthis._settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\t\t\t\t\tplaythrough: false,\n\t\t\t\t\tvisible: false\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tif (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n\t\t\t\tthrow new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n\t\t\t}\n\n\t\t\tthis.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n\t\t\tthis.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n\t\t\tthis._id = null;\n\t\t\tthis._idEvent = null;\n\t\t\tthis._busy = false;\n\n\t\t\tthis._element = null;\n\t\t\tthis._resource = null;\n\t\t\tthis._format = null;\n\t\t\tthis._observer = null;\n\n\t\t\tthis._done = () => {};\n\t\t\tthis._success = () => {};\n\t\t\tthis._error = () => {};\n\n\t\t\tthis._callback = e => {\n\t\t\t\tthis._busy = false;\n\t\t\t\tif (null !== this._observer) {\n\t\t\t\t\tthis._observer.unobserve(this._element);\n\t\t\t\t}\n\n\t\t\t\tconst src = this._element.currentSrc || this._element.src;\n\n\t\t\t\tif (!isInArray(src, privateCache)) {\n\t\t\t\t\tprivateCache.push(src);\n\t\t\t\t}\n\n\t\t\t\tlet thisArguments = [this._element, e.type, src, this._id];\n\n\t\t\t\tthis[e.type !== 'error' ? '_success' : '_error'].apply(this, thisArguments);\n\t\t\t\tthis._done.apply(this, thisArguments);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Object} data\n\t\t */\n\t\tset resource(data) {\n\t\t\tif (typeof data === 'object' && 'id' in data && 'element' in data && 'resource' in data) {\n\t\t\t\tthis._id = data.id;\n\t\t\t\tthis._element = data.element;\n\t\t\t\tthis._resource = data.resource;\n\n\t\t\t\tthis._busy = this._idEvent !== undefined;\n\n\t\t\t\t// TODO: FIXME: if this.busy, ottieni tutte le variabili seguenti da una cache.\n\n\t\t\t\tlet info = decodeResource({\n\t\t\t\t\tresource: this._resource,\n\t\t\t\t\telement: this._element\n\t\t\t\t});\n\t\t\t\tthis._tag = info.tag;\n\t\t\t\tthis._consistent = info.consistent; // wrong tag for resource type...\n\t\t\t\tthis._format = info.format;\n\t\t\t\tthis._exists = this._element !== null;\n\t\t\t\tthis._originalElement = this._element;\n\n\t\t\t\tif (!this._exists || !this._consistent) {\n\t\t\t\t\tthis._element = document.createElement(this._tag);\n\t\t\t\t\tthis._element.dataset[this.srcAttr] = this._resource;\n\t\t\t\t}\n\n\t\t\t\tthis._idEvent = this._busy ? this._element[pluginInstance + '_IDEvent'] : pluginName + '_unique_' + this._element.tagName + '_' + generateInstanceID();\n\n\t\t\t\t//TODO: FIXME: this._lazy = this._busy ? this._lazy : !!(this._element.dataset[this.srcAttr] || this._element.dataset[this.srcsetAttr]);\n\n\t\t\t\tif (this._exists && this._settings.visible && intersectionObserverSupported) {\n\t\t\t\t\tthis._observer = new IntersectionObserver(\n\t\t\t\t\t\t(entries, observer) => {\n\t\t\t\t\t\t\tentries.forEach(entry => (entry.target.intersectionRatio = entry.intersectionRatio));\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troot: null,\n\t\t\t\t\t\t\trootMargin: '0px',\n\t\t\t\t\t\t\tthreshold: 0.1\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tthis._observer.observe(this._originalElement);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @returns {string}\n\t\t */\n\t\tget resource() {\n\t\t\treturn this._resource;\n\t\t}\n\n\t\t/**\n\t\t * @returns {boolean} se ha preso in carico il caricamento oppure no per vari motivi (è già caricato, non è nella viewport etc)\n\t\t */\n\t\tload() {\n\t\t\t// TODO: FIXME: (3) check for placeholders / non-lazy resources\n\t\t\t// if isLoaded(this._exists && this._consistent ? this._element : this._resource) &&\n\t\t\t// (\n\t\t\t//    ( this._lazy && ( data-xyz-src === src || data-xyz-srcset === srcset ) ) // TODO: capire come\n\t\t\t//    ||\n\t\t\t//    !this._lazy\n\t\t\t// )\n\n\t\t\t//TODO: remove elseif else when returning?\n\t\t\tif (isLoaded(this._exists && this._consistent ? this._element : this._resource)) {\n\t\t\t\tif (!this._busy) {\n\t\t\t\t\t// TODO: mayabe this should be called in this._callback\n\t\t\t\t\tdetachEventListener(this._element, '.' + this._idEvent);\n\t\t\t\t}\n\n\t\t\t\tthis._callback(new CustomEvent(!isBroken(this._exists && this._consistent ? this._element : this._resource) ? 'load' : 'error'));\n\n\t\t\t\treturn false;\n\t\t\t} else if (this._exists && this._settings.visible && !isVisible(this._originalElement)) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (this._format === 'image') {\n\t\t\t\t\tattachEventListener(this._element, 'load.' + this._idEvent, this._callback, !this._busy);\n\t\t\t\t\tattachEventListener(this._element, 'error.' + this._idEvent, this._callback, !this._busy);\n\n\t\t\t\t\tconst picture = this._element.closest('picture');\n\n\t\t\t\t\tif (picture && pictureElementSupported) {\n\t\t\t\t\t\tdelete this._element.dataset[this.srcsetAttr];\n\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\n\t\t\t\t\t\tpicture.querySelectorAll('source[' + this._settings.srcsetAttr + ']').forEach(el => {\n\t\t\t\t\t\t\tel.setAttribute('srcset', el.dataset[this.srcAttr]);\n\t\t\t\t\t\t\tdelete el.dataset[this.srcAttr];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this._element.matches('[' + this._settings.srcsetAttr + ']')) {\n\t\t\t\t\t\t\tthis._element.setAttribute('srcset', this._element.dataset[this.srcsetAttr]);\n\t\t\t\t\t\t\tdelete this._element.dataset[this.srcsetAttr];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this._element.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\t\tthis._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n\t\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (this._format === 'video' || this._format === 'audio') {\n\t\t\t\t\tconst isStandardPlaythrough = true === this._settings.playthrough;\n\t\t\t\t\tconst isFullPlaythrough = 'full' === this._settings.playthrough;\n\t\t\t\t\tconst sources = this._element.querySelectorAll('source');\n\n\t\t\t\t\tlet callMediaLoad = false;\n\n\t\t\t\t\tif (sources) {\n\t\t\t\t\t\tsources.forEach(source => {\n\t\t\t\t\t\t\tif (source.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\t\t\tsource.setAttribute('src', source.dataset[this.srcAttr]);\n\t\t\t\t\t\t\t\tdelete source.dataset[this.srcsetAttr];\n\n\t\t\t\t\t\t\t\tcallMediaLoad = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\t\t\tsource,\n\t\t\t\t\t\t\t\t'error.' + this._idEvent,\n\t\t\t\t\t\t\t\te => {\n\t\t\t\t\t\t\t\t\tconst sourcesErrorId = pluginName + '_error';\n\n\t\t\t\t\t\t\t\t\tsource[pluginInstance + '_' + sourcesErrorId] = true;\n\n\t\t\t\t\t\t\t\t\tif (sources.length === nodelistToArray(sources).filter(thisSource => true === thisSource[pluginInstance + '_' + sourcesErrorId]).length) {\n\t\t\t\t\t\t\t\t\t\tthis._callback(e);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (this._element.matches('[' + this._settings.srcAttr + ']')) {\n\t\t\t\t\t\tthis._element.setAttribute('src', this._element.dataset[this.srcAttr]);\n\t\t\t\t\t\tdelete this._element.dataset[this.srcAttr];\n\n\t\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t\t'error.' + this._idEvent,\n\t\t\t\t\t\t\tthis._callback,\n\t\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tcallMediaLoad = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (callMediaLoad) {\n\t\t\t\t\t\tthis._element.load();\n\t\t\t\t\t}\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'loadedmetadata.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (!isStandardPlaythrough && !isFullPlaythrough) {\n\t\t\t\t\t\t\t\tthis._callback(new CustomEvent('load'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (isFullPlaythrough) {\n\t\t\t\t\t\t\t\tlet onProgressReplacementInterval = setInterval(() => {\n\t\t\t\t\t\t\t\t\tlet isError = this._element.readyState > 0 && !this._element.duration;\n\n\t\t\t\t\t\t\t\t\tif (isError || isFullyBuffered(this._element)) {\n\t\t\t\t\t\t\t\t\t\tthis._element.currentTime = 0;\n\n\t\t\t\t\t\t\t\t\t\tif (!isError && !this._busy && this._element.paused && this._element.matches('[autoplay]')) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.play();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tclearInterval(onProgressReplacementInterval);\n\n\t\t\t\t\t\t\t\t\t\tthis._callback(new CustomEvent(!isError ? 'load' : 'error'));\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (!this._element.paused) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.pause();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!this._busy) {\n\t\t\t\t\t\t\t\t\t\t\tthis._element.currentTime += 2;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 500);\n\n\t\t\t\t\t\t\t\tthis._element[pluginName + '_' + this._idEvent] = onProgressReplacementInterval;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'canplay.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (isFullPlaythrough && this._element.currentTime === 0 && !isFullyBuffered(this._element)) {\n\t\t\t\t\t\t\t\tthis._element.currentTime++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\n\t\t\t\t\tattachEventListener(\n\t\t\t\t\t\tthis._element,\n\t\t\t\t\t\t'canplaythrough.' + this._idEvent,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif (isStandardPlaythrough) {\n\t\t\t\t\t\t\t\tthis._callback(new CustomEvent('load'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t!this._busy // true -> once, false -> on\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!this._busy) {\n\t\t\t\t\tthis._element[pluginInstance + '_IDEvent'] = this._idEvent;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._resource = this._element.currentSrc || this._element.src;\n\n\t\t\treturn !this._busy;\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tdone(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._done = function(element, status, resource, id) {\n\t\t\t\tcallback.apply(this, [element, status, resource, id]);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tabort() {\n\t\t\tdetachEventListener(this._element, '.' + this._idEvent);\n\n\t\t\tif (isLoaded(this._exists ? this._element : this._resource)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst src = this._element.getAttribute('srcset'),\n\t\t\t\tsrcset = this._element.getAttribute('src');\n\n\t\t\tif (undefined !== src) {\n\t\t\t\tthis._element.dataset[this.srcAttr] = src;\n\t\t\t\tthis._element.setAttribute(this._settings.srcAttr, src);\n\t\t\t\tthis._element.removeAttribute('src');\n\t\t\t\tthis._element.removeAttribute('srcset');\n\t\t\t}\n\n\t\t\tif (undefined !== srcset) {\n\t\t\t\tthis._element.dataset[this.srcsetAttr] = srcset;\n\t\t\t\tthis._element.setAttribute(this._settings.srcsetAttr, srcset);\n\t\t\t\tthis._element.removeAttribute('src');\n\t\t\t\tthis._element.removeAttribute('srcset');\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: Promise support\n\t// TODO: private vars\n\t// TODO: refactory succes/done/progress code...\n\t/** TODO: description of the MyClass constructor function.\n\t * @class\n\t * @classdesc TODO: description of the Loader class.\n\t */\n\tclass Loader {\n\t\t/**\n\t\t * @param {Object} [options={srcAttr: 'data-src', srcsetAttr: 'data-srcset', playthrough: false, visible: false, backgrounds: false }]\n\t\t */\n\t\tconstructor(options) {\n\t\t\tthis._collection = [];\n\t\t\tthis._collectionLoaded = [];\n\t\t\tthis._collectionInstances = [];\n\t\t\tthis._collectionPending = [];\n\t\t\tthis._resourcesLoaded = [];\n\n\t\t\tthis._settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\t\t\t\t\tplaythrough: false,\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tbackgrounds: false\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tif (!stringStartsWith(this._settings.srcAttr, 'data-') || !stringStartsWith(this._settings.srcsetAttr, 'data-')) {\n\t\t\t\tthrow new Error('Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.');\n\t\t\t}\n\n\t\t\tthis.srcAttr = hyphensToCamelCase(this._settings.srcAttr.replace('data-', ''));\n\t\t\tthis.srcsetAttr = hyphensToCamelCase(this._settings.srcsetAttr.replace('data-', ''));\n\n\t\t\tthis.percentage = 0;\n\n\t\t\tthis._done = () => {};\n\t\t\tthis._progress = () => {};\n\t\t\tthis._success = () => {};\n\t\t\tthis._error = () => {};\n\t\t\tthis._loop = this.load;\n\n\t\t\tthis._abort = false;\n\t\t\tthis._loaded = 0;\n\t\t\tthis._complete = false;\n\t\t\tthis._busy = false;\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param {HTMLElement} [element=document.body]\n\t\t * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n\t\t */\n\t\tstatic findResources(element, options) {\n\t\t\tlet settings = {\n\t\t\t\tsrcAttr: 'src',\n\t\t\t\tsrcsetAttr: 'srcset',\n\t\t\t\tbackgrounds: false\n\t\t\t};\n\n\t\t\tif (typeof element === 'object' && undefined === options) {\n\t\t\t\tfor (let key in settings) {\n\t\t\t\t\tif (key in element) {\n\t\t\t\t\t\toptions = element;\n\t\t\t\t\t\telement = undefined;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (undefined === element || element === document) {\n\t\t\t\telement = document.body;\n\t\t\t}\n\n\t\t\tif (!isHTMLElement(element)) {\n\t\t\t\tthrow new Error('TypeError: ' + element + ' is not of type HTMLElement.');\n\t\t\t}\n\n\t\t\tlet collectedResources = [];\n\n\t\t\tsettings = {\n\t\t\t\t...settings,\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tconst targets = 'img, video, audio';\n\t\t\tconst targetsExtended = targets + ', picture, source';\n\t\t\tconst targetsFilter = '[' + settings.srcAttr + '], [' + settings.srcsetAttr + ']';\n\n\t\t\tlet targetsTags = nodelistToArray(element.querySelectorAll(targets));\n\n\t\t\tif (element.matches(targetsExtended)) {\n\t\t\t\ttargetsTags.push(element);\n\t\t\t}\n\n\t\t\ttargetsTags = targetsTags.filter(target => {\n\t\t\t\tlet children = nodelistToArray(target.children);\n\t\t\t\tchildren = children.filter(x => x.matches(targetsExtended));\n\t\t\t\tchildren = children.filter(x => x.matches(targetsFilter));\n\t\t\t\treturn target.matches(targetsFilter) || children.length;\n\t\t\t});\n\t\t\ttargetsTags.forEach(target => {\n\t\t\t\tlet targetSource = target;\n\n\t\t\t\tif (!targetSource.matches(targetsFilter)) {\n\t\t\t\t\ttargetSource = targetSource.querySelectorAll(targetsFilter);\n\t\t\t\t\ttargetSource = [...targetSource][0];\n\t\t\t\t}\n\n\t\t\t\tcollectedResources.push({\n\t\t\t\t\telement: target,\n\t\t\t\t\tresource: targetSource.getAttribute(settings.srcAttr) || targetSource.getAttribute(settings.srcsetAttr)\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (true === settings.backgrounds) {\n\t\t\t\tlet targetsBg = nodelistToArray(element.querySelectorAll('*'));\n\t\t\t\ttargetsBg.push(element);\n\t\t\t\ttargetsBg = targetsBg.filter(target => !target.matches(targetsExtended));\n\t\t\t\ttargetsBg = targetsBg.filter(target => getComputedStyle(target).backgroundImage !== 'none');\n\t\t\t\ttargetsBg.forEach(target => {\n\t\t\t\t\tconst url = getComputedStyle(target).backgroundImage.match(/\\((.*?)\\)/);\n\n\t\t\t\t\tif (null !== url && url.length >= 2) {\n\t\t\t\t\t\tcollectedResources.push({\n\t\t\t\t\t\t\telement: target,\n\t\t\t\t\t\t\tresource: url[1].replace(/('|\")/g, '')\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn collectedResources;\n\t\t}\n\n\t\t/**\n\t\t * @param {(Array.<String>|HTMLElement)} collection\n\t\t */\n\t\tset collection(collection) {\n\t\t\tlet collectedResources = collection;\n\n\t\t\ttry {\n\t\t\t\tcollectedResources = Loader.findResources(collection, this._settings);\n\t\t\t} catch (err) {}\n\n\t\t\tcollectedResources.forEach(item => {\n\t\t\t\tlet element = {\n\t\t\t\t\tresource: '',\n\t\t\t\t\telement: null,\n\t\t\t\t\tid: generateInstanceID()\n\t\t\t\t};\n\n\t\t\t\tif (typeof item === 'string') {\n\t\t\t\t\telement.resource = item;\n\t\t\t\t} else if (typeof item === 'object' && 'resource' in item) {\n\t\t\t\t\telement = { ...element, ...item };\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._collection.push(element);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * @returns {Array} collection\n\t\t */\n\t\tget collection() {\n\t\t\treturn this._collection;\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tload() {\n\t\t\tif (!this._collection.length) {\n\t\t\t\tthis._done.call(this, this._resourcesLoaded);\n\t\t\t}\n\n\t\t\t// resets pending elements (sequential opt helper array) every time we loop\n\t\t\tthis._collectionPending = [];\n\n\t\t\tconst sequentialMode = true === this._settings.sequential;\n\n\t\t\tfor (let i = 0; i < this._collection.length; i++) {\n\t\t\t\tif (this._abort) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tlet thisLoadId = this._collection[i].id;\n\t\t\t\tlet thisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n\t\t\t\tlet thisLoadInstance = new SingleLoader(this._settings);\n\n\t\t\t\tif (thisLoadIndex === -1) {\n\t\t\t\t\tthis._collectionInstances.push({\n\t\t\t\t\t\tid: thisLoadId,\n\t\t\t\t\t\tinstance: thisLoadInstance\n\t\t\t\t\t});\n\t\t\t\t\tthisLoadIndex = arrayFindIndex(this._collectionInstances, x => x.id === thisLoadId);\n\t\t\t\t} else {\n\t\t\t\t\tthis._collectionInstances[thisLoadIndex].instance = thisLoadInstance;\n\t\t\t\t}\n\n\t\t\t\tthisLoadInstance.resource = this._collection[i];\n\n\t\t\t\tthisLoadInstance.done((element, status, resource, id) => {\n\t\t\t\t\tif (this._complete || this._abort) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst aProgress = !isInArray(id, this._collectionLoaded);\n\n\t\t\t\t\tif (aProgress) {\n\t\t\t\t\t\tthis._collectionLoaded.push(id);\n\t\t\t\t\t\tthis._busy = false;\n\n\t\t\t\t\t\tthis._loaded++;\n\t\t\t\t\t\tthis.percentage = (this._loaded / this._collection.length) * 100;\n\t\t\t\t\t\tthis.percentage = parseFloat(this.percentage.toFixed(4));\n\n\t\t\t\t\t\tconst thisResource = {\n\t\t\t\t\t\t\tresource: resource,\n\t\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\t\telement: element\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis._resourcesLoaded.push(thisResource);\n\t\t\t\t\t\tthis._progress.call(this, thisResource);\n\t\t\t\t\t\tthis[status !== 'error' ? '_success' : '_error'].call(this, thisResource);\n\t\t\t\t\t\t// TODO: dispatch event on element maybe?\n\t\t\t\t\t\t// element.dispatchEvent(new CustomEvent(pluginPrefix + capitalize(status) + '.' + pluginPrefix));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._loaded === this._collection.length) {\n\t\t\t\t\t\tthis._done.call(this, this._resourcesLoaded);\n\n\t\t\t\t\t\tthis._complete = true;\n\t\t\t\t\t} else if (aProgress && sequentialMode && this._collectionPending.length) {\n\t\t\t\t\t\tthis._collectionPending = this._collectionPending.filter(x => x.id !== id);\n\n\t\t\t\t\t\tif (this._collectionPending.length) {\n\t\t\t\t\t\t\tthis._busy = this._collectionPending[0].instance.load();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!sequentialMode || (sequentialMode && !this._busy)) {\n\t\t\t\t\tthis._busy = thisLoadInstance.load();\n\t\t\t\t} else if (\n\t\t\t\t\tsequentialMode &&\n\t\t\t\t\tthis._busy &&\n\t\t\t\t\t(!this._settings.visible || !thisLoadInstance._exists || (this._settings.visible && thisLoadInstance._exists && isVisible(thisLoadInstance._originalElement)))\n\t\t\t\t) {\n\t\t\t\t\tthis._collectionPending.push({\n\t\t\t\t\t\tid: thisLoadId,\n\t\t\t\t\t\tinstance: thisLoadInstance\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tdone(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._done = function(resources) {\n\t\t\t\tcallback.call(this, resources);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tprogress(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._progress = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\tsuccess(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._success = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @param {Function} callback\n\t\t * @returns {undefined}\n\t\t */\n\t\terror(callback) {\n\t\t\tif (typeof callback !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._error = function(resource) {\n\t\t\t\tcallback.call(this, resource);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * @returns {undefined}\n\t\t */\n\t\tabort() {\n\t\t\tthis._collectionInstances.forEach(thisInstance => {\n\t\t\t\tthisInstance.instance.abort();\n\t\t\t});\n\n\t\t\tthis._abort = true;\n\t\t}\n\t}\n\n\t// TODO: think about a better and more elegant module-oriented way\n\tif (jQueryIncluded) {\n\t\tconst $ = jQuery;\n\n\t\tconst $window = $(window);\n\n\t\t$[capitalize(pluginName)] = Loader;\n\n\t\tlet methodCollection = [];\n\n\t\t$.fn[pluginMethod] = function(options) {\n\t\t\tlet originalUserOptions = options;\n\n\t\t\tif (typeof options !== 'object') {\n\t\t\t\toptions = {};\n\t\t\t}\n\n\t\t\tlet settings = {\n\t\t\t\t...{\n\t\t\t\t\tsrcAttr: 'data-src',\n\t\t\t\t\tsrcsetAttr: 'data-srcset',\n\n\t\t\t\t\tvisible: false,\n\t\t\t\t\tsequential: false,\n\n\t\t\t\t\tbackgrounds: false,\n\t\t\t\t\tplaythrough: false,\n\n\t\t\t\t\tearly: false,\n\t\t\t\t\tearlyTimeout: 0,\n\n\t\t\t\t\tonProgress: () => {},\n\t\t\t\t\tonLoad: () => {},\n\t\t\t\t\tonError: () => {},\n\n\t\t\t\t\tonComplete: () => {}\n\t\t\t\t},\n\t\t\t\t...options\n\t\t\t};\n\n\t\t\tlet callback = settings.onComplete;\n\t\t\tif ($.isFunction(originalUserOptions)) {\n\t\t\t\tcallback = originalUserOptions;\n\t\t\t}\n\n\t\t\treturn this.each(function(i) {\n\t\t\t\t// TODO: mutation observer when new children are appended\n\n\t\t\t\tconst $element = $(this);\n\t\t\t\tconst uniqueMethodPluginName = generateInstanceID() + i;\n\t\t\t\tconst thisLoadInstance = new Loader(settings);\n\n\t\t\t\tthisLoadInstance.collection = this;\n\n\t\t\t\tmethodCollection.push({\n\t\t\t\t\tid: uniqueMethodPluginName,\n\t\t\t\t\tinstance: thisLoadInstance,\n\t\t\t\t\telement: this,\n\t\t\t\t\ttimeout: null\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.progress(resource => {\n\t\t\t\t\t$(resource.element).trigger(pluginPrefix + capitalize(resource.status) + '.' + pluginPrefix, [resource.element, resource.resource]);\n\t\t\t\t\t$element.trigger(pluginPrefix + 'Progress.' + pluginPrefix, [this, resource]);\n\n\t\t\t\t\tconst thisArguments = [thisLoadInstance, resource];\n\n\t\t\t\t\tif (typeof settings.onProgress === 'function') {\n\t\t\t\t\t\tsettings.onProgress.apply(this, thisArguments);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet eventName = capitalize(resource.status);\n\t\t\t\t\tif (typeof settings['on' + eventName] === 'function') {\n\t\t\t\t\t\tsettings['on' + eventName].apply(this, thisArguments);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.done(resources => {\n\t\t\t\t\t$element.trigger(pluginPrefix + 'Complete.' + pluginPrefix, [this, resources]);\n\t\t\t\t\tcallback.apply(this, [thisLoadInstance, resources]);\n\n\t\t\t\t\tif (settings.visible) {\n\t\t\t\t\t\t$window.off('scroll.' + uniqueMethodPluginName);\n\t\t\t\t\t}\n\n\t\t\t\t\t// refresh other method calls for same el (omitting this one)\n\t\t\t\t\tmethodCollection = methodCollection.filter(x => x.id !== uniqueMethodPluginName);\n\t\t\t\t\tmethodCollection.forEach(thisMethodCollection => {\n\t\t\t\t\t\tif ($element.is(thisMethodCollection.element)) {\n\t\t\t\t\t\t\tthisMethodCollection.instance.load();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthisLoadInstance.load();\n\n\t\t\t\tif (settings.visible) {\n\t\t\t\t\t$window.on('scroll.' + uniqueMethodPluginName, throttle(() => thisLoadInstance.load(), 250));\n\t\t\t\t}\n\n\t\t\t\tif (true === settings.early) {\n\t\t\t\t\tlet breakLoop = false;\n\n\t\t\t\t\tmethodCollection.forEach(thisMethodCollection => {\n\t\t\t\t\t\tif (breakLoop) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (methodCollection[key].id === uniqueMethodPluginName) {\n\t\t\t\t\t\t\tclearTimeout(thisMethodCollection.timeout);\n\n\t\t\t\t\t\t\tlet timeout = parseInt(settings.earlyTimeout);\n\n\t\t\t\t\t\t\tthisMethodCollection.timeout = setTimeout(() => {\n\t\t\t\t\t\t\t\t// TODO: $('.selector').niteLoad('option', 'value');\n\t\t\t\t\t\t\t\tthisMethodCollection.instance._settings.visible = false;\n\t\t\t\t\t\t\t\tthisMethodCollection.instance._settings.sequential = true;\n\n\t\t\t\t\t\t\t\tthisMethodCollection.instance.load();\n\t\t\t\t\t\t\t}, !isNaN(timeout) && isFinite(timeout) ? timeout : 0);\n\n\t\t\t\t\t\t\tbreakLoop = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t}\n\n\treturn Loader;\n\n})));\n"]}