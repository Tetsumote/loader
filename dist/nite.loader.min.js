"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("niteLoader",e):t.niteLoader=e()}(this,function(){var t,e=function(){return Math.floor(8999*Math.random())+1e3},n=function(t,e){return String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0)},i=function(t,e){return String.prototype.startsWith?t.startsWith(e):t.substr(0,e.length)===e},r=function(t,e){return Array.prototype.findIndex?t.findIndex(e):function(){for(var n=t.length,i=-1;++i<n;)if(e(t[i],i,t))return i;return-1}()},s=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},o=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},c=function(t){return[].concat(_toConsumableArray(t))},a=function(t,e){return e.indexOf(t)>-1},l=[],u="IntersectionObserver"in window,h="HTMLPictureElement"in window,_="jQuery"in window,d=function(t){if(u&&"intersectionRatio"in t)return t.intersectionRatio>0;if("none"===window.getComputedStyle(t,"display"))return!1;var e=document.getElementsByTagName("body")[0],n=window.innerWidth||documnt.documentElement.clientWidth||e.clientWidth,i=window.innerHeight||documnt.documentElement.clientHeight||e.clientHeight,r=t.getBoundingClientRect();return!(r.right<0||r.bottom<0||r.left>n||r.top>i)},f=function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))return!1;try{return t instanceof HTMLElement}catch(e){return 1===t.nodeType&&"object"===_typeof(t.style)&&"object"===_typeof(t.ownerDocument)}},m=function(t){return"string"==typeof t&&a(t,l)||f(t)&&"currentSrc"in t&&t.currentSrc.length>0&&("complete"in t&&t.complete||"readyState"in t&&t.readyState>=2)},g=function(t){return t.buffered.length&&Math.round(t.buffered.end(0))/Math.round(t.seekable.end(0))==1},p=e(),v={image:"jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg",audio:"mp3|ogg|oga|spx|ogg|wav",video:"mp4|ogv|webm"},y={image:"img|picture|source",audio:"audio|source",video:"video|source"},b={},A=window.CustomEvent||((t=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}).prototype=window.Event.prototype,t),E=function t(e,r){if(e&&"string"==typeof r)if(i(r,"."))for(var s in b){var o=s.replace("__namespace__",".");n(o,r)&&b[s].element===e&&t(e,o)}else{var c=(r=r.split("."))[0];r[1]&&(r=r.join("__namespace__")),r in b&&(e.removeEventListener(c,b[r].handler),delete b[r])}},w=function(t,e,n,i){if(t&&"string"==typeof e&&"function"==typeof n){var r=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),b[e]={element:t,count:0,once:!1},!0===i){var s=n;n=function(n){if(e in b){if(b[e].count++,b[e].once&&b[e].count>1)return;s.call(this,n)}E(t,e)}}else i=!1;b[e]=_extends({},b[e],{handler:n,once:i}),t.addEventListener(r,b[e].handler,{once:i})}},k=function(){function t(e){var n=this;if(_classCallCheck(this,t),this._settings=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1},e),!i(this._settings.srcAttr,"data-")||!i(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=s(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=s(this._settings.srcsetAttr.replace("data-","")),this._id=null,this._idEvent=null,this._busy=!1,this._element=null,this._resource=null,this._format=null,this._observer=null,this._done=function(){},this._success=function(){},this._error=function(){},this._callback=function(t){n._busy=!1,null!==n._observer&&n._observer.unobserve(n._element);var e=n._element.currentSrc||n._element.src;a(e,l)||l.push(e);var i=[n._element,t.type,e,n._id];n["error"!==t.type?"_success":"_error"].apply(n,i),n._done.apply(n,i)}}return _createClass(t,[{key:"load",value:function(){var t,e=this;if(m(this._exists&&this._consistent?this._element:this._resource))return this._busy||E(this._element,"."+this._idEvent),this._callback(new A((t=this._exists&&this._consistent?this._element:this._resource,m(t)&&(f(t)&&("naturalWidth"in t&&0===Math.floor(t.naturalWidth)||"videoWidth"in t&&0===t.videoWidth)||"string"==typeof t)?"error":"load"))),!1;if(this._exists&&this._settings.visible&&!d(this._originalElement))return!1;if("image"===this._format){w(this._element,"load."+this._idEvent,this._callback,!this._busy),w(this._element,"error."+this._idEvent,this._callback,!this._busy);var n=this._element.closest("picture");n&&h?(delete this._element.dataset[this.srcsetAttr],delete this._element.dataset[this.srcAttr],n.querySelectorAll("source["+this._settings.srcsetAttr+"]").forEach(function(t){t.setAttribute("srcset",t.dataset[e.srcAttr]),delete t.dataset[e.srcAttr]})):(this._element.matches("["+this._settings.srcsetAttr+"]")&&(this._element.setAttribute("srcset",this._element.dataset[this.srcsetAttr]),delete this._element.dataset[this.srcsetAttr]),this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr]))}else{if("video"!==this._format&&"audio"!==this._format)return!1;var i=!0===this._settings.playthrough,r="full"===this._settings.playthrough,s=this._element.querySelectorAll("source"),o=!1;s?s.forEach(function(t){t.matches("["+e._settings.srcAttr+"]")&&(t.setAttribute("src",t.dataset[e.srcAttr]),delete t.dataset[e.srcsetAttr],o=!0),w(t,"error."+e._idEvent,function(n){t[p+"_niteLoader_error"]=!0,s.length===c(s).filter(function(t){return!0===t[p+"_niteLoader_error"]}).length&&e._callback(n)},!e._busy)}):this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr],w(this._element,"error."+this._idEvent,this._callback,!this._busy),o=!0),o&&this._element.load(),w(this._element,"loadedmetadata."+this._idEvent,function(){if(i||r||e._callback(new A("load")),r){var t=setInterval(function(){var n=e._element.readyState>0&&!e._element.duration;n||g(e._element)?(e._element.currentTime=0,!n&&!e._busy&&e._element.paused&&e._element.matches("[autoplay]")&&e._element.play(),clearInterval(t),e._callback(new A(n?"error":"load"))):(e._element.paused||e._element.pause(),e._busy||(e._element.currentTime+=2))},500);e._element["niteLoader_"+e._idEvent]=t}},!this._busy),w(this._element,"canplay."+this._idEvent,function(){r&&0===e._element.currentTime&&!g(e._element)&&e._element.currentTime++},!this._busy),w(this._element,"canplaythrough."+this._idEvent,function(){i&&e._callback(new A("load"))},!this._busy)}return this._busy||(this._element[p+"_IDEvent"]=this._idEvent),this._resource=this._element.currentSrc||this._element.src,!this._busy}},{key:"done",value:function(t){"function"==typeof t&&(this._done=function(e,n,i,r){t.apply(this,[e,n,i,r])})}},{key:"abort",value:function(){if(E(this._element,"."+this._idEvent),!m(this._exists?this._element:this._resource)){var t=this._element.getAttribute("srcset"),e=this._element.getAttribute("src");void 0!==t&&(this._element.dataset[this.srcAttr]=t,this._element.setAttribute(this._settings.srcAttr,t),this._element.removeAttribute("src"),this._element.removeAttribute("srcset")),void 0!==e&&(this._element.dataset[this.srcsetAttr]=e,this._element.setAttribute(this._settings.srcsetAttr,e),this._element.removeAttribute("src"),this._element.removeAttribute("srcset"))}}},{key:"resource",set:function(t){if("object"===(void 0===t?"undefined":_typeof(t))&&"id"in t&&"element"in t&&"resource"in t){this._id=t.id,this._element=t.element,this._resource=t.resource,this._busy=void 0!==this._idEvent;var i=function(t){var e={format:null,extension:null,tag:null,consistent:!1};for(var i in t.resource=t.resource.split("?")[0],t.resource=t.resource.split("#")[0],v)if(new RegExp("(.("+v[i]+")$)|;base64,","g").test(t.resource)){if(new RegExp(";base64,","g").test(t.resource)){var r=t.resource.match(new RegExp("^data:"+i+"/("+v[i]+")","g"));if(null===r)return;r=r[0],e.format=i,e.extension=r.replace("data:"+i+"/",""),e.tag=y[i];break}var s=t.resource.match(new RegExp(v[i],"g"));if(s){e.format=i,e.extension=s[0],e.tag=y[i];break}}if(f(t.element)){var o=t.element.tagName.toLowerCase(),c="";if(Object.values(y).forEach(function(t){c+="|"+t}),c=c.split("|"),a(o,c)&&(e.tag=o,e.consistent=!0,null===e.format))for(var l in y)if(n(y[l],e.tag)){e.format=l;break}}return n(e.tag,"|")&&(e.tag=e.tag.split("|")[0]),e}({resource:this._resource,element:this._element});this._tag=i.tag,this._consistent=i.consistent,this._format=i.format,this._exists=null!==this._element,this._originalElement=this._element,this._exists&&this._consistent||(this._element=document.createElement(this._tag),this._element.dataset[this.srcAttr]=this._resource),this._idEvent=this._busy?this._element[p+"_IDEvent"]:"niteLoader_unique_"+this._element.tagName+"_"+e(),this._exists&&this._settings.visible&&u&&(this._observer=new IntersectionObserver(function(t,e){t.forEach(function(t){return t.target.intersectionRatio=t.intersectionRatio})},{root:null,rootMargin:"0px",threshold:.1}),this._observer.observe(this._originalElement))}},get:function(){return this._resource}}]),t}(),x=function(){function t(e){if(_classCallCheck(this,t),this._collection=[],this._collectionLoaded=[],this._collectionInstances=[],this._collectionPending=[],this._resourcesLoaded=[],this._settings=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1,backgrounds:!1},e),!i(this._settings.srcAttr,"data-")||!i(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=s(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=s(this._settings.srcsetAttr.replace("data-","")),this.percentage=0,this._done=function(){},this._progress=function(){},this._success=function(){},this._error=function(){},this._loop=this.load,this._abort=!1,this._loaded=0,this._complete=!1,this._busy=!1}return _createClass(t,[{key:"load",value:function(){var t=this;this._collection.length||this._done.call(this,this._resourcesLoaded),this._collectionPending=[];for(var e=!0===this._settings.sequential,n=function(n){if(t._abort)return"break";var i=t._collection[n].id,s=r(t._collectionInstances,function(t){return t.id===i}),o=new k(t._settings);-1===s?(t._collectionInstances.push({id:i,instance:o}),s=r(t._collectionInstances,function(t){return t.id===i})):t._collectionInstances[s].instance=o,o.resource=t._collection[n],o.done(function(n,i,r,s){if(!t._complete&&!t._abort){var o=!a(s,t._collectionLoaded);if(o){t._collectionLoaded.push(s),t._busy=!1,t._loaded++,t.percentage=t._loaded/t._collection.length*100,t.percentage=parseFloat(t.percentage.toFixed(4));var c={resource:r,status:i,element:n};t._resourcesLoaded.push(c),t._progress.call(t,c),t["error"!==i?"_success":"_error"].call(t,c)}t._loaded===t._collection.length?(t._done.call(t,t._resourcesLoaded),t._complete=!0):o&&e&&t._collectionPending.length&&(t._collectionPending=t._collectionPending.filter(function(t){return t.id!==s}),t._collectionPending.length&&(t._busy=t._collectionPending[0].instance.load()))}}),!e||e&&!t._busy?t._busy=o.load():e&&t._busy&&(!t._settings.visible||!o._exists||t._settings.visible&&o._exists&&d(o._originalElement))&&t._collectionPending.push({id:i,instance:o})},i=0;i<this._collection.length;i++){if("break"===n(i))break}}},{key:"done",value:function(t){"function"==typeof t&&(this._done=function(e){t.call(this,e)})}},{key:"progress",value:function(t){"function"==typeof t&&(this._progress=function(e){t.call(this,e)})}},{key:"success",value:function(t){"function"==typeof t&&(this._success=function(e){t.call(this,e)})}},{key:"error",value:function(t){"function"==typeof t&&(this._error=function(e){t.call(this,e)})}},{key:"abort",value:function(){this._collectionInstances.forEach(function(t){t.instance.abort()}),this._abort=!0}},{key:"collection",set:function(n){var i=this,r=n;try{r=t.findResources(n,this._settings)}catch(t){}r.forEach(function(t){var n={resource:"",element:null,id:e()};if("string"==typeof t)n.resource=t;else{if(!("object"===(void 0===t?"undefined":_typeof(t))&&"resource"in t))return;n=_extends({},n,t)}i._collection.push(n)})},get:function(){return this._collection}}],[{key:"findResources",value:function(t,e){var n={srcAttr:"src",srcsetAttr:"srcset",backgrounds:!1};if("object"===(void 0===t?"undefined":_typeof(t))&&void 0===e)for(var i in n)if(i in t){e=t,t=void 0;break}if(void 0!==t&&t!==document||(t=document.body),!f(t))throw new Error("TypeError: "+t+" is not of type HTMLElement.");var r=[];n=_extends({},n,e);var s="img, video, audio, picture, source",o="["+n.srcAttr+"], ["+n.srcsetAttr+"]",a=c(t.querySelectorAll("img, video, audio"));if(t.matches(s)&&a.push(t),(a=a.filter(function(t){var e=c(t.children);return e=(e=e.filter(function(t){return t.matches(s)})).filter(function(t){return t.matches(o)}),t.matches(o)||e.length})).forEach(function(t){var e=t;e.matches(o)||(e=e.querySelectorAll(o),e=[].concat(_toConsumableArray(e))[0]),r.push({element:t,resource:e.getAttribute(n.srcAttr)||e.getAttribute(n.srcsetAttr)})}),!0===n.backgrounds){var l=c(t.querySelectorAll("*"));l.push(t),(l=(l=l.filter(function(t){return!t.matches(s)})).filter(function(t){return"none"!==getComputedStyle(t).backgroundImage})).forEach(function(t){var e=getComputedStyle(t).backgroundImage.match(/\((.*?)\)/);null!==e&&e.length>=2&&r.push({element:t,resource:e[1].replace(/('|")/g,"")})})}return r}}]),t}();if(_){var C=jQuery,L=C(window);C[o("niteLoader")]=x;var S=[];C.fn.niteLoad=function(t){var n=t;"object"!==(void 0===t?"undefined":_typeof(t))&&(t={});var i=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",visible:!1,sequential:!1,backgrounds:!1,playthrough:!1,early:!1,earlyTimeout:0,onProgress:function(){},onLoad:function(){},onError:function(){},onComplete:function(){}},t),r=i.onComplete;return C.isFunction(n)&&(r=n),this.each(function(t){var n=this,s=C(this),c=e()+t,a=new x(i);if(a.collection=this,S.push({id:c,instance:a,element:this,timeout:null}),a.progress(function(t){C(t.element).trigger("nite"+o(t.status)+".nite",[t.element,t.resource]),s.trigger("niteProgress.nite",[n,t]);var e=[a,t];"function"==typeof i.onProgress&&i.onProgress.apply(n,e);var r=o(t.status);"function"==typeof i["on"+r]&&i["on"+r].apply(n,e)}),a.done(function(t){s.trigger("niteComplete.nite",[n,t]),r.apply(n,[a,t]),i.visible&&L.off("scroll."+c),(S=S.filter(function(t){return t.id!==c})).forEach(function(t){s.is(t.element)&&t.instance.load()})}),a.load(),i.visible&&L.on("scroll."+c,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=null,r=null,s=function(){t.apply(n,r),i=null};return function(){i||(r=arguments,i=setTimeout(s,e))}}(function(){return a.load()},250)),!0===i.early){var l=!1;S.forEach(function(t){if(!l&&S[key].id===c){clearTimeout(t.timeout);var e=parseInt(i.earlyTimeout);t.timeout=setTimeout(function(){t.instance._settings.visible=!1,t.instance._settings.sequential=!0,t.instance.load()},!isNaN(e)&&isFinite(e)?e:0),l=!0}})}})}}return x});
//# sourceMappingURL=nite.loader.min.js.map
