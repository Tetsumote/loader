!function(t,e,s,i){"use strict";const r=()=>Math.floor(8999*Math.random())+1e3,n="niteLoader",o=r(),c=t.CustomEvent||(()=>{const s=(t,s)=>{s=s||{bubbles:!1,cancelable:!1,detail:i};const r=e.createEvent("CustomEvent");return r.initCustomEvent(t,s.bubbles,s.cancelable,s.detail),r};return s.prototype=t.Event.prototype,s})(),l=(t,e)=>String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0),h=(t,e)=>String.prototype.startsWith?t.startsWith(e):t.substr(0,e.length)===e,a=(t,e)=>Array.prototype.findIndex?t.findIndex(e):(()=>{let s=t.length,i=-1;for(;++i<s;)if(e(t[i],i,t))return i;return-1})(),_=(t,e)=>{if(t&&"string"==typeof e)if(h(e,"."))Object.keys(E).forEach(s=>{const i=s.replace("__namespace__",".");l(i,e)&&E[s].element===t&&_(t,i)});else{const s=(e=e.split("."))[0];e[1]&&(e=e.join("__namespace__")),e in E&&(t.removeEventListener(s,E[e].handler),delete E[e])}},u=(t,e,s,i)=>{if(!t||"string"!=typeof e||"function"!=typeof s)return;const r=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),E[e]={element:t,count:0,once:!1},!0===i){let i=s;s=function(s){if(e in E){if(E[e].count++,E[e].once&&E[e].count>1)return;i.call(this,s)}_(t,e)}}else i=!1;E[e]={...E[e],...{handler:s,once:i}},t.addEventListener(r,E[e].handler,{once:i})},d=t=>t.replace(/-([a-z])/g,t=>t[1].toUpperCase()),g=t=>t.charAt(0).toUpperCase()+t.slice(1),m=t=>[...t],p=(t,e)=>e.indexOf(t)>-1,f=s=>{if("IntersectionObserver"in t&&"intersectionRatio"in s)return s.intersectionRatio>0;if("none"===t.getComputedStyle(s,"display"))return!1;const i=e.getElementsByTagName("body")[0],r=t.innerWidth||documnt.documentElement.clientWidth||i.clientWidth,n=t.innerHeight||documnt.documentElement.clientHeight||i.clientHeight,o=s.getBoundingClientRect();return!(o.right<0||o.bottom<0||o.left>r||o.top>n)},b=t=>{if("object"!=typeof t)return!1;try{return t instanceof HTMLElement}catch(e){return 1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},A=t=>"string"==typeof t&&p(t,x)||b(t)&&"currentSrc"in t&&t.currentSrc.length>0&&("complete"in t&&t.complete||"readyState"in t&&t.readyState>=2),y=t=>A(t)&&(b(t)&&("naturalWidth"in t&&0===Math.floor(t.naturalWidth)||"videoWidth"in t&&0===t.videoWidth)||"string"==typeof t),v=t=>{const e={image:"jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg",audio:"mp3|ogg|oga|spx|ogg|wav",video:"mp4|ogv|webm"},s={image:"img|picture|source",audio:"audio|source",video:"video|source"};let i={format:null,extension:null,tag:null,exists:!1},r=!1;if(t.resource=t.resource.split("?")[0],t.resource=t.resource.split("#")[0],Object.keys(e).forEach(n=>{if(!r&&new RegExp("(.("+e[n]+")$)|;base64,","g").test(t.resource))if(new RegExp(";base64,","g").test(t.resource)){let o=t.resource.match(new RegExp("^data:"+n+"/("+e[n]+")","g"));if(null===o)return;o=o[0],i.format=n,i.extension=o.replace("data:"+n+"/",""),i.tag=s[n],r=!0}else{let o=t.resource.match(new RegExp(e[n],"g"));o&&(i.format=n,i.extension=o[0],i.tag=s[n],r=!0)}}),b(t.element)){let e=t.element.tagName.toLowerCase(),r="";Object.values(s).forEach(t=>{r+="|"+t}),r=r.split("|"),p(e,r)&&(i.tag=e,i.exists=!0,null===i.format&&Object.keys(s).forEach(t=>{l(s[t],i.tag)&&(i.format=t)}))}return l(i.tag,"|")&&(i.tag=i.tag.split("|")[0]),i};let E={},x=[];class j{constructor(t){this._settings={...{srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1},...t},this.srcAttr="",this.srcsetAttr="",h(this._settings.srcAttr,"data-")?this.srcAttr=this._settings.srcAttr.replace("data-",""):(this.srcAttr=this._settings.srcAttr,this._settings.srcAttr="data-"+this._settings.srcAttr),h(this._settings.srcsetAttr,"data-")?this.srcsetAttr=this._settings.srcsetAttr.replace("data-",""):(this.srcsetAttr=this._settings.srcsetAttr,this._settings.srcsetAttr="data-"+this._settings.srcsetAttr),this.srcAttr=d(this.srcAttr),this.srcsetAttr=d(this.srcsetAttr),this._id=null,this._idEvent=null,this._busy=!1,this._element=null,this._resource=null,this._format=null,this._observer=null,this._done=(()=>{}),this._success=(()=>{}),this._error=(()=>{}),this._callback=(t=>{this._busy=!1,null!==this._observer&&this._observer.unobserve(this._element);const e=this._element.currentSrc||this._element.src;p(e,x)||x.push(e);let s=[this._element,t.type,e,this._id];this["error"!==t.type?"_success":"_error"].apply(this,s),this._done.apply(this,s)})}set resource(s){if("object"==typeof s&&"id"in s&&"element"in s&&"resource"in s){this._id=s.id,this._element=s.element,this._resource=s.resource;let c=v({resource:this._resource,element:this._element});this._tag=c.tag,this._exists=c.exists,this._format=c.format,this._exists?this._settings.visible&&"IntersectionObserver"in t&&(this._observer=new IntersectionObserver((t,e)=>{t.forEach(t=>t.target.intersectionRatio=t.intersectionRatio)},{root:null,rootMargin:"0px",threshold:.1}),this._observer.observe(this._element)):(this._element=e.createElement(this._tag),this._element.dataset[this.srcAttr]=this._resource),this._idEvent=this._element[o+"_IDEvent"],this._busy=this._idEvent!==i,this._idEvent=this._busy?this._idEvent:n+"_unique_"+this._element.tagName+"_"+r()}}get resource(){return this._resource}load(){if(A(this._exists?this._element:this._resource))return this._busy||_(this._element,"."+this._idEvent),this._callback(new c(y(this._exists?this._element:this._resource)?"error":"load")),!1;if(this._exists&&this._settings.visible&&!f(this._element))return!1;if("image"===this._format){u(this._element,"load."+this._idEvent,this._callback,!this._busy),u(this._element,"error."+this._idEvent,this._callback,!this._busy);const e=this._element.closest("picture");e&&"HTMLPictureElement"in t?(delete this._element.dataset[this.srcsetAttr],delete this._element.dataset[this.srcAttr],e.querySelectorAll("source["+this._settings.srcsetAttr+"]").forEach(t=>{t.setAttribute("srcset",t.dataset[this.srcAttr]),delete t.dataset[this.srcAttr]})):(this._element.matches("["+this._settings.srcsetAttr+"]")&&(this._element.setAttribute("srcset",this._element.dataset[this.srcsetAttr]),delete this._element.dataset[this.srcsetAttr]),this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr]))}else{if("video"!==this._format&&"audio"!==this._format)return!1;{const t=!0===this._settings.playthrough,e="full"===this._settings.playthrough,s=this._element.querySelectorAll("source"),i=function(t){return t.buffered.length&&Math.round(t.buffered.end(0))/Math.round(t.seekable.end(0))==1};let r=!1;s?s.forEach(t=>{t.matches("["+this._settings.srcAttr+"]")&&(t.setAttribute("src",t.dataset[this.srcAttr]),delete t.dataset[this.srcsetAttr],r=!0),u(t,"error."+this._idEvent,e=>{const i=n+"_error";t[o+"_"+i]=!0,s.length===m(s).filter(t=>!0===t[o+"_"+i]).length&&this._callback(e)},!this._busy)}):this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr],u(this._element,"error."+this._idEvent,this._callback,!this._busy),r=!0),r&&this._element.load(),u(this._element,"loadedmetadata."+this._idEvent,()=>{if(t||e||this._callback(new c("load")),e){let t=setInterval(()=>{let e=this._element.readyState>0&&!this._element.duration;e||i(this._element)?(this._element.currentTime=0,!e&&!this._busy&&this._element.paused&&this._element.matches("[autoplay]")&&this._element.play(),clearInterval(t),this._callback(new c(e?"error":"load"))):(this._element.paused||this._element.pause(),this._busy||(this._element.currentTime+=2))},500);this._element[n+"_"+this._idEvent]=t}},!this._busy),u(this._element,"canplay."+this._idEvent,()=>{e&&0===this._element.currentTime&&!i(this._element)&&this._element.currentTime++},!this._busy),u(this._element,"canplaythrough."+this._idEvent,()=>{t&&this._callback(new c("load"))},!this._busy)}}return this._busy||(this._element[o+"_IDEvent"]=this._idEvent),this._resource=this._element.currentSrc||this._element.src,!this._busy}done(t){"function"==typeof t&&(this._done=function(e,s,i,r){t.apply(this,[e,s,i,r])})}abort(){if(_(this._element,"."+this._idEvent),A(this._exists?this._element:this._resource))return;const t=this._element.getAttribute("srcset"),e=this._element.getAttribute("src");i!==t&&(this._element.dataset[this.srcAttr]=t,this._element.setAttribute(this._settings.srcAttr,t),this._element.removeAttribute("src"),this._element.removeAttribute("srcset")),i!==e&&(this._element.dataset[this.srcsetAttr]=e,this._element.setAttribute(this._settings.srcsetAttr,e),this._element.removeAttribute("src"),this._element.removeAttribute("srcset"))}}class k{constructor(t){this._collection=[],this._collectionLoaded=[],this._collectionInstances=[],this._collectionPending=[],this._resourcesLoaded=[],this._settings={...{srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1,backgrounds:!1,attributes:[]},...t},this.srcAttr="",this.srcsetAttr="",h(this._settings.srcAttr,"data-")?this.srcAttr=this._settings.srcAttr.replace("data-",""):(this.srcAttr=this._settings.srcAttr,this._settings.srcAttr="data-"+this._settings.srcAttr),h(this._settings.srcsetAttr,"data-")?this.srcsetAttr=this._settings.srcsetAttr.replace("data-",""):(this.srcsetAttr=this._settings.srcsetAttr,this._settings.srcsetAttr="data-"+this._settings.srcsetAttr),"string"==typeof this._settings.attributes&&(this._settings.attributes=this._settings.attributes.split(this._settings.attributes.contains(",")?",":" ")),Array.isArray(this._settings.attributes)||(this._settings.attributes=[]),this.srcAttr=d(this.srcAttr),this.srcsetAttr=d(this.srcsetAttr),this.percentage=0,this._done=(()=>{}),this._progress=(()=>{}),this._success=(()=>{}),this._error=(()=>{}),this._loop=this.load,this._abort=!1,this._loaded=0,this._complete=!1,this._busy=!1}set collection(t){Array.isArray(t)||(t=[]),t.forEach(t=>{let e={resource:"",element:null,id:r()};if("string"==typeof t)e.resource=t;else{if(!("object"==typeof t&&"resource"in t))return;e={...e,...t}}this._collection.push(e)})}get collection(){return this._collection}collect(t){const e="img, video, audio, picture, source",s="["+this._settings.srcAttr+"], ["+this._settings.srcsetAttr+"]";let i=[],r=m(t.querySelectorAll("img, video, audio"));if(t.matches(e)&&r.push(t),(r=r.filter(t=>{let i=m(t.children);return i=(i=i.filter(t=>t.matches(e))).filter(t=>t.matches(s)),t.matches(s)||i.length})).forEach(t=>{let e=t;e.matches(s)||(e=[...e=e.querySelectorAll(s)][0]),i.push({element:t,resource:e.getAttribute(this._settings.srcAttr)||e.getAttribute(this._settings.srcsetAttr)})}),!0===this._settings.backgrounds){let s=m(t.querySelectorAll("*"));s.push(t),(s=(s=s.filter(t=>!t.matches(e))).filter(t=>"none"!==getComputedStyle(t).backgroundImage)).forEach(t=>{const e=getComputedStyle(t).backgroundImage.match(/\((.*?)\)/);if(null===e||e.length<2)return!0;i.push({element:t,resource:e[1].replace(/('|")/g,"")})})}if(this._settings.attributes.length)for(const s in this._settings.attributes)this._settings.attributes.hasOwnProperty(s)&&(m(t.querySelectorAll("["+s+"]:not("+e+")")).forEach(t=>{i.push({element:t,resource:t.getAttribute(s)})}),t.matches("["+s+"]")&&!t.matches(e)&&i.push({element:t,resource:t.getAttribute(s)}));this.collection=i}load(){this._collectionPending=[];const t=!0===this._settings.sequential;for(let e=0;e<this._collection.length&&!this._abort;e++){let s=this._collection[e].id,i=a(this._collectionInstances,t=>t.id===s),r=new j(this._settings);-1===i?(this._collectionInstances.push({id:s,instance:r}),i=a(this._collectionInstances,t=>t.id===s)):this._collectionInstances[i].instance=r,r.resource=this._collection[e],r.done((e,s,i,r)=>{if(this._complete||this._abort)return;const n=!p(r,this._collectionLoaded);if(n){this._collectionLoaded.push(r),this._busy=!1,this._loaded++,this.percentage=this._loaded/this._collection.length*100,this.percentage=parseFloat(this.percentage.toFixed(4));const t={resource:i,status:s,element:e};this._resourcesLoaded.push(t),this._progress.call(this,t),this["error"!==s?"_success":"_error"].call(this,t)}this._loaded===this._collection.length?(this._done.call(this,this._resourcesLoaded),this._complete=!0):n&&t&&this._collectionPending.length&&(this._collectionPending=this._collectionPending.filter(t=>t.id!==r),this._collectionPending.length&&(this._busy=this._collectionPending[0].instance.load()))}),!t||t&&!this._busy?this._busy=r.load():t&&this._busy&&(!this._settings.visible||!r._exists||this._settings.visible&&r._exists&&f(r._element))&&this._collectionPending.push({id:s,instance:r})}}done(t){if("function"!=typeof t)return;const e=function(e){t.call(this,e)};this._collection.length?this._done=e:e()}progress(t){if("function"!=typeof t)return;const e=function(e){t.call(this,e)};this._collection.length&&(this._progress=e)}success(t){if("function"!=typeof t)return;const e=function(e){t.call(this,e)};this._collection.length&&(this._success=e)}error(t){if("function"!=typeof t)return;const e=function(e){t.call(this,e)};this._collection.length&&(this._error=e)}abort(){for(const t in this._collectionInstances)this._collectionInstances[t].instance.abort();this._collection.length&&(this._abort=!0)}}if("function"==typeof define&&define.amd?define(g(n),k):"object"==typeof exports?module.exports[g(n)]=k:t[g(n)]=k,!s)return i;s[g(n)]=k;s(e);const w=s(t),I=(t,e,s=this)=>{let i=null,r=null;const n=()=>{t.apply(s,r),i=null};return function(){i||(r=arguments,i=setTimeout(n,e))}};let S=[];s.fn.niteLoad=function(t){let e=t;"object"!=typeof t&&(t={});let i={...{srcAttr:"data-src",srcsetAttr:"data-srcset",visible:!1,sequential:!1,backgrounds:!1,extraAttrs:[],playthrough:!1,early:!1,earlyTimeout:0,onProgress:()=>{},onLoad:()=>{},onError:()=>{},onComplete:()=>{}},...t},n=i.onComplete;return s.isFunction(e)&&(n=e),this.each(function(t){const e=s(this),o=r()+t,c=new k(i);if(c.collect(this),S.push({id:o,instance:c,element:this,timeout:null}),c.progress(t=>{s(t.element).trigger("nite"+g(t.status)+".nite",[t.element,t.resource]),e.trigger("niteProgress.nite",[this,t]);const r=[c,t];"function"==typeof i.onProgress&&i.onProgress.apply(this,r);let n=g(t.status);"function"==typeof i["on"+n]&&i["on"+n].apply(this,r)}),c.done(t=>{e.trigger("niteComplete.nite",[this,t]),n.apply(this,[c,t]),i.visible&&w.off("scroll."+o),(S=S.filter(t=>t.id!==o)).forEach(t=>{e.is(t.element)&&t.instance.load()})}),c.load(),i.visible&&w.on("scroll."+o,I(()=>c.load(),250)),!0===i.early){let t=!1;S.forEach(e=>{if(!t&&S[key].id===o){clearTimeout(e.timeout);let s=parseInt(i.earlyTimeout);e.timeout=setTimeout(()=>{e.instance._settings.visible=!1,e.instance._settings.sequential=!0,e.instance.load()},!isNaN(s)&&isFinite(s)?s:0),t=!0}})}})}}(window,document,jQuery);
//# sourceMappingURL=nite.loader.min.js.map
