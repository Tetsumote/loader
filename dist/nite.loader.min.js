"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}!function(){var t,e=function(){return Math.floor(8999*Math.random())+1e3},n=e(),i=window.CustomEvent||((t=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}).prototype=window.Event.prototype,t),r={image:"jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg",audio:"mp3|ogg|oga|spx|ogg|wav",video:"mp4|ogv|webm"},s={image:"img|picture|source",audio:"audio|source",video:"video|source"},o="IntersectionObserver"in window,c="HTMLPictureElement"in window,a=function(t,e){return String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0)},l=function(t,e){return String.prototype.startsWith?t.startsWith(e):t.substr(0,e.length)===e},u=function(t,e){return Array.prototype.findIndex?t.findIndex(e):function(){for(var n=t.length,i=-1;++i<n;)if(e(t[i],i,t))return i;return-1}()},h=function t(e,n){if(e&&"string"==typeof n)if(l(n,"."))for(var i in A){var r=i.replace("__namespace__",".");a(r,n)&&A[i].element===e&&t(e,r)}else{var s=(n=n.split("."))[0];n[1]&&(n=n.join("__namespace__")),n in A&&(e.removeEventListener(s,A[n].handler),delete A[n])}},_=function(t,e,n,i){if(t&&"string"==typeof e&&"function"==typeof n){var r=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),A[e]={element:t,count:0,once:!1},!0===i){var s=n;n=function(n){if(e in A){if(A[e].count++,A[e].once&&A[e].count>1)return;s.call(this,n)}h(t,e)}}else i=!1;A[e]=_extends({},A[e],{handler:n,once:i}),t.addEventListener(r,A[e].handler,{once:i})}},d=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},f=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},m=function(t){return[].concat(_toConsumableArray(t))},g=function(t,e){return e.indexOf(t)>-1},p=function(t){if(o&&"intersectionRatio"in t)return t.intersectionRatio>0;if("none"===window.getComputedStyle(t,"display"))return!1;var e=document.getElementsByTagName("body")[0],n=window.innerWidth||documnt.documentElement.clientWidth||e.clientWidth,i=window.innerHeight||documnt.documentElement.clientHeight||e.clientHeight,r=t.getBoundingClientRect();return!(r.right<0||r.bottom<0||r.left>n||r.top>i)},v=function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))return!1;try{return t instanceof HTMLElement}catch(e){return 1===t.nodeType&&"object"===_typeof(t.style)&&"object"===_typeof(t.ownerDocument)}},y=function(t){return"string"==typeof t&&g(t,E)||v(t)&&"currentSrc"in t&&t.currentSrc.length>0&&("complete"in t&&t.complete||"readyState"in t&&t.readyState>=2)},b=function(t){return t.buffered.length&&Math.round(t.buffered.end(0))/Math.round(t.seekable.end(0))==1},A={},E=[],w=function(){function t(e){var n=this;if(_classCallCheck(this,t),this._settings=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1},e),!l(this._settings.srcAttr,"data-")||!l(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=d(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=d(this._settings.srcsetAttr.replace("data-","")),this._id=null,this._idEvent=null,this._busy=!1,this._element=null,this._resource=null,this._format=null,this._observer=null,this._done=function(){},this._success=function(){},this._error=function(){},this._callback=function(t){n._busy=!1,null!==n._observer&&n._observer.unobserve(n._element);var e=n._element.currentSrc||n._element.src;g(e,E)||E.push(e);var i=[n._element,t.type,e,n._id];n["error"!==t.type?"_success":"_error"].apply(n,i),n._done.apply(n,i)}}return _createClass(t,[{key:"load",value:function(){var t,e=this;if(y(this._exists&&this._consistent?this._element:this._resource))return this._busy||h(this._element,"."+this._idEvent),this._callback(new i((t=this._exists&&this._consistent?this._element:this._resource,y(t)&&(v(t)&&("naturalWidth"in t&&0===Math.floor(t.naturalWidth)||"videoWidth"in t&&0===t.videoWidth)||"string"==typeof t)?"error":"load"))),!1;if(this._exists&&this._settings.visible&&!p(this._originalElement))return!1;if("image"===this._format){_(this._element,"load."+this._idEvent,this._callback,!this._busy),_(this._element,"error."+this._idEvent,this._callback,!this._busy);var r=this._element.closest("picture");r&&c?(delete this._element.dataset[this.srcsetAttr],delete this._element.dataset[this.srcAttr],r.querySelectorAll("source["+this._settings.srcsetAttr+"]").forEach(function(t){t.setAttribute("srcset",t.dataset[e.srcAttr]),delete t.dataset[e.srcAttr]})):(this._element.matches("["+this._settings.srcsetAttr+"]")&&(this._element.setAttribute("srcset",this._element.dataset[this.srcsetAttr]),delete this._element.dataset[this.srcsetAttr]),this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr]))}else{if("video"!==this._format&&"audio"!==this._format)return!1;var s=!0===this._settings.playthrough,o="full"===this._settings.playthrough,a=this._element.querySelectorAll("source"),l=!1;a?a.forEach(function(t){t.matches("["+e._settings.srcAttr+"]")&&(t.setAttribute("src",t.dataset[e.srcAttr]),delete t.dataset[e.srcsetAttr],l=!0),_(t,"error."+e._idEvent,function(i){t[n+"_niteLoader_error"]=!0,a.length===m(a).filter(function(t){return!0===t[n+"_niteLoader_error"]}).length&&e._callback(i)},!e._busy)}):this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr],_(this._element,"error."+this._idEvent,this._callback,!this._busy),l=!0),l&&this._element.load(),_(this._element,"loadedmetadata."+this._idEvent,function(){if(s||o||e._callback(new i("load")),o){var t=setInterval(function(){var n=e._element.readyState>0&&!e._element.duration;n||b(e._element)?(e._element.currentTime=0,!n&&!e._busy&&e._element.paused&&e._element.matches("[autoplay]")&&e._element.play(),clearInterval(t),e._callback(new i(n?"error":"load"))):(e._element.paused||e._element.pause(),e._busy||(e._element.currentTime+=2))},500);e._element["niteLoader_"+e._idEvent]=t}},!this._busy),_(this._element,"canplay."+this._idEvent,function(){o&&0===e._element.currentTime&&!b(e._element)&&e._element.currentTime++},!this._busy),_(this._element,"canplaythrough."+this._idEvent,function(){s&&e._callback(new i("load"))},!this._busy)}return this._busy||(this._element[n+"_IDEvent"]=this._idEvent),this._resource=this._element.currentSrc||this._element.src,!this._busy}},{key:"done",value:function(t){"function"==typeof t&&(this._done=function(e,n,i,r){t.apply(this,[e,n,i,r])})}},{key:"abort",value:function(){if(h(this._element,"."+this._idEvent),!y(this._exists?this._element:this._resource)){var t=this._element.getAttribute("srcset"),e=this._element.getAttribute("src");void 0!==t&&(this._element.dataset[this.srcAttr]=t,this._element.setAttribute(this._settings.srcAttr,t),this._element.removeAttribute("src"),this._element.removeAttribute("srcset")),void 0!==e&&(this._element.dataset[this.srcsetAttr]=e,this._element.setAttribute(this._settings.srcsetAttr,e),this._element.removeAttribute("src"),this._element.removeAttribute("srcset"))}}},{key:"resource",set:function(t){if("object"===(void 0===t?"undefined":_typeof(t))&&"id"in t&&"element"in t&&"resource"in t){this._id=t.id,this._element=t.element,this._resource=t.resource;var i=function(t){var e={format:null,extension:null,tag:null,consistent:!1};for(var n in t.resource=t.resource.split("?")[0],t.resource=t.resource.split("#")[0],r)if(new RegExp("(.("+r[n]+")$)|;base64,","g").test(t.resource)){if(new RegExp(";base64,","g").test(t.resource)){var i=t.resource.match(new RegExp("^data:"+n+"/("+r[n]+")","g"));if(null===i)return;i=i[0],e.format=n,e.extension=i.replace("data:"+n+"/",""),e.tag=s[n];break}var o=t.resource.match(new RegExp(r[n],"g"));if(o){e.format=n,e.extension=o[0],e.tag=s[n];break}}if(v(t.element)){var c=t.element.tagName.toLowerCase(),l="";if(Object.values(s).forEach(function(t){l+="|"+t}),l=l.split("|"),g(c,l)&&(e.tag=c,e.consistent=!0,null===e.format))for(var u in s)if(a(s[u],e.tag)){e.format=u;break}}return a(e.tag,"|")&&(e.tag=e.tag.split("|")[0]),e}({resource:this._resource,element:this._element});this._tag=i.tag,this._consistent=i.consistent,this._format=i.format,this._exists=null!==this._element,this._originalElement=this._element,this._exists&&this._consistent||(this._element=document.createElement(this._tag),this._element.dataset[this.srcAttr]=this._resource),this._exists&&this._settings.visible&&o&&(this._observer=new IntersectionObserver(function(t,e){t.forEach(function(t){return t.target.intersectionRatio=t.intersectionRatio})},{root:null,rootMargin:"0px",threshold:.1}),this._observer.observe(this._originalElement)),this._idEvent=this._element[n+"_IDEvent"],this._busy=void 0!==this._idEvent,this._idEvent=this._busy?this._idEvent:"niteLoader_unique_"+this._element.tagName+"_"+e()}},get:function(){return this._resource}}]),t}(),k=function(){function t(e){if(_classCallCheck(this,t),this._collection=[],this._collectionLoaded=[],this._collectionInstances=[],this._collectionPending=[],this._resourcesLoaded=[],this._settings=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1,backgrounds:!1},e),!l(this._settings.srcAttr,"data-")||!l(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=d(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=d(this._settings.srcsetAttr.replace("data-","")),this.percentage=0,this._done=function(){},this._progress=function(){},this._success=function(){},this._error=function(){},this._loop=this.load,this._abort=!1,this._loaded=0,this._complete=!1,this._busy=!1}return _createClass(t,[{key:"load",value:function(){var t=this;this._collection.length||this._done.call(this,this._resourcesLoaded),this._collectionPending=[];for(var e=!0===this._settings.sequential,n=function(n){if(t._abort)return"break";var i=t._collection[n].id,r=u(t._collectionInstances,function(t){return t.id===i}),s=new w(t._settings);-1===r?(t._collectionInstances.push({id:i,instance:s}),r=u(t._collectionInstances,function(t){return t.id===i})):t._collectionInstances[r].instance=s,s.resource=t._collection[n],s.done(function(n,i,r,s){if(!t._complete&&!t._abort){var o=!g(s,t._collectionLoaded);if(o){t._collectionLoaded.push(s),t._busy=!1,t._loaded++,t.percentage=t._loaded/t._collection.length*100,t.percentage=parseFloat(t.percentage.toFixed(4));var c={resource:r,status:i,element:n};t._resourcesLoaded.push(c),t._progress.call(t,c),t["error"!==i?"_success":"_error"].call(t,c)}t._loaded===t._collection.length?(t._done.call(t,t._resourcesLoaded),t._complete=!0):o&&e&&t._collectionPending.length&&(t._collectionPending=t._collectionPending.filter(function(t){return t.id!==s}),t._collectionPending.length&&(t._busy=t._collectionPending[0].instance.load()))}}),!e||e&&!t._busy?t._busy=s.load():e&&t._busy&&(!t._settings.visible||!s._exists||t._settings.visible&&s._exists&&p(s._originalElement))&&t._collectionPending.push({id:i,instance:s})},i=0;i<this._collection.length;i++){if("break"===n(i))break}}},{key:"done",value:function(t){"function"==typeof t&&(this._done=function(e){t.call(this,e)})}},{key:"progress",value:function(t){"function"==typeof t&&(this._progress=function(e){t.call(this,e)})}},{key:"success",value:function(t){"function"==typeof t&&(this._success=function(e){t.call(this,e)})}},{key:"error",value:function(t){"function"==typeof t&&(this._error=function(e){t.call(this,e)})}},{key:"abort",value:function(){this._collectionInstances.forEach(function(t){t.instance.abort()}),this._abort=!0}},{key:"collection",set:function(n){var i=this,r=n;try{r=t.findResources(n,this._settings)}catch(t){}r.forEach(function(t){var n={resource:"",element:null,id:e()};if("string"==typeof t)n.resource=t;else{if(!("object"===(void 0===t?"undefined":_typeof(t))&&"resource"in t))return;n=_extends({},n,t)}i._collection.push(n)})},get:function(){return this._collection}}],[{key:"findResources",value:function(t,e){var n={srcAttr:"src",srcsetAttr:"srcset",backgrounds:!1};if("object"===(void 0===t?"undefined":_typeof(t))&&void 0===e)for(var i in n)if(i in t){e=t,t=void 0;break}if(void 0!==t&&t!==document||(t=document.body),!v(t))throw new Error("TypeError: "+t+" is not of type HTMLElement.");var r=[];n=_extends({},n,e);var s="img, video, audio, picture, source",o="["+n.srcAttr+"], ["+n.srcsetAttr+"]",c=m(t.querySelectorAll("img, video, audio"));if(t.matches(s)&&c.push(t),(c=c.filter(function(t){var e=m(t.children);return e=(e=e.filter(function(t){return t.matches(s)})).filter(function(t){return t.matches(o)}),t.matches(o)||e.length})).forEach(function(t){var e=t;e.matches(o)||(e=e.querySelectorAll(o),e=[].concat(_toConsumableArray(e))[0]),r.push({element:t,resource:e.getAttribute(n.srcAttr)||e.getAttribute(n.srcsetAttr)})}),!0===n.backgrounds){var a=m(t.querySelectorAll("*"));a.push(t),(a=(a=a.filter(function(t){return!t.matches(s)})).filter(function(t){return"none"!==getComputedStyle(t).backgroundImage})).forEach(function(t){var e=getComputedStyle(t).backgroundImage.match(/\((.*?)\)/);null!==e&&e.length>=2&&r.push({element:t,resource:e[1].replace(/('|")/g,"")})})}return r}}]),t}();if("function"==typeof define&&define.amd?define(f("niteLoader"),k):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports[f("niteLoader")]=k:window[f("niteLoader")]=k,"jQuery"in window){var x=jQuery;x[f("niteLoader")]=k;x(document);var C=x(window),L=[];x.fn.niteLoad=function(t){var n=t;"object"!==(void 0===t?"undefined":_typeof(t))&&(t={});var i=_extends({srcAttr:"data-src",srcsetAttr:"data-srcset",visible:!1,sequential:!1,backgrounds:!1,playthrough:!1,early:!1,earlyTimeout:0,onProgress:function(){},onLoad:function(){},onError:function(){},onComplete:function(){}},t),r=i.onComplete;return x.isFunction(n)&&(r=n),this.each(function(t){var n=this,s=x(this),o=e()+t,c=new k(i);if(c.collection=this,L.push({id:o,instance:c,element:this,timeout:null}),c.progress(function(t){x(t.element).trigger("nite"+f(t.status)+".nite",[t.element,t.resource]),s.trigger("niteProgress.nite",[n,t]);var e=[c,t];"function"==typeof i.onProgress&&i.onProgress.apply(n,e);var r=f(t.status);"function"==typeof i["on"+r]&&i["on"+r].apply(n,e)}),c.done(function(t){s.trigger("niteComplete.nite",[n,t]),r.apply(n,[c,t]),i.visible&&C.off("scroll."+o),(L=L.filter(function(t){return t.id!==o})).forEach(function(t){s.is(t.element)&&t.instance.load()})}),c.load(),i.visible&&C.on("scroll."+o,function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=null,r=null,s=function(){t.apply(n,r),i=null};return function(){i||(r=arguments,i=setTimeout(s,e))}}(function(){return c.load()},250)),!0===i.early){var a=!1;L.forEach(function(t){if(!a&&L[key].id===o){clearTimeout(t.timeout);var e=parseInt(i.earlyTimeout);t.timeout=setTimeout(function(){t.instance._settings.visible=!1,t.instance._settings.sequential=!0,t.instance.load()},!isNaN(e)&&isFinite(e)?e:0),a=!0}})}})}}}();
//# sourceMappingURL=nite.loader.min.js.map
