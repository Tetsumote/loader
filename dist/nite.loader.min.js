(()=>{"use strict";const t=()=>Math.floor(8999*Math.random())+1e3,e="niteLoader",s=t(),i=window.CustomEvent||(()=>{const t=(t,e)=>{e=e||{bubbles:!1,cancelable:!1,detail:void 0};const s=document.createEvent("CustomEvent");return s.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),s};return t.prototype=window.Event.prototype,t})(),n={image:"jp[e]?g|jpe|jif|jfif|jfi|gif|png|tif[f]?|bmp|dib|webp|ico|cur|svg",audio:"mp3|ogg|oga|spx|ogg|wav",video:"mp4|ogv|webm"},r={image:"img|picture|source",audio:"audio|source",video:"video|source"},o="IntersectionObserver"in window,l="HTMLPictureElement"in window,c=(t,e)=>String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0),h=(t,e)=>String.prototype.startsWith?t.startsWith(e):t.substr(0,e.length)===e,a=(t,e)=>Array.prototype.findIndex?t.findIndex(e):(()=>{let s=t.length,i=-1;for(;++i<s;)if(e(t[i],i,t))return i;return-1})(),u=(t,e)=>{if(t&&"string"==typeof e)if(h(e,"."))for(let s in w){const i=s.replace("__namespace__",".");c(i,e)&&w[s].element===t&&u(t,i)}else{const s=(e=e.split("."))[0];e[1]&&(e=e.join("__namespace__")),e in w&&(t.removeEventListener(s,w[e].handler),delete w[e])}},_=(t,e,s,i)=>{if(!t||"string"!=typeof e||"function"!=typeof s)return;const n=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),w[e]={element:t,count:0,once:!1},!0===i){let i=s;s=function(s){if(e in w){if(w[e].count++,w[e].once&&w[e].count>1)return;i.call(this,s)}u(t,e)}}else i=!1;w[e]={...w[e],...{handler:s,once:i}},t.addEventListener(n,w[e].handler,{once:i})},d=t=>t.replace(/-([a-z])/g,t=>t[1].toUpperCase()),m=t=>t.charAt(0).toUpperCase()+t.slice(1),g=t=>[...t],f=(t,e)=>e.indexOf(t)>-1,p=t=>{if(o&&"intersectionRatio"in t)return t.intersectionRatio>0;if("none"===window.getComputedStyle(t,"display"))return!1;const e=document.getElementsByTagName("body")[0],s=window.innerWidth||documnt.documentElement.clientWidth||e.clientWidth,i=window.innerHeight||documnt.documentElement.clientHeight||e.clientHeight,n=t.getBoundingClientRect();return!(n.right<0||n.bottom<0||n.left>s||n.top>i)},b=t=>{if("object"!=typeof t)return!1;try{return t instanceof HTMLElement}catch(e){return 1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},y=t=>"string"==typeof t&&f(t,x)||b(t)&&"currentSrc"in t&&t.currentSrc.length>0&&("complete"in t&&t.complete||"readyState"in t&&t.readyState>=2),v=t=>t.buffered.length&&Math.round(t.buffered.end(0))/Math.round(t.seekable.end(0))==1,A=t=>y(t)&&(b(t)&&("naturalWidth"in t&&0===Math.floor(t.naturalWidth)||"videoWidth"in t&&0===t.videoWidth)||"string"==typeof t),E=t=>{let e={format:null,extension:null,tag:null,consistent:!1};t.resource=t.resource.split("?")[0],t.resource=t.resource.split("#")[0];for(let s in n){const i=";base64,";if(new RegExp("(.("+n[s]+")$)|"+i,"g").test(t.resource)){if(new RegExp(i,"g").test(t.resource)){let i=t.resource.match(new RegExp("^data:"+s+"/("+n[s]+")","g"));if(null===i)return;i=i[0],e.format=s,e.extension=i.replace("data:"+s+"/",""),e.tag=r[s];break}{let i=t.resource.match(new RegExp(n[s],"g"));if(i){e.format=s,e.extension=i[0],e.tag=r[s];break}}}}if(b(t.element)){let s=t.element.tagName.toLowerCase(),i="";if(Object.values(r).forEach(t=>{i+="|"+t}),i=i.split("|"),f(s,i)&&(e.tag=s,e.consistent=!0,null===e.format))for(let t in r)if(c(r[t],e.tag)){e.format=t;break}}return c(e.tag,"|")&&(e.tag=e.tag.split("|")[0]),e};let w={},x=[];class k{constructor(t){if(this._settings={...{srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1},...t},!h(this._settings.srcAttr,"data-")||!h(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=d(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=d(this._settings.srcsetAttr.replace("data-","")),this._id=null,this._idEvent=null,this._busy=!1,this._element=null,this._resource=null,this._format=null,this._observer=null,this._done=(()=>{}),this._success=(()=>{}),this._error=(()=>{}),this._callback=(t=>{this._busy=!1,null!==this._observer&&this._observer.unobserve(this._element);const e=this._element.currentSrc||this._element.src;f(e,x)||x.push(e);let s=[this._element,t.type,e,this._id];this["error"!==t.type?"_success":"_error"].apply(this,s),this._done.apply(this,s)})}set resource(i){if("object"==typeof i&&"id"in i&&"element"in i&&"resource"in i){this._id=i.id,this._element=i.element,this._resource=i.resource;let n=E({resource:this._resource,element:this._element});this._tag=n.tag,this._consistent=n.consistent,this._format=n.format,this._exists=null!==this._element,this._originalElement=this._element,this._exists&&this._consistent||(this._element=document.createElement(this._tag),this._element.dataset[this.srcAttr]=this._resource),this._exists&&this._settings.visible&&o&&(this._observer=new IntersectionObserver((t,e)=>{t.forEach(t=>t.target.intersectionRatio=t.intersectionRatio)},{root:null,rootMargin:"0px",threshold:.1}),this._observer.observe(this._originalElement)),this._idEvent=this._element[s+"_IDEvent"],this._busy=void 0!==this._idEvent,this._idEvent=this._busy?this._idEvent:e+"_unique_"+this._element.tagName+"_"+t()}}get resource(){return this._resource}load(){if(y(this._exists&&this._consistent?this._element:this._resource))return this._busy||u(this._element,"."+this._idEvent),this._callback(new i(A(this._exists&&this._consistent?this._element:this._resource)?"error":"load")),!1;if(this._exists&&this._settings.visible&&!p(this._originalElement))return!1;if("image"===this._format){_(this._element,"load."+this._idEvent,this._callback,!this._busy),_(this._element,"error."+this._idEvent,this._callback,!this._busy);const t=this._element.closest("picture");t&&l?(delete this._element.dataset[this.srcsetAttr],delete this._element.dataset[this.srcAttr],t.querySelectorAll("source["+this._settings.srcsetAttr+"]").forEach(t=>{t.setAttribute("srcset",t.dataset[this.srcAttr]),delete t.dataset[this.srcAttr]})):(this._element.matches("["+this._settings.srcsetAttr+"]")&&(this._element.setAttribute("srcset",this._element.dataset[this.srcsetAttr]),delete this._element.dataset[this.srcsetAttr]),this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr]))}else{if("video"!==this._format&&"audio"!==this._format)return!1;{const t=!0===this._settings.playthrough,n="full"===this._settings.playthrough,r=this._element.querySelectorAll("source");let o=!1;r?r.forEach(t=>{t.matches("["+this._settings.srcAttr+"]")&&(t.setAttribute("src",t.dataset[this.srcAttr]),delete t.dataset[this.srcsetAttr],o=!0),_(t,"error."+this._idEvent,i=>{const n=e+"_error";t[s+"_"+n]=!0,r.length===g(r).filter(t=>!0===t[s+"_"+n]).length&&this._callback(i)},!this._busy)}):this._element.matches("["+this._settings.srcAttr+"]")&&(this._element.setAttribute("src",this._element.dataset[this.srcAttr]),delete this._element.dataset[this.srcAttr],_(this._element,"error."+this._idEvent,this._callback,!this._busy),o=!0),o&&this._element.load(),_(this._element,"loadedmetadata."+this._idEvent,()=>{if(t||n||this._callback(new i("load")),n){let t=setInterval(()=>{let e=this._element.readyState>0&&!this._element.duration;e||v(this._element)?(this._element.currentTime=0,!e&&!this._busy&&this._element.paused&&this._element.matches("[autoplay]")&&this._element.play(),clearInterval(t),this._callback(new i(e?"error":"load"))):(this._element.paused||this._element.pause(),this._busy||(this._element.currentTime+=2))},500);this._element[e+"_"+this._idEvent]=t}},!this._busy),_(this._element,"canplay."+this._idEvent,()=>{n&&0===this._element.currentTime&&!v(this._element)&&this._element.currentTime++},!this._busy),_(this._element,"canplaythrough."+this._idEvent,()=>{t&&this._callback(new i("load"))},!this._busy)}}return this._busy||(this._element[s+"_IDEvent"]=this._idEvent),this._resource=this._element.currentSrc||this._element.src,!this._busy}done(t){"function"==typeof t&&(this._done=function(e,s,i,n){t.apply(this,[e,s,i,n])})}abort(){if(u(this._element,"."+this._idEvent),y(this._exists?this._element:this._resource))return;const t=this._element.getAttribute("srcset"),e=this._element.getAttribute("src");void 0!==t&&(this._element.dataset[this.srcAttr]=t,this._element.setAttribute(this._settings.srcAttr,t),this._element.removeAttribute("src"),this._element.removeAttribute("srcset")),void 0!==e&&(this._element.dataset[this.srcsetAttr]=e,this._element.setAttribute(this._settings.srcsetAttr,e),this._element.removeAttribute("src"),this._element.removeAttribute("srcset"))}}class j{constructor(t){if(this._collection=[],this._collectionLoaded=[],this._collectionInstances=[],this._collectionPending=[],this._resourcesLoaded=[],this._settings={...{srcAttr:"data-src",srcsetAttr:"data-srcset",playthrough:!1,visible:!1,backgrounds:!1},...t},!h(this._settings.srcAttr,"data-")||!h(this._settings.srcsetAttr,"data-"))throw new Error("Wrong arguments format: srcAttr and srcsetAttr parameters must be dataset values.");this.srcAttr=d(this._settings.srcAttr.replace("data-","")),this.srcsetAttr=d(this._settings.srcsetAttr.replace("data-","")),this.percentage=0,this._done=(()=>{}),this._progress=(()=>{}),this._success=(()=>{}),this._error=(()=>{}),this._loop=this.load,this._abort=!1,this._loaded=0,this._complete=!1,this._busy=!1}static findResources(t,e){let s={srcAttr:"src",srcsetAttr:"srcset",backgrounds:!1};if("object"==typeof t&&void 0===e)for(let i in s)if(i in t){e=t,t=void 0;break}if(void 0!==t&&t!==document||(t=document.body),!b(t))throw new Error("TypeError: "+t+" is not of type HTMLElement.");let i=[];const n="img, video, audio, picture, source",r="["+(s={...s,...e}).srcAttr+"], ["+s.srcsetAttr+"]";let o=g(t.querySelectorAll("img, video, audio"));if(t.matches(n)&&o.push(t),(o=o.filter(t=>{let e=g(t.children);return e=(e=e.filter(t=>t.matches(n))).filter(t=>t.matches(r)),t.matches(r)||e.length})).forEach(t=>{let e=t;e.matches(r)||(e=[...e=e.querySelectorAll(r)][0]),i.push({element:t,resource:e.getAttribute(s.srcAttr)||e.getAttribute(s.srcsetAttr)})}),!0===s.backgrounds){let e=g(t.querySelectorAll("*"));e.push(t),(e=(e=e.filter(t=>!t.matches(n))).filter(t=>"none"!==getComputedStyle(t).backgroundImage)).forEach(t=>{const e=getComputedStyle(t).backgroundImage.match(/\((.*?)\)/);null!==e&&e.length>=2&&i.push({element:t,resource:e[1].replace(/('|")/g,"")})})}return i}set collection(e){let s=e;try{s=j.findResources(e,this._settings)}catch(t){}s.forEach(e=>{let s={resource:"",element:null,id:t()};if("string"==typeof e)s.resource=e;else{if(!("object"==typeof e&&"resource"in e))return;s={...s,...e}}this._collection.push(s)})}get collection(){return this._collection}load(){this._collection.length||this._done.call(this,this._resourcesLoaded),this._collectionPending=[];const t=!0===this._settings.sequential;for(let e=0;e<this._collection.length&&!this._abort;e++){let s=this._collection[e].id,i=a(this._collectionInstances,t=>t.id===s),n=new k(this._settings);-1===i?(this._collectionInstances.push({id:s,instance:n}),i=a(this._collectionInstances,t=>t.id===s)):this._collectionInstances[i].instance=n,n.resource=this._collection[e],n.done((e,s,i,n)=>{if(this._complete||this._abort)return;const r=!f(n,this._collectionLoaded);if(r){this._collectionLoaded.push(n),this._busy=!1,this._loaded++,this.percentage=this._loaded/this._collection.length*100,this.percentage=parseFloat(this.percentage.toFixed(4));const t={resource:i,status:s,element:e};this._resourcesLoaded.push(t),this._progress.call(this,t),this["error"!==s?"_success":"_error"].call(this,t)}this._loaded===this._collection.length?(this._done.call(this,this._resourcesLoaded),this._complete=!0):r&&t&&this._collectionPending.length&&(this._collectionPending=this._collectionPending.filter(t=>t.id!==n),this._collectionPending.length&&(this._busy=this._collectionPending[0].instance.load()))}),!t||t&&!this._busy?this._busy=n.load():t&&this._busy&&(!this._settings.visible||!n._exists||this._settings.visible&&n._exists&&p(n._originalElement))&&this._collectionPending.push({id:s,instance:n})}}done(t){"function"==typeof t&&(this._done=function(e){t.call(this,e)})}progress(t){"function"==typeof t&&(this._progress=function(e){t.call(this,e)})}success(t){"function"==typeof t&&(this._success=function(e){t.call(this,e)})}error(t){"function"==typeof t&&(this._error=function(e){t.call(this,e)})}abort(){this._collectionInstances.forEach(t=>{t.instance.abort()}),this._abort=!0}}if("function"==typeof define&&define.amd?define(m(e),j):"object"==typeof exports?module.exports[m(e)]=j:window[m(e)]=j,!("jQuery"in window))return;const I=jQuery;I[m(e)]=j;I(document);const S=I(window),L=(t,e,s=this)=>{let i=null,n=null;const r=()=>{t.apply(s,n),i=null};return function(){i||(n=arguments,i=setTimeout(r,e))}};let T=[];I.fn.niteLoad=function(e){let s=e;"object"!=typeof e&&(e={});let i={...{srcAttr:"data-src",srcsetAttr:"data-srcset",visible:!1,sequential:!1,backgrounds:!1,playthrough:!1,early:!1,earlyTimeout:0,onProgress:()=>{},onLoad:()=>{},onError:()=>{},onComplete:()=>{}},...e},n=i.onComplete;return I.isFunction(s)&&(n=s),this.each(function(e){const s=I(this),r=t()+e,o=new j(i);if(o.collection=this,T.push({id:r,instance:o,element:this,timeout:null}),o.progress(t=>{I(t.element).trigger("nite"+m(t.status)+".nite",[t.element,t.resource]),s.trigger("niteProgress.nite",[this,t]);const e=[o,t];"function"==typeof i.onProgress&&i.onProgress.apply(this,e);let n=m(t.status);"function"==typeof i["on"+n]&&i["on"+n].apply(this,e)}),o.done(t=>{s.trigger("niteComplete.nite",[this,t]),n.apply(this,[o,t]),i.visible&&S.off("scroll."+r),(T=T.filter(t=>t.id!==r)).forEach(t=>{s.is(t.element)&&t.instance.load()})}),o.load(),i.visible&&S.on("scroll."+r,L(()=>o.load(),250)),!0===i.early){let t=!1;T.forEach(e=>{if(!t&&T[key].id===r){clearTimeout(e.timeout);let s=parseInt(i.earlyTimeout);e.timeout=setTimeout(()=>{e.instance._settings.visible=!1,e.instance._settings.sequential=!0,e.instance.load()},!isNaN(s)&&isFinite(s)?s:0),t=!0}})}})}})();
//# sourceMappingURL=nite.loader.min.js.map
